{"version":3,"sources":["../JavaScript/JavaScriptSDK.Interfaces/IConfig.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/Base.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/Envelope.ts","../JavaScript/JavaScriptSDK.Interfaces/Context/IApplication.ts","../JavaScript/JavaScriptSDK.Interfaces/Context/IDevice.ts","../JavaScript/JavaScriptSDK.Interfaces/Context/IInternal.ts","../JavaScript/JavaScriptSDK.Interfaces/Context/ILocation.ts","../JavaScript/JavaScriptSDK.Interfaces/Context/IOperation.ts","../JavaScript/JavaScriptSDK.Interfaces/Context/ISample.ts","../JavaScript/JavaScriptSDK.Interfaces/Context/IUser.ts","../JavaScript/JavaScriptSDK.Interfaces/Context/ISession.ts","../JavaScript/JavaScriptSDK.Interfaces/Telemetry/ISerializable.ts","../JavaScript/JavaScriptSDK.Interfaces/Telemetry/IEnvelope.ts","../JavaScript/JavaScriptSDK.Interfaces/ITelemetryContext.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/SeverityLevel.ts","../JavaScript/JavaScriptSDK.Interfaces/IAppInsights.ts","../JavaScript/JavaScriptSDK/Logging.ts","../JavaScript/JavaScriptSDK/Util.ts","../JavaScript/JavaScriptSDK/Serializer.ts","../JavaScript/JavaScriptSDK/Telemetry/Common/Envelope.ts","../JavaScript/JavaScriptSDK/Telemetry/Common/Base.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/ContextTagKeys.ts","../JavaScript/JavaScriptSDK/Context/Application.ts","../JavaScript/JavaScriptSDK/Context/Device.ts","../JavaScript/JavaScriptSDK/Context/Internal.ts","../JavaScript/JavaScriptSDK/Context/Location.ts","../JavaScript/JavaScriptSDK/Context/Operation.ts","../JavaScript/JavaScriptSDK/HashCodeScoreGenerator.ts","../JavaScript/JavaScriptSDK/SamplingScoreGenerator.ts","../JavaScript/JavaScriptSDK/Context/Sample.ts","../JavaScript/JavaScriptSDK/Context/Session.ts","../JavaScript/JavaScriptSDK/Context/User.ts","../JavaScript/JavaScriptSDK/ajax/ajaxUtils.ts","../JavaScript/JavaScriptSDK/ajax/ajaxRecord.ts","../JavaScript/JavaScriptSDK/RequestResponseHeaders.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/Domain.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/EventData.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/PageViewData.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/RemoteDependencyData.ts","../JavaScript/JavaScriptSDK/Telemetry/Common/DataSanitizer.ts","../JavaScript/JavaScriptSDK/Telemetry/RemoteDependencyData.ts","../JavaScript/JavaScriptSDK/ajax/ajax.ts","../JavaScript/JavaScriptSDK/SendBuffer.ts","../JavaScript/JavaScriptSDK/Sender.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/MessageData.ts","../JavaScript/JavaScriptSDK/Telemetry/Trace.ts","../JavaScript/JavaScriptSDK/Telemetry/Event.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/ExceptionDetails.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/ExceptionData.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/StackFrame.ts","../JavaScript/JavaScriptSDK/Telemetry/Exception.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/DataPointType.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/DataPoint.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/MetricData.ts","../JavaScript/JavaScriptSDK/Telemetry/Common/DataPoint.ts","../JavaScript/JavaScriptSDK/Telemetry/Metric.ts","../JavaScript/JavaScriptSDK/Telemetry/PageView.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/PageViewPerfData.ts","../JavaScript/JavaScriptSDK/Telemetry/PageViewPerformance.ts","../JavaScript/JavaScriptSDK/TelemetryContext.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/Data.ts","../JavaScript/JavaScriptSDK/Telemetry/Common/Data.ts","../JavaScript/JavaScriptSDK/Telemetry/PageViewManager.ts","../JavaScript/JavaScriptSDK/Telemetry/PageVisitTimeManager.ts","../JavaScript/JavaScriptSDK/SplitTest.ts","../JavaScript/JavaScriptSDK/AppInsights.ts","../JavaScript/JavaScriptSDK/DataLossAnalyzer.ts","../JavaScript/JavaScriptSDK/Initialization.ts","../JavaScript/JavaScriptSDK/Init.ts"],"names":["Microsoft","ApplicationInsights","Telemetry","Base","Envelope","this","ver","sampleRate","tags","Context","AI","SeverityLevel","LoggingSeverity","_InternalMessageId","_InternalLogMessage","msgId","msg","isUserAct","properties","messageId","message","AiUserActionablePrefix","AiNonUserActionablePrefix","toString","diagnosticText","sanitizeDiagnosticText","JSON","stringify","text","replace","_InternalLogging","throwInternal","severity","enableDebugExceptions","messageKey","_messageLogged","verboseLogging","warnToConsole","logInternalMessage","console","warn","log","resetInternalMessageCount","_messageCount","clearInternalMessageLoggedTypes","Util","canUseSessionStorage","sessionStorageKeys","getSessionStorageKeys","i","length","indexOf","AIInternalMessagePrefix","removeSessionStorage","setMaxInternalMessageLimit","limit","Error","MAX_INTERNAL_MESSAGE_LIMIT","_areInternalMessagesThrottled","logMessage","getSessionStorage","setSessionStorage","CRITICAL","queue","push","throttleLimitMessage","throttleMessage","MessageLimitPerPVExceeded","StorageType","disableStorage","_canUseLocalStorage","_canUseSessionStorage","_getLocalStorageObject","canUseLocalStorage","_getVerifiedStorageObject","LocalStorage","storageType","fail","uid","storage","Date","window","localStorage","sessionStorage","setItem","getItem","removeItem","exception","undefined","getStorage","name","e","WARNING","BrowserCannotReadLocalStorage","getExceptionName","dump","setStorage","data","BrowserCannotWriteLocalStorage","removeStorage","BrowserFailedRemovalFromLocalStorage","_getSessionStorageObject","SessionStorage","keys","key","BrowserCannotReadSessionStorage","BrowserCannotWriteSessionStorage","BrowserFailedRemovalFromSessionStorage","disableCookies","_canUseCookies","canUseCookies","document","cookie","CannotAccessCookie","setCookie","value","domain","domainAttrib","secureAttrib","location","protocol","stringToBoolOrDefault","str","defaultValue","toLowerCase","getCookie","cookieName","cookies","split","trim","substring","deleteCookie","newId","result","random","Math","charAt","floor","isArray","obj","Object","prototype","call","isError","isDate","toISOStringForIE8","date","toISOString","pad","number","r","String","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCMilliseconds","toFixed","slice","getIEVersion","userAgentStr","myNav","navigator","userAgent","parseInt","msToTimeSpan","totalms","isNaN","ms","round","sec","min","hour","days","isCrossOriginError","url","lineNumber","columnNumber","error","object","objectTypeDump","propertyValueDump","stack","addEventHandler","eventName","callback","verbEventName","addEventListener","IsBeaconApiSupported","sendBeacon","NotSpecified","UrlHelper","parseUrl","htmlAnchorElement","createElement","href","getAbsoluteUrl","a","getPathName","pathname","getCompleteUrl","method","absoluteUrl","toUpperCase","CorrelationIdHelper","canIncludeCorrelationHeader","config","requestUrl","disableCorrelationHeaders","excludedDomains","correlationHeaderExcludedDomains","RegExp","test","host","getCorrelationContext","responseHeader","correlationId","getCorrelationContextValue","RequestHeaders","requestContextTargetKey","correlationIdPrefix","keyValues","keyValue","FieldType","Serializer","serialize","input","output","_serializeObject","source","CannotSerializeObject","CircularReferenceDetected","aiDataContract","_serializeStringMap","_serializeArray","CannotSerializeObjectNonSerializable","field","contract","isRequired","Required","isHidden","Hidden","Array","isPresent","isObject","MissingRequiredFieldSpecification","sources","item","ItemNotInArray","map","expectedType","num","parseFloat","Common","_super","_this","DataSanitizer","sanitizeString","time","iKey","__extends","apply","arguments","ContextTagKeys","applicationVersion","applicationBuild","applicationTypeId","applicationId","applicationLayer","deviceId","deviceIp","deviceLanguage","deviceLocale","deviceModel","deviceFriendlyName","deviceNetwork","deviceNetworkName","deviceOEMName","deviceOS","deviceOSVersion","deviceRoleInstance","deviceRoleName","deviceScreenResolution","deviceType","deviceMachineName","deviceVMName","deviceBrowser","deviceBrowserVersion","locationIp","locationCountry","locationProvince","locationCity","operationId","operationName","operationParentId","operationRootId","operationSyntheticSource","operationCorrelationVector","sessionId","sessionIsFirst","sessionIsNew","userAccountAcquisitionDate","userAccountId","userId","userStoreRegion","userAuthUserId","userAnonymousUserAcquisitionDate","userAuthenticatedUserAcquisitionDate","cloudName","cloudRole","cloudRoleVer","cloudRoleInstance","cloudEnvironment","cloudLocation","cloudDeploymentUnit","internalSdkVersion","internalAgentVersion","internalNodeName","Application","Device","id","type","Internal","sdkVersion","sdkExtension","Version","Location","Operation","HashCodeScoreGenerator","getHashCodeScore","getHashCode","INT_MAX_VALUE","MIN_INPUT_LENGTH","concat","hash","charCodeAt","abs","SamplingScoreGenerator","hashCodeGeneragor","getSamplingScore","envelope","tagKeys","Sample","SampleRateOutOfRange","samplingRate","samplingScoreGenerator","isSampledIn","Session","_SessionManager","sessionExpirationMs","acquisitionSpan","sessionRenewalMs","renewalSpan","automaticSession","update","initializeAutomaticSession","now","dateTime","Now","acquisitionExpired","acquisitionDate","renewalExpired","renewalDate","isFirst","renew","cookieUpdatedTimestamp","cookieUpdateInterval","backup","initializeAutomaticSessionWithData","sessionData","params","acq","renewal","ErrorParsingAISessionCookie","SessionRenewalDateIsZero","BrowserDoesNotSupportLocalStorage","guid","acquisitionExpiry","renewalExpiry","cookieExpiry","setTime","cookieDomnain","cookieDomain","join","toUTCString","User","userCookieName","cookieSeparator","acqStr","accountAcquisitionDate","getTime","newCookie","accountId","authCookie","authUserCookieName","authCookieString","decodeURI","authenticatedId","setAuthenticatedUserContext","authenticatedUserId","storeInCookie","validateUserInput","SetAuthContextFailedAccountName","encodeURI","clearAuthenticatedUserContext","match","extensions","IsNullOrUndefined","stringUtils","GetLength","strObject","res","stringified","ex","performance","timing","navigationStart","GetDuration","start","end","EventHelper","AttachEvent","eventNameWithoutOn","handlerRef","attachEvent","DetachEvent","detachEvent","removeEventListener","AjaxHelper","ParseDependencyPath","pathName","target","parsedUrl","XHRMonitoringState","openDone","setRequestHeaderDone","sendDone","abortDone","onreadystatechangeCallbackAttached","ajaxRecord","completed","requestHeadersSize","ttfb","responseReceivingDuration","callbackDuration","ajaxTotalDuration","aborted","pageUrl","requestSize","status","requestSentTime","responseStartedTime","responseFinishedTime","callbackFinishedTime","endTime","originalOnreadystatechage","xhrMonitoringState","clientFailure","CalculateMetrics","self","sanitizeUrl","requestContextHeader","requestContextAppIdFormat","requestIdHeader","sdkContextHeader","sdkContextHeaderAppIdRequest","requestContextHeaderLowerCase","Domain","EventData","measurements","PageViewData","RemoteDependencyData","success","sanitizeKeyAndAddUniqueness","origLength","sanitizeKey","uniqueField","MAX_NAME_LENGTH","padNumber","NameTooLong","maxLength","MAX_STRING_LENGTH","StringValueTooLong","sanitizeInput","MAX_URL_LENGTH","UrlTooLong","sanitizeMessage","MAX_MESSAGE_LENGTH","MessageTruncated","sanitizeException","MAX_EXCEPTION_LENGTH","ExceptionTruncated","sanitizeProperties","tempProps","prop","MAX_PROPERTY_LENGTH","sanitizeMeasurements","tempMeasurements","measure","sanitizeId","MAX_ID_LENGTH","IdTooLong","_msgId","s","substr","commandName","resultCode","Default","duration","kind","count","max","stdDev","dependencyKind","dependencySource","dependencyTypeName","dependencyFields","envelopeType","dataType","AjaxMonitor","appInsights","currentWindowHost","initialized","Init","supportsMonitoring","instrumentOpen","instrumentSend","instrumentAbort","isMonitoredInstance","xhr","excludeAjaxDataValidation","ajaxData","DisabledPropertyName","XMLHttpRequest","open","send","abort","originalOpen","ajaxMonitorInstance","async","openHandler","FailedMonitorAjaxOpen","ajaxDiagnosticsMessage","getFailedAjaxDiagnosticsMessage","context","operation","attachToOnReadyStateChange","originalSend","content","sendHandler","FailedMonitorAjaxSend","setRequestHeader","appId","originalAbort","FailedMonitorAjaxAbort","readyState","onAjaxComplete","exceptionText","FailedMonitorAjaxRSC","FailedMonitorAjaxDur","dependency","correlationContext","trackDependencyData","responseHeadersString","getAllResponseHeaders","getResponseHeader","FailedMonitorAjaxGetCorrelationHeader","instrumentedByAppInsightsName","ArraySendBuffer","_config","_buffer","enqueue","payload","clear","getItems","batchPayloads","emitLineDelimitedJson","markAsSent","clearSent","SessionStorageSendBuffer","_bufferFullMessageSent","bufferItems","getBuffer","BUFFER_KEY","notDeliveredItems","SENT_BUFFER_KEY","MAX_BUFFER_SIZE","setBuffer","SessionStorageBufferFull","removePayloadsFromBuffer","sentElements","payloads","buffer","remaining","contains","j","bufferJson","parse","FailedToRestoreStorageBuffer","FailedToSetStorageBuffer","Sender","_XMLHttpRequestSupported","_consecutiveErrors","_retryAt","_lastSend","_sender","enableSessionStorageBuffer","isBeaconApiDisabled","_beaconSender","_xhrSender","XDomainRequest","_xdrSender","disableTelemetry","CannotSendEmptyTelemetry","SenderNotInitialized","bufferPayload","batch","maxBatchSizeInBytes","triggerSend","_setupTimer","FailedAddingTelemetryToBuffer","_timeoutHandle","retryInterval","timerValue","maxBatchInterval","setTimeout","_getSizeInBytes","list","size","clearTimeout","TransmissionFailed","_setRetryTime","delayInSeconds","backOffSlot","pow","backOffDelay","retryAfterTimeSpan","_parseResponse","response","itemsReceived","itemsAccepted","errors","InvalidBackendResponse","_isRetriable","statusCode","_resendPayload","_i","payload_1","_formatErrorMessageXhr","responseText","_formatErrorMessageXdr","xdr","isAsync","endpointUrl","onreadystatechange","_xhrReadyStateChange","onerror","event","_onError","onload","_xdrOnLoad","hostingProtocol","lastIndexOf","plainTextBatch","Blob","countOfItemsInPayload","_appId","isRetryDisabled","_onPartialSuccess","_onSuccess","results","failed","retry","errors_1","reverse","extracted","splice","index","OnError","MaxBeaconPayloadSize","MessageData","Trace","severityLevel","Event","ExceptionDetails","hasFullStack","parsedStack","ExceptionData","exceptions","StackFrame","Exception","_ExceptionDetails","CreateSimpleException","typeName","assembly","fileName","details","line","outerId","parseStack","frames","level","totalSizeInBytes","frame","_StackFrame","regex","parsedFrame","sizeInBytes","left","right","acceptedLeft","acceptedRight","howMany","matches","baseSize","DataPointType","DataPoint","Measurement","MetricData","metrics","Metric","dataPoint","PageView","durationMs","PageViewPerfData","PageViewPerformance","unused","perfTotal","networkConnect","sentRequest","receivedResponse","domProcessing","isValid","getPerformanceTiming","total","getDuration","loadEventEnd","network","connectEnd","request","requestStart","responseStart","responseEnd","dom","ErrorPVCalc","shouldCollectDuration","ClientPerformanceMathError","InvalidDurationValue","getIsValid","getDurationMs","isPerformanceTimingSupported","isPerformanceTimingDataReady","domainLookupStart","domLoading","durations","botAgentNames","isGoogleBot","i_1","MAX_DURATION_ALLOWED","TelemetryContext","telemetryInitializers","_sessionManager","application","device","internal","user","session","sample","_addDefaultTelemetryInitializers","addTelemetryInitializer","telemetryInitializer","track","_track","TrackArgumentsNotSpecified","isBrowserLinkTrackingEnabled","browserLinkPaths_1","remoteData","baseData","_applySessionContext","_applyApplicationContext","_applyDeviceContext","_applyInternalContext","_applyLocationContext","_applySampleContext","_applyUserContext","_applyOperationContext","instrumentationKey","doNotSendItem","telemetryInitializersCount","TelemetryInitializerFailed","iKeyNoDashes","TelemetrySampledAndNotSent","SampleRate","appContext","build","deviceContext","ip","language","locale","model","oemName","os","osversion","resolution","internalContext","agentVersion","locationContext","operationContext","parentId","rootId","syntheticSource","sampleContext","sessionContext","userContext","agent","storeRegion","Data","baseType","PageViewManager","overridePageViewDuration","pageViewPerformanceSent","trackPageView","title","pageViewSent","customDuration","sendPageViewInternal","flush","handle","setInterval","clearInterval","pageViewPerformance","sendPageViewPerformanceInternal","TrackPVFailedCalc","NavigationTimingNotSupported","PageVisitTimeManager","pageVisitTimeTrackingHandler","prevPageVisitDataKeyName","trackPreviousPageVisit","currentPageName","currentPageUrl","prevPageVisitTimeData","restartPageVisitTimer","pageName","pageVisitTime","prevPageVisitData","stopPageVisitTimer","startPageVisitTimer","currPageVisitData","PageVisitData","currPageVisitDataStr","pageVisitEndTime","pageVisitDataJsonStr","pageVisitStartTime","SplitTest","isEnabled","percentEnabled","AppInsights","_trackAjaxAttempts","defaults","defaultConfig","enableDebug","configGetters","samplingPercentage","isCookieUseDisabled","isStorageUseDisabled","_pageViewManager","_eventTracking","Timing","action","_pageTracking","_pageVisitTimeManager","trackPageVisitTime","disableAjaxTracking","_ajaxMonitor","pageView","pageViewPerformanceData","pageViewPerformanceEnvelope","startTrackPage","StartTrackFailed","stopTrackPage","stop","autoTrackPageVisitTime","StopTrackFailed","TrackPVFailed","startTrackEvent","StartTrackEventFailed","stopTrackEvent","StopTrackEventFailed","trackEvent","eventTelemetry","TrackEventFailed","trackDependency","command","totalTime","maxAjaxCallsPerView","dependencyData","MaxAjaxPerPVExceeded","trackAjax","trackException","handledAt","exceptionTelemetry","TrackExceptionFailed","trackMetric","average","sampleCount","telemetry","TrackMetricFailed","trackTrace","TrackTraceFailed","PageName","PageUrl","FlushFailed","SetAuthContextFailed","SendCORSException","exceptionData","_onerror","URL","errorString","exceptionDump","ExceptionWhileLoggingError","_name","_events","StartCalledMoreThanOnce","StopCalledWithoutStart","DataLossAnalyzer","reset","ITEMS_QUEUED_KEY","ISSUES_REPORTED_KEY","itemsRestoredFromSessionBuffer","enabled","getIssuesReported","incrementItemsQueued","itemsQueued","getNumberOfLostItems","decrementItemsQueued","countOfItemsSentSuccessfully","reportLostItems","LIMIT_PER_SESSION","lostItems","issuesReported","FailedToReportDataLoss","Initialization","snippet","getDefaultConfig","loadAppInsights","originalTrackPageView","pagePath","emptyQueue","FailedToSendQueuedTelemetry","pollInteralLogs","appInsightsInstance","diagnosticLogInterval","addHousekeepingBeforeUnload","disableFlushOnBeforeUnload","FailedToAddHandlerForOnBeforeUnload","disableExceptionTracking","init","appInsightsLocal"],"mappings":"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","file":"ai.0.js","sourcesContent":["module Microsoft.ApplicationInsights {\r\n\r\n    \"use strict\";\r\n\r\n    export interface IConfig {\r\n        instrumentationKey?: string;\r\n        endpointUrl?: string;\r\n        emitLineDelimitedJson?: boolean;\r\n        accountId?: string;\r\n        sessionRenewalMs?: number;\r\n        sessionExpirationMs?: number;\r\n        maxBatchSizeInBytes?: number;\r\n        maxBatchInterval?: number;\r\n        enableDebug?: boolean;\r\n        disableExceptionTracking?: boolean;\r\n        disableTelemetry?: boolean;\r\n        verboseLogging?: boolean;\r\n        diagnosticLogInterval?: number;\r\n        samplingPercentage?: number;\r\n        autoTrackPageVisitTime?: boolean;\r\n        disableAjaxTracking?: boolean;\r\n        overridePageViewDuration?: boolean;\r\n        maxAjaxCallsPerView?: number;\r\n        disableDataLossAnalysis?: boolean;\r\n        disableCorrelationHeaders?: boolean;\r\n        correlationHeaderExcludedDomains?: string[];\r\n        disableFlushOnBeforeUnload?: boolean;\r\n        enableSessionStorageBuffer?: boolean;\r\n        isCookieUseDisabled?: boolean;\r\n        cookieDomain?: string;\r\n        isRetryDisabled?: boolean;\r\n        url?: string;\r\n        isStorageUseDisabled?: boolean;\r\n        isBeaconApiDisabled?: boolean;\r\n        sdkExtension?: string;\r\n        isBrowserLinkTrackingEnabled?: boolean;\r\n        appId?: string;\r\n    }\r\n}","// THIS FILE WAS AUTOGENERATED\r\nmodule Microsoft.Telemetry\r\n{\r\n\"use strict\";\r\n    \r\n    /**\r\n     * Data struct to contain only C section with custom fields.\r\n     */\r\n    export class Base\r\n    {\r\n        \r\n        /**\r\n         * Name of item (B section) if any. If telemetry data is derived straight from this, this should be null.\r\n         */\r\n        public baseType: string;\r\n        \r\n        constructor()\r\n        {\r\n        }\r\n    }\r\n}\r\n","// THIS FILE WAS AUTOGENERATED\r\n/// <reference path=\"Base.ts\" />\r\nmodule Microsoft.Telemetry\r\n{\r\n\"use strict\";\r\n    \r\n    /**\r\n     * System variables for a telemetry item.\r\n     */\r\n    export class Envelope\r\n    {\r\n        \r\n        /**\r\n         * Envelope version. For internal use only. By assigning this the default, it will not be serialized within the payload unless changed to a value other than #1.\r\n         */\r\n        public ver: number;\r\n        \r\n        /**\r\n         * Type name of telemetry data item.\r\n         */\r\n        public name: string;\r\n        \r\n        /**\r\n         * Event date time when telemetry item was created. This is the wall clock time on the client when the event was generated. There is no guarantee that the client's time is accurate. This field must be formatted in UTC ISO 8601 format, with a trailing 'Z' character, as described publicly on https://en.wikipedia.org/wiki/ISO_8601#UTC. Note: the number of decimal seconds digits provided are variable (and unspecified). Consumers should handle this, i.e. managed code consumers should not use format 'O' for parsing as it specifies a fixed length. Example: 2009-06-15T13:45:30.0000000Z.\r\n         */\r\n        public time: string;\r\n        \r\n        /**\r\n         * Sampling rate used in application. This telemetry item represents 1 / sampleRate actual telemetry items.\r\n         */\r\n        public sampleRate: number;\r\n        \r\n        /**\r\n         * Sequence field used to track absolute order of uploaded events.\r\n         */\r\n        public seq: string;\r\n        \r\n        /**\r\n         * The application's instrumentation key. The key is typically represented as a GUID, but there are cases when it is not a guid. No code should rely on iKey being a GUID. Instrumentation key is case insensitive.\r\n         */\r\n        public iKey: string;\r\n        \r\n        /**\r\n         * Key/value collection of context properties. See ContextTagKeys for information on available properties.\r\n         */\r\n        public tags: any;\r\n        \r\n        /**\r\n         * Telemetry data item.\r\n         */\r\n        public data: Base;\r\n        \r\n        constructor()\r\n        {\r\n            this.ver = 1;\r\n            this.sampleRate = 100.0;\r\n            this.tags = {};\r\n        }\r\n    }\r\n}\r\n","module Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface IApplication {\r\n        /**\r\n         * The application version.\r\n         */\r\n        ver: string;\r\n\r\n        /**\r\n         * The application build version.\r\n         */\r\n        build: string;\r\n    }\r\n}","module Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface IDevice {\r\n        /**\r\n         * The type for the current device.\r\n         */\r\n        type: string;\r\n\r\n        /**\r\n         * A device unique ID.\r\n         */\r\n        id: string;\r\n\r\n        /**\r\n         * The device OEM for the current device.\r\n         */\r\n        oemName: string;\r\n\r\n        /**\r\n         * The device model for the current device.\r\n         */\r\n        model: string;\r\n\r\n        /**\r\n         * The IANA interface type for the internet connected network adapter.\r\n         */\r\n        network: number;\r\n\r\n        /**\r\n         * The application screen resolution.\r\n         */\r\n        resolution: string;\r\n\r\n        /**\r\n         * The current display language of the operating system.\r\n         */\r\n        locale: string;\r\n\r\n        /**\r\n         * The IP address.\r\n         */\r\n        ip: string;\r\n\r\n        /**\r\n         * The device language.\r\n         */\r\n        language: string;\r\n\r\n        /**\r\n         * The OS name.\r\n         */\r\n        os: string;\r\n\r\n        /**\r\n         * The OS version.\r\n         */\r\n        osversion: string;\r\n    }\r\n}","module Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface IInternal {\r\n        /**\r\n        * The SDK version used to create this telemetry item.\r\n        */\r\n        sdkVersion: string;\r\n\r\n        /**\r\n         * The SDK agent version.\r\n         */\r\n        agentVersion: string;\r\n    }\r\n}","module Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface ILocation {\r\n        /**\r\n         * Client IP address for reverse lookup\r\n         */\r\n        ip: string;\r\n    }\r\n}","module Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface IOperation {\r\n        /**\r\n         * Operation id\r\n         */\r\n        id: string;\r\n\r\n        /**\r\n         * Operation name\r\n         */\r\n        name: string;\r\n\r\n        /**\r\n         * Parent operation id\r\n         */\r\n        parentId: string;\r\n\r\n        /**\r\n         * Root operation id\r\n         */\r\n        rootId: string;\r\n\r\n        /**\r\n         * Synthetic source of the operation\r\n         */\r\n        syntheticSource: string;\r\n    }\r\n}","module Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface ISample {\r\n        /**\r\n        * Sample rate\r\n        */\r\n        sampleRate: number;\r\n    }\r\n}","module Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface IUser {\r\n        /**\r\n        * The telemetry configuration.\r\n        */\r\n        config: any;\r\n\r\n        /**\r\n         * The user ID.\r\n         */\r\n        id: string;\r\n\r\n        /**\r\n         * Authenticated user id\r\n         */\r\n        authenticatedId: string;\r\n\r\n        /**\r\n         * The account ID.\r\n         */\r\n        accountId: string;\r\n\r\n        /**\r\n         * The account acquisition date.\r\n         */\r\n        accountAcquisitionDate: string;\r\n\r\n        /**\r\n         * The user agent string.\r\n         */\r\n        agent: string;\r\n\r\n        /**\r\n         * The store region.\r\n         */\r\n        storeRegion: string;\r\n    }\r\n}","module Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface ISession {\r\n        /**\r\n        * The session ID.\r\n        */\r\n        id: string;\r\n\r\n        /**  \r\n         * The true if this is the first session  \r\n         */\r\n        isFirst: boolean;\r\n\r\n        /**\r\n         * The date at which this guid was genereated.\r\n         * Per the spec the ID will be regenerated if more than acquisitionSpan milliseconds ellapse from this time.\r\n         */\r\n        acquisitionDate: number;\r\n\r\n        /**\r\n         * The date at which this session ID was last reported.\r\n         * This value should be updated whenever telemetry is sent using this ID.\r\n         * Per the spec the ID will be regenerated if more than renewalSpan milliseconds elapse from this time with no activity.\r\n         */\r\n        renewalDate: number;\r\n    }\r\n}","module Microsoft.ApplicationInsights {\r\n\r\n    \"use strict\";\r\n\r\n    export interface ISerializable {\r\n        /**\r\n         * The set of fields for a serializable object. \r\n         * This defines the serialization order and a value of true/false\r\n         * for each field defines whether the field is required or not.\r\n         */\r\n        aiDataContract: any;\r\n    }\r\n}\r\n","/// <reference path=\"./ISerializable.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n\r\n    \"use strict\";\r\n\r\n    export interface IEnvelope extends ISerializable {\r\n        ver: number;\r\n        name: string;\r\n        time: string;\r\n        sampleRate: number;\r\n        seq: string;\r\n        iKey: string;\r\n        tags: { [name: string]: any };\r\n        data: any;\r\n    }\r\n}\r\n","/// <reference path=\"./Contracts/Generated/Envelope.ts\" />\r\n/// <reference path=\"./Context/IApplication.ts\"/>\r\n/// <reference path=\"./Context/IDevice.ts\"/>\r\n/// <reference path=\"./Context/IInternal.ts\"/>\r\n/// <reference path=\"./Context/ILocation.ts\"/>\r\n/// <reference path=\"./Context/IOperation.ts\"/>\r\n/// <reference path=\"./Context/ISample.ts\"/>\r\n/// <reference path=\"./Context/IUser.ts\"/>\r\n/// <reference path=\"./Context/ISession.ts\"/>\r\n/// <reference path=\"./Telemetry/IEnvelope.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n\r\n    \"use strict\";\r\n\r\n    export interface ITelemetryContext {\r\n         /**\r\n         * The object describing a component tracked by this object.\r\n         */\r\n        application: Context.IApplication;\r\n\r\n        /**\r\n         * The object describing a device tracked by this object.\r\n         */\r\n        device: Context.IDevice;\r\n\r\n        /**\r\n        * The object describing internal settings.\r\n        */\r\n        internal: Context.IInternal;\r\n\r\n        /**\r\n         * The object describing a location tracked by this object.\r\n         */\r\n        location: Context.ILocation;\r\n\r\n        /**\r\n         * The object describing a operation tracked by this object.\r\n         */\r\n        operation: Context.IOperation;\r\n\r\n        /**\r\n        * The object describing sampling settings.\r\n        */\r\n        sample: Context.ISample;\r\n\r\n        /**\r\n         * The object describing a user tracked by this object.\r\n         */\r\n        user: Context.IUser;\r\n\r\n        /**\r\n         * The object describing a session tracked by this object.\r\n         */\r\n        session: Context.ISession;\r\n\r\n        /**\r\n        * Adds a telemetry initializer to the collection. Telemetry initializers will be called one by one, \r\n        * in the order they were added, before the telemetry item is pushed for sending. \r\n        * If one of the telemetry initializers returns false or throws an error then the telemetry item will not be sent. \r\n        * If it returns true or doesn't return any value the event will be passed to the next telemetry initializer and\r\n        * send to the cloud (if not rejected by other initializers). \r\n        */\r\n        addTelemetryInitializer(telemetryInitializer: (envelope: Microsoft.ApplicationInsights.IEnvelope) => boolean | void);\r\n\r\n         /**\r\n         * Tracks telemetry object.\r\n         */\r\n        track(envelope: Microsoft.ApplicationInsights.IEnvelope);\r\n    }\r\n}","// THIS FILE WAS AUTOGENERATED\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    \r\n    /**\r\n     * Defines the level of severity for the event.\r\n     */\r\n    export enum SeverityLevel\r\n    {\r\n        Verbose = 0,\r\n        Information = 1,\r\n        Warning = 2,\r\n        Error = 3,\r\n        Critical = 4,\r\n    }\r\n}\r\n","/// <reference path=\"./IConfig.ts\" />\r\n/// <reference path=\"./ITelemetryContext.ts\" />\r\n/// <reference path=\"./Contracts/Generated/SeverityLevel.ts\" />\r\n\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n\r\n    \"use strict\";\r\n\r\n    export interface IAppInsights {\r\n\r\n        /*\r\n        * Config object used to initialize AppInsights\r\n        */\r\n        config: IConfig;\r\n\r\n        context: ITelemetryContext;\r\n\r\n        /*\r\n        * Initialization queue. Contains functions to run when appInsights initializes\r\n        */\r\n        queue: Array<() => void>;\r\n\r\n        /**\r\n        * Starts timing how long the user views a page or other item. Call this when the page opens. \r\n        * This method doesn't send any telemetry. Call {@link stopTrackTelemetry} to log the page when it closes.\r\n        * @param   name  A string that idenfities this item, unique within this HTML document. Defaults to the document title.\r\n        */\r\n        startTrackPage(name?: string);\r\n\r\n        /**\r\n        * Logs how long a page or other item was visible, after {@link startTrackPage}. Call this when the page closes. \r\n        * @param   name  The string you used as the name in startTrackPage. Defaults to the document title.\r\n        * @param   url   String - a relative or absolute URL that identifies the page or other item. Defaults to the window location.\r\n        * @param   properties  map[string, string] - additional data used to filter pages and metrics in the portal. Defaults to empty.\r\n        * @param   measurements    map[string, number] - metrics associated with this page, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n        */\r\n        stopTrackPage(name?: string, url?: string, properties?: { [name: string]: string; }, measurements?: { [name: string]: number; });\r\n\r\n        /**\r\n         * Logs that a page or other item was viewed. \r\n         * @param   name  The string you used as the name in startTrackPage. Defaults to the document title.\r\n         * @param   url   String - a relative or absolute URL that identifies the page or other item. Defaults to the window location.\r\n         * @param   properties  map[string, string] - additional data used to filter pages and metrics in the portal. Defaults to empty.\r\n         * @param   measurements    map[string, number] - metrics associated with this page, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         * @param   duration    number - the number of milliseconds it took to load the page. Defaults to undefined. If set to default value, page load time is calculated internally.\r\n         */\r\n        trackPageView(name?: string, url?: string, properties?: { [name: string]: string; }, measurements?: { [name: string]: number; }, duration?: number);\r\n\r\n        /**\r\n         * Start timing an extended event. Call {@link stopTrackEvent} to log the event when it ends.\r\n         * @param   name    A string that identifies this event uniquely within the document.\r\n         */\r\n        startTrackEvent(name: string);\r\n\r\n\r\n        /** \r\n         * Log an extended event that you started timing with {@link startTrackEvent}.\r\n         * @param   name    The string you used to identify this event in startTrackEvent.\r\n         * @param   properties  map[string, string] - additional data used to filter events and metrics in the portal. Defaults to empty.\r\n         * @param   measurements    map[string, number] - metrics associated with this event, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         */\r\n        stopTrackEvent(name: string, properties?: { [name: string]: string; }, measurements?: { [name: string]: number; });\r\n\r\n        /** \r\n        * Log a user action or other occurrence.\r\n        * @param   name    A string to identify this event in the portal.\r\n        * @param   properties  map[string, string] - additional data used to filter events and metrics in the portal. Defaults to empty.\r\n        * @param   measurements    map[string, number] - metrics associated with this event, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n        */\r\n        trackEvent(name: string, properties?: { [name: string]: string; }, measurements?: { [name: string]: number; });\r\n\r\n        /**\r\n         * Log a dependency call\r\n         * @param id    unique id, this is used by the backend o correlate server requests. Use Util.newId() to generate a unique Id.\r\n         * @param method    represents request verb (GET, POST, etc.)\r\n         * @param absoluteUrl   absolute url used to make the dependency request\r\n         * @param pathName  the path part of the absolute url\r\n         * @param totalTime total request time\r\n         * @param success   indicates if the request was sessessful\r\n         * @param resultCode    response code returned by the dependency request\r\n         */\r\n        trackDependency(id: string, method: string, absoluteUrl: string, pathName: string, totalTime: number, success: boolean, resultCode: number);\r\n\r\n        /**\r\n         * Log an exception you have caught.\r\n         * @param   exception   An Error from a catch clause, or the string error message.\r\n         * @param   handledAt   Not used\r\n         * @param   properties  map[string, string] - additional data used to filter events and metrics in the portal. Defaults to empty.\r\n         * @param   measurements    map[string, number] - metrics associated with this event, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         * @param   severityLevel   AI.SeverityLevel - severity level\r\n         */\r\n        trackException(exception: Error, handledAt?: string, properties?: { [name: string]: string; }, measurements?: { [name: string]: number; }, severityLevel?: AI.SeverityLevel);\r\n\r\n        /**\r\n         * Log a numeric value that is not associated with a specific event. Typically used to send regular reports of performance indicators.\r\n         * To send a single measurement, use just the first two parameters. If you take measurements very frequently, you can reduce the \r\n         * telemetry bandwidth by aggregating multiple measurements and sending the resulting average at intervals.\r\n         * @param   name    A string that identifies the metric.\r\n         * @param   average Number representing either a single measurement, or the average of several measurements.\r\n         * @param   sampleCount The number of measurements represented by the average. Defaults to 1.\r\n         * @param   min The smallest measurement in the sample. Defaults to the average.\r\n         * @param   max The largest measurement in the sample. Defaults to the average.\r\n         */\r\n        trackMetric(name: string, average: number, sampleCount?: number, min?: number, max?: number, properties?: { [name: string]: string; });\r\n\r\n        /**\r\n        * Log a diagnostic message. \r\n        * @param   message A message string \r\n        * @param   properties  map[string, string] - additional data used to filter traces in the portal. Defaults to empty.\r\n        * @param   severityLevel   AI.SeverityLevel - severity level\r\n        */\r\n        trackTrace(message: string, properties?: { [name: string]: string; }, severityLevel?: AI.SeverityLevel);\r\n\r\n\r\n        /**\r\n         * Immediately send all queued telemetry.\r\n         * @param {boolean} async - If flush should be call asynchronously\r\n         */\r\n        flush(async?: boolean);\r\n\r\n\r\n        /**\r\n        * Sets the autheticated user id and the account id in this session.\r\n        * User auth id and account id should be of type string. They should not contain commas, semi-colons, equal signs, spaces, or vertical-bars.\r\n        *   \r\n        * @param authenticatedUserId {string} - The authenticated user id. A unique and persistent string that represents each authenticated user in the service.\r\n        * @param accountId {string} - An optional string to represent the account associated with the authenticated user.\r\n        */\r\n        setAuthenticatedUserContext(authenticatedUserId: string, accountId?: string);\r\n\r\n\r\n        /**\r\n         * Clears the authenticated user id and the account id from the user context.\r\n         */\r\n        clearAuthenticatedUserContext();\r\n\r\n        /*\r\n        * Downloads and initializes AppInsights. You can override default script download location by specifying url property of `config`.\r\n        */\r\n        downloadAndSetup?(config: Microsoft.ApplicationInsights.IConfig): void;\r\n\r\n        /**\r\n         * The custom error handler for Application Insights\r\n         * @param {string} message - The error message\r\n         * @param {string} url - The url where the error was raised\r\n         * @param {number} lineNumber - The line number where the error was raised\r\n         * @param {number} columnNumber - The column number for the line where the error was raised\r\n         * @param {Error}  error - The Error object\r\n         */\r\n        _onerror(message: string, url: string, lineNumber: number, columnNumber: number, error: Error);\r\n    }\r\n}","module Microsoft.ApplicationInsights {\r\n\r\n    export enum LoggingSeverity {\r\n        /**\r\n         * Error will be sent as internal telemetry\r\n         */\r\n        CRITICAL = 0,\r\n\r\n        /**\r\n         * Error will NOT be sent as internal telemetry, and will only be shown in browser console\r\n         */\r\n        WARNING = 1\r\n    }\r\n\r\n    /**\r\n     * Internal message ID. Please create a new one for every conceptually different message. Please keep alphabetically ordered\r\n     */\r\n    export enum _InternalMessageId {\r\n        // Non user actionable\r\n        BrowserDoesNotSupportLocalStorage,\r\n        BrowserCannotReadLocalStorage,\r\n        BrowserCannotReadSessionStorage,\r\n        BrowserCannotWriteLocalStorage,\r\n        BrowserCannotWriteSessionStorage,\r\n        BrowserFailedRemovalFromLocalStorage,\r\n        BrowserFailedRemovalFromSessionStorage,\r\n        CannotSendEmptyTelemetry,\r\n        ClientPerformanceMathError,\r\n        ErrorParsingAISessionCookie,\r\n        ErrorPVCalc,\r\n        ExceptionWhileLoggingError,\r\n        FailedAddingTelemetryToBuffer,\r\n        FailedMonitorAjaxAbort,\r\n        FailedMonitorAjaxDur,\r\n        FailedMonitorAjaxOpen,\r\n        FailedMonitorAjaxRSC,\r\n        FailedMonitorAjaxSend,\r\n        FailedMonitorAjaxGetCorrelationHeader,\r\n        FailedToAddHandlerForOnBeforeUnload,\r\n        FailedToSendQueuedTelemetry,\r\n        FailedToReportDataLoss,\r\n        FlushFailed,\r\n        MessageLimitPerPVExceeded,\r\n        MissingRequiredFieldSpecification,\r\n        NavigationTimingNotSupported,\r\n        OnError,\r\n        SessionRenewalDateIsZero,\r\n        SenderNotInitialized,\r\n        StartTrackEventFailed,\r\n        StopTrackEventFailed,\r\n        StartTrackFailed,\r\n        StopTrackFailed,\r\n        TelemetrySampledAndNotSent,\r\n        TrackEventFailed,\r\n        TrackExceptionFailed,\r\n        TrackMetricFailed,\r\n        TrackPVFailed,\r\n        TrackPVFailedCalc,\r\n        TrackTraceFailed,\r\n        TransmissionFailed,\r\n        FailedToSetStorageBuffer,\r\n        FailedToRestoreStorageBuffer,\r\n        InvalidBackendResponse,\r\n        FailedToFixDepricatedValues,\r\n        InvalidDurationValue,\r\n\r\n        // User actionable\r\n        CannotSerializeObject,\r\n        CannotSerializeObjectNonSerializable,\r\n        CircularReferenceDetected,\r\n        ClearAuthContextFailed,\r\n        ExceptionTruncated,\r\n        IllegalCharsInName,\r\n        ItemNotInArray,\r\n        MaxAjaxPerPVExceeded,\r\n        MessageTruncated,\r\n        NameTooLong,\r\n        SampleRateOutOfRange,\r\n        SetAuthContextFailed,\r\n        SetAuthContextFailedAccountName,\r\n        StringValueTooLong,\r\n        StartCalledMoreThanOnce,\r\n        StopCalledWithoutStart,\r\n        TelemetryInitializerFailed,\r\n        TrackArgumentsNotSpecified,\r\n        UrlTooLong,\r\n        SessionStorageBufferFull,\r\n        CannotAccessCookie,\r\n        IdTooLong,\r\n    }\r\n\r\n    export class _InternalLogMessage {\r\n        public message: string;\r\n        public messageId: _InternalMessageId;\r\n\r\n        /**\r\n         * For user non actionable traces use AI Internal prefix.\r\n         */\r\n        private static AiNonUserActionablePrefix = \"AI (Internal): \";\r\n\r\n        /**\r\n         * Prefix of the traces in portal.\r\n         */\r\n        private static AiUserActionablePrefix = \"AI: \";\r\n\r\n        constructor(msgId: _InternalMessageId, msg: string, isUserAct = false, properties?: Object) {\r\n\r\n            this.messageId = msgId;\r\n            this.message =\r\n                (isUserAct ? _InternalLogMessage.AiUserActionablePrefix : _InternalLogMessage.AiNonUserActionablePrefix) +\r\n                _InternalMessageId[msgId].toString();\r\n\r\n            var diagnosticText =\r\n                (msg ? \" message:\" + _InternalLogMessage.sanitizeDiagnosticText(msg) : \"\") +\r\n                (properties ? \" props:\" + _InternalLogMessage.sanitizeDiagnosticText(JSON.stringify(properties)) : \"\");\r\n\r\n            this.message += diagnosticText;\r\n        }\r\n\r\n        private static sanitizeDiagnosticText(text: string) {\r\n            return \"\\\"\" + text.replace(/\\\"/g, \"\") + \"\\\"\";\r\n        }\r\n    }\r\n\r\n    export class _InternalLogging {\r\n\r\n        /**\r\n        *  Session storage key for the prefix for the key indicating message type already logged\r\n        */\r\n        private static AIInternalMessagePrefix: string = \"AITR_\";\r\n\r\n        /**\r\n         * When this is true the SDK will throw exceptions to aid in debugging.\r\n         */\r\n        public static enableDebugExceptions = () => false;\r\n\r\n        /**\r\n         * When this is true the SDK will log more messages to aid in debugging.\r\n         */\r\n        public static verboseLogging = () => false;\r\n\r\n        /**\r\n         * The internal logging queue\r\n         */\r\n        public static queue: Array<_InternalLogMessage> = [];\r\n\r\n        /**\r\n         * The maximum number of internal messages allowed to be sent per page view\r\n         */\r\n        private static MAX_INTERNAL_MESSAGE_LIMIT = 25;\r\n\r\n        /**\r\n         * Count of internal messages sent\r\n         */\r\n        private static _messageCount = 0;\r\n\r\n        /**\r\n         * Holds information about what message types were already logged to console or sent to server.\r\n         */\r\n        private static _messageLogged: { [type: string]: boolean } = {};\r\n\r\n        /**\r\n         * This method will throw exceptions in debug mode or attempt to log the error as a console warning.\r\n         * @param severity {LoggingSeverity} - The severity of the log message\r\n         * @param message {_InternalLogMessage} - The log message.\r\n         */\r\n        public static throwInternal(severity: LoggingSeverity, msgId: _InternalMessageId, msg: string, properties?: Object, isUserAct = false) {\r\n            let message = new _InternalLogMessage(msgId, msg, isUserAct, properties);\r\n\r\n            if (this.enableDebugExceptions()) {\r\n                throw message;\r\n            } else {\r\n                if (typeof (message) !== \"undefined\" && !!message) {\r\n                    if (typeof (message.message) !== \"undefined\") {\r\n                        if (isUserAct) {\r\n                            // check if this message type was already logged to console for this page view and if so, don't log it again\r\n                            var messageKey = _InternalMessageId[message.messageId];\r\n\r\n                            if (!this._messageLogged[messageKey] || this.verboseLogging()) {\r\n                                this.warnToConsole(message.message);\r\n                                this._messageLogged[messageKey] = true;\r\n                            }\r\n                        } else {\r\n                            // don't log internal AI traces in the console, unless the verbose logging is enabled\r\n                            if (this.verboseLogging()) {\r\n                                this.warnToConsole(message.message);\r\n                            }\r\n                        }\r\n\r\n                        this.logInternalMessage(severity, message);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * This will write a warning to the console if possible\r\n         * @param message {string} - The warning message\r\n         */\r\n        public static warnToConsole(message: string) {\r\n            if (typeof console !== \"undefined\" && !!console) {\r\n                if (typeof console.warn === \"function\") {\r\n                    console.warn(message);\r\n                } else if (typeof console.log === \"function\") {\r\n                    console.log(message);\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Resets the internal message count\r\n         */\r\n        public static resetInternalMessageCount(): void {\r\n            this._messageCount = 0;\r\n            this._messageLogged = {};\r\n        }\r\n\r\n        /**\r\n         * Clears the list of records indicating that internal message type was already logged\r\n         */\r\n        public static clearInternalMessageLoggedTypes(): void {\r\n            if (Util.canUseSessionStorage()) {\r\n                var sessionStorageKeys = Util.getSessionStorageKeys();\r\n                for (var i = 0; i < sessionStorageKeys.length; i++) {\r\n                    if (sessionStorageKeys[i].indexOf(_InternalLogging.AIInternalMessagePrefix) === 0) {\r\n                        Util.removeSessionStorage(sessionStorageKeys[i]);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Sets the limit for the number of internal events before they are throttled\r\n         * @param limit {number} - The throttle limit to set for internal events\r\n         */\r\n        public static setMaxInternalMessageLimit(limit: number): void {\r\n            if (!limit) {\r\n                throw new Error('limit cannot be undefined.');\r\n            }\r\n\r\n            this.MAX_INTERNAL_MESSAGE_LIMIT = limit;\r\n        }\r\n\r\n        /**\r\n         * Logs a message to the internal queue.\r\n         * @param severity {LoggingSeverity} - The severity of the log message\r\n         * @param message {_InternalLogMessage} - The message to log.\r\n         */\r\n        private static logInternalMessage(severity: LoggingSeverity, message: _InternalLogMessage): void {\r\n            if (this._areInternalMessagesThrottled()) {\r\n                return;\r\n            }\r\n\r\n            // check if this message type was already logged for this session and if so, don't log it again\r\n            var logMessage = true;\r\n            var messageKey = _InternalLogging.AIInternalMessagePrefix + _InternalMessageId[message.messageId];\r\n\r\n            if (Util.canUseSessionStorage()) {\r\n                var internalMessageTypeLogRecord = Util.getSessionStorage(messageKey);\r\n                if (internalMessageTypeLogRecord) {\r\n                    logMessage = false;\r\n                } else {\r\n                    Util.setSessionStorage(messageKey, \"1\");\r\n                }\r\n            } else {\r\n                // if the session storage is not available, limit to only one message type per page view\r\n                if (this._messageLogged[messageKey]) {\r\n                    logMessage = false;\r\n                } else {\r\n                    this._messageLogged[messageKey] = true;\r\n                }\r\n            }\r\n\r\n            if (logMessage) {\r\n                // Push the event in the internal queue\r\n                if (this.verboseLogging() || severity === LoggingSeverity.CRITICAL) {\r\n                    this.queue.push(message);\r\n                    this._messageCount++;\r\n                }\r\n\r\n                // When throttle limit reached, send a special event\r\n                if (this._messageCount == this.MAX_INTERNAL_MESSAGE_LIMIT) {\r\n                    var throttleLimitMessage = \"Internal events throttle limit per PageView reached for this app.\";\r\n                    var throttleMessage = new _InternalLogMessage(_InternalMessageId.MessageLimitPerPVExceeded, throttleLimitMessage, false);\r\n\r\n                    this.queue.push(throttleMessage);\r\n                    this.warnToConsole(throttleLimitMessage);\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Indicates whether the internal events are throttled\r\n         */\r\n        private static _areInternalMessagesThrottled(): boolean {\r\n            return this._messageCount >= this.MAX_INTERNAL_MESSAGE_LIMIT;\r\n        }\r\n    }\r\n}","/// <reference path=\"./Logging.ts\" />\r\nmodule Microsoft.ApplicationInsights {\r\n\r\n    /**\r\n    * Type of storage to differentiate between local storage and session storage\r\n    */\r\n    enum StorageType {\r\n        LocalStorage,\r\n        SessionStorage\r\n    }\r\n\r\n    export class Util {\r\n        private static document: any = typeof document !== \"undefined\" ? document : {};\r\n        private static _canUseCookies: boolean = undefined;\r\n        private static _canUseLocalStorage: boolean = undefined;\r\n        private static _canUseSessionStorage: boolean = undefined;\r\n        public static NotSpecified = \"not_specified\";\r\n\r\n        /*\r\n         * Force the SDK not to use local and session storage\r\n        */\r\n        public static disableStorage() {\r\n            Util._canUseLocalStorage = false;\r\n            Util._canUseSessionStorage = false;\r\n        }\r\n\r\n        /**\r\n         * Gets the localStorage object if available\r\n         * @return {Storage} - Returns the storage object if available else returns null\r\n         */\r\n        private static _getLocalStorageObject(): Storage {\r\n            if (Util.canUseLocalStorage()) {\r\n                return Util._getVerifiedStorageObject(StorageType.LocalStorage);\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        /**\r\n         * Tests storage object (localStorage or sessionStorage) to verify that it is usable\r\n         * More details here: https://mathiasbynens.be/notes/localstorage-pattern\r\n         * @param storageType Type of storage\r\n         * @return {Storage} Returns storage object verified that it is usable\r\n         */\r\n        private static _getVerifiedStorageObject(storageType: StorageType): Storage {\r\n            var storage: Storage = null;\r\n            var fail: boolean;\r\n            var uid;\r\n            try {\r\n                uid = new Date;\r\n                storage = storageType === StorageType.LocalStorage ? window.localStorage : window.sessionStorage;\r\n                storage.setItem(uid, uid);\r\n                fail = storage.getItem(uid) != uid;\r\n                storage.removeItem(uid);\r\n                if (fail) {\r\n                    storage = null;\r\n                }\r\n            } catch (exception) {\r\n                storage = null;\r\n            }\r\n\r\n            return storage;\r\n        }\r\n\r\n        /**\r\n         *  Check if the browser supports local storage.\r\n         *\r\n         *  @returns {boolean} True if local storage is supported.\r\n         */\r\n        public static canUseLocalStorage(): boolean {\r\n            if (Util._canUseLocalStorage === undefined) {\r\n                Util._canUseLocalStorage = !!Util._getVerifiedStorageObject(StorageType.LocalStorage);\r\n            }\r\n\r\n            return Util._canUseLocalStorage;\r\n        }\r\n\r\n        /**\r\n         *  Get an object from the browser's local storage\r\n         *\r\n         *  @param {string} name - the name of the object to get from storage\r\n         *  @returns {string} The contents of the storage object with the given name. Null if storage is not supported.\r\n         */\r\n        public static getStorage(name: string): string {\r\n            var storage = Util._getLocalStorageObject();\r\n            if (storage !== null) {\r\n                try {\r\n                    return storage.getItem(name);\r\n                } catch (e) {\r\n                    Util._canUseLocalStorage = false;\r\n\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.BrowserCannotReadLocalStorage,\r\n                        \"Browser failed read of local storage. \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        /**\r\n         *  Set the contents of an object in the browser's local storage\r\n         *\r\n         *  @param {string} name - the name of the object to set in storage\r\n         *  @param {string} data - the contents of the object to set in storage\r\n         *  @returns {boolean} True if the storage object could be written.\r\n         */\r\n        public static setStorage(name: string, data: string): boolean {\r\n            var storage = Util._getLocalStorageObject();\r\n            if (storage !== null) {\r\n                try {\r\n                    storage.setItem(name, data);\r\n                    return true;\r\n                } catch (e) {\r\n                    Util._canUseLocalStorage = false;\r\n\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.BrowserCannotWriteLocalStorage,\r\n                        \"Browser failed write to local storage. \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n        /**\r\n         *  Remove an object from the browser's local storage\r\n         *\r\n         *  @param {string} name - the name of the object to remove from storage\r\n         *  @returns {boolean} True if the storage object could be removed.\r\n         */\r\n        public static removeStorage(name: string): boolean {\r\n            var storage = Util._getLocalStorageObject();\r\n            if (storage !== null) {\r\n                try {\r\n                    storage.removeItem(name);\r\n                    return true;\r\n                } catch (e) {\r\n                    Util._canUseLocalStorage = false;\r\n\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.BrowserFailedRemovalFromLocalStorage,\r\n                        \"Browser failed removal of local storage item. \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n        /**\r\n         * Gets the sessionStorage object if available\r\n         * @return {Storage} - Returns the storage object if available else returns null\r\n         */\r\n        private static _getSessionStorageObject(): Storage {\r\n            if (Util.canUseSessionStorage()) {\r\n                return Util._getVerifiedStorageObject(StorageType.SessionStorage);\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        /**\r\n         *  Check if the browser supports session storage.\r\n         *\r\n         *  @returns {boolean} True if session storage is supported.\r\n         */\r\n        public static canUseSessionStorage(): boolean {\r\n            if (Util._canUseSessionStorage === undefined) {\r\n                Util._canUseSessionStorage = !!Util._getVerifiedStorageObject(StorageType.SessionStorage);\r\n            }\r\n\r\n            return Util._canUseSessionStorage;\r\n        }\r\n\r\n        /**\r\n         *  Gets the list of session storage keys\r\n         *\r\n         *  @returns {string[]} List of session storage keys\r\n         */\r\n        public static getSessionStorageKeys(): string[] {\r\n            var keys = [];\r\n\r\n            if (Util.canUseSessionStorage()) {\r\n                for (var key in window.sessionStorage) {\r\n                    keys.push(key);\r\n                }\r\n            }\r\n            return keys;\r\n        }\r\n\r\n        /**\r\n         *  Get an object from the browser's session storage\r\n         *\r\n         *  @param {string} name - the name of the object to get from storage\r\n         *  @returns {string} The contents of the storage object with the given name. Null if storage is not supported.\r\n         */\r\n        public static getSessionStorage(name: string): string {\r\n            var storage = Util._getSessionStorageObject();\r\n            if (storage !== null) {\r\n                try {\r\n                    return storage.getItem(name);\r\n                } catch (e) {\r\n                    Util._canUseSessionStorage = false;\r\n\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.BrowserCannotReadSessionStorage,\r\n                        \"Browser failed read of session storage. \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        /**\r\n         *  Set the contents of an object in the browser's session storage\r\n         *\r\n         *  @param {string} name - the name of the object to set in storage\r\n         *  @param {string} data - the contents of the object to set in storage\r\n         *  @returns {boolean} True if the storage object could be written.\r\n         */\r\n        public static setSessionStorage(name: string, data: string): boolean {\r\n            var storage = Util._getSessionStorageObject();\r\n            if (storage !== null) {\r\n                try {\r\n                    storage.setItem(name, data);\r\n                    return true;\r\n                } catch (e) {\r\n                    Util._canUseSessionStorage = false;\r\n\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.BrowserCannotWriteSessionStorage,\r\n                        \"Browser failed write to session storage. \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n        /**\r\n         *  Remove an object from the browser's session storage\r\n         *\r\n         *  @param {string} name - the name of the object to remove from storage\r\n         *  @returns {boolean} True if the storage object could be removed.\r\n         */\r\n        public static removeSessionStorage(name: string): boolean {\r\n            var storage = Util._getSessionStorageObject();\r\n            if (storage !== null) {\r\n                try {\r\n                    storage.removeItem(name);\r\n                    return true;\r\n                } catch (e) {\r\n                    Util._canUseSessionStorage = false;\r\n\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.BrowserFailedRemovalFromSessionStorage,\r\n                        \"Browser failed removal of session storage item. \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n        /*\r\n         * Force the SDK not to store and read any data from cookies\r\n         */\r\n        public static disableCookies() {\r\n            Util._canUseCookies = false;\r\n        }\r\n\r\n        /*\r\n         * helper method to tell if document.cookie object is available\r\n         */\r\n        public static canUseCookies(): any {\r\n            if (Util._canUseCookies === undefined) {\r\n                Util._canUseCookies = false;\r\n\r\n                try {\r\n                    Util._canUseCookies = Util.document.cookie !== undefined;\r\n                } catch (e) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.CannotAccessCookie,\r\n                        \"Cannot access document.cookie - \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                };\r\n            }\r\n\r\n            return Util._canUseCookies;\r\n        }\r\n\r\n        /**\r\n         * helper method to set userId and sessionId cookie\r\n         */\r\n        public static setCookie(name, value, domain?) {\r\n            var domainAttrib = \"\";\r\n            var secureAttrib = \"\";\r\n\r\n            if (domain) {\r\n                domainAttrib = \";domain=\" + domain;\r\n            }\r\n\r\n            if (Util.document.location && Util.document.location.protocol === \"https:\") {\r\n                secureAttrib = \";secure\";\r\n            }\r\n\r\n            if (Util.canUseCookies()) {\r\n                Util.document.cookie = name + \"=\" + value + domainAttrib + \";path=/\" + secureAttrib;\r\n            }\r\n        }\r\n\r\n        public static stringToBoolOrDefault(str: any, defaultValue = false): boolean {\r\n            if (str === undefined || str === null) {\r\n                return defaultValue;\r\n            }\r\n\r\n            return str.toString().toLowerCase() === \"true\";\r\n        }\r\n\r\n        /**\r\n         * helper method to access userId and sessionId cookie\r\n         */\r\n        public static getCookie(name) {\r\n            if (!Util.canUseCookies()) {\r\n                return;\r\n            }\r\n\r\n            var value = \"\";\r\n            if (name && name.length) {\r\n                var cookieName = name + \"=\";\r\n                var cookies = Util.document.cookie.split(\";\");\r\n                for (var i = 0; i < cookies.length; i++) {\r\n                    var cookie = cookies[i];\r\n                    cookie = Util.trim(cookie);\r\n                    if (cookie && cookie.indexOf(cookieName) === 0) {\r\n                        value = cookie.substring(cookieName.length, cookies[i].length);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return value;\r\n        }\r\n\r\n        /**\r\n         * Deletes a cookie by setting it's expiration time in the past.\r\n         * @param name - The name of the cookie to delete.\r\n         */\r\n        public static deleteCookie(name: string) {\r\n            if (Util.canUseCookies()) {\r\n                // Setting the expiration date in the past immediately removes the cookie\r\n                Util.document.cookie = name + \"=;path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;\";\r\n            }\r\n        }\r\n\r\n        /**\r\n         * helper method to trim strings (IE8 does not implement String.prototype.trim)\r\n         */\r\n        public static trim(str: any): string {\r\n            if (typeof str !== \"string\") return str;\r\n            return str.replace(/^\\s+|\\s+$/g, \"\");\r\n        }\r\n\r\n        /**\r\n         * generate random id string\r\n         */\r\n        public static newId(): string {\r\n            var base64chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\r\n\r\n            var result = \"\";\r\n            var random = Math.random() * 1073741824; //5 symbols in base64, almost maxint\r\n\r\n            while (random > 0) {\r\n                var char = base64chars.charAt(random % 64);\r\n                result += char;\r\n                random = Math.floor(random / 64);\r\n            }\r\n            return result;\r\n        }\r\n\r\n        /**\r\n         * Check if an object is of type Array\r\n         */\r\n        public static isArray(obj: any): boolean {\r\n            return Object.prototype.toString.call(obj) === \"[object Array]\";\r\n        }\r\n\r\n        /**\r\n         * Check if an object is of type Error\r\n         */\r\n        public static isError(obj: any): boolean {\r\n            return Object.prototype.toString.call(obj) === \"[object Error]\";\r\n        }\r\n\r\n        /**\r\n         * Check if an object is of type Date\r\n         */\r\n        public static isDate(obj: any): boolean {\r\n            return Object.prototype.toString.call(obj) === \"[object Date]\";\r\n        }\r\n\r\n        /**\r\n         * Convert a date to I.S.O. format in IE8\r\n         */\r\n        public static toISOStringForIE8(date: Date) {\r\n            if (Util.isDate(date)) {\r\n                if (Date.prototype.toISOString) {\r\n                    return date.toISOString();\r\n                } else {\r\n                    const pad = function(number) {\r\n                        var r = String(number);\r\n                        if (r.length === 1) {\r\n                            r = \"0\" + r;\r\n                        }\r\n\r\n                        return r;\r\n                    }\r\n\r\n                    return date.getUTCFullYear()\r\n                        + \"-\" + pad(date.getUTCMonth() + 1)\r\n                        + \"-\" + pad(date.getUTCDate())\r\n                        + \"T\" + pad(date.getUTCHours())\r\n                        + \":\" + pad(date.getUTCMinutes())\r\n                        + \":\" + pad(date.getUTCSeconds())\r\n                        + \".\" + String((date.getUTCMilliseconds() / 1000).toFixed(3)).slice(2, 5)\r\n                        + \"Z\";\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Gets IE version if we are running on IE, or null otherwise\r\n         */\r\n        public static getIEVersion(userAgentStr: string = null): number {\r\n            var myNav = userAgentStr ? userAgentStr.toLowerCase() : navigator.userAgent.toLowerCase();\r\n            return (myNav.indexOf('msie') != -1) ? parseInt(myNav.split('msie')[1]) : null;\r\n        }\r\n\r\n        /**\r\n         * Convert ms to c# time span format\r\n         */\r\n        public static msToTimeSpan(totalms: number): string {\r\n            if (isNaN(totalms) || totalms < 0) {\r\n                totalms = 0;\r\n            }\r\n\r\n            totalms = Math.round(totalms);\r\n\r\n            var ms = \"\" + totalms % 1000;\r\n            var sec = \"\" + Math.floor(totalms / 1000) % 60;\r\n            var min = \"\" + Math.floor(totalms / (1000 * 60)) % 60;\r\n            var hour = \"\" + Math.floor(totalms / (1000 * 60 * 60)) % 24;\r\n            var days = Math.floor(totalms / (1000 * 60 * 60 * 24));\r\n\r\n            ms = ms.length === 1 ? \"00\" + ms : ms.length === 2 ? \"0\" + ms : ms;\r\n            sec = sec.length < 2 ? \"0\" + sec : sec;\r\n            min = min.length < 2 ? \"0\" + min : min;\r\n            hour = hour.length < 2 ? \"0\" + hour : hour;\r\n\r\n            return (days > 0 ? days + \".\" : \"\") + hour + \":\" + min + \":\" + sec + \".\" + ms;\r\n        }\r\n\r\n        /**\t\t\r\n        * Checks if error has no meaningful data inside. Ususally such errors are received by window.onerror when error\t\t\r\n        * happens in a script from other domain (cross origin, CORS).\t\t\r\n        */\r\n        public static isCrossOriginError(message: string, url: string, lineNumber: number, columnNumber: number, error: Error): boolean {\r\n            return (message === \"Script error.\" || message === \"Script error\") && !error;\r\n        }\r\n\r\n        /**\r\n        * Returns string representation of an object suitable for diagnostics logging.\r\n        */\r\n        public static dump(object: any): string {\r\n            var objectTypeDump: string = Object.prototype.toString.call(object);\r\n            var propertyValueDump: string = JSON.stringify(object);\r\n            if (objectTypeDump === \"[object Error]\") {\r\n                propertyValueDump = \"{ stack: '\" + object.stack + \"', message: '\" + object.message + \"', name: '\" + object.name + \"'\";\r\n            }\r\n\r\n            return objectTypeDump + propertyValueDump;\r\n        }\r\n\r\n        /**\r\n        * Returns the name of object if it's an Error. Otherwise, returns empty string.\r\n        */\r\n        public static getExceptionName(object: any): string {\r\n            var objectTypeDump: string = Object.prototype.toString.call(object);\r\n            if (objectTypeDump === \"[object Error]\") {\r\n                return object.name;\r\n            }\r\n            return \"\";\r\n        }\r\n\r\n        /**\r\n         * Adds an event handler for the specified event\r\n         * @param eventName {string} - The name of the event\r\n         * @param callback {any} - The callback function that needs to be executed for the given event \r\n         * @return {boolean} - true if the handler was successfully added\r\n         */\r\n        public static addEventHandler(eventName: string, callback: any): boolean {\r\n            if (!window || typeof eventName !== 'string' || typeof callback !== 'function') {\r\n                return false;\r\n            }\r\n\r\n            // Create verb for the event\r\n            var verbEventName = 'on' + eventName;\r\n\r\n            // check if addEventListener is available\r\n            if (window.addEventListener) {\r\n                window.addEventListener(eventName, callback, false);\r\n            } else if (window[\"attachEvent\"]) { // For older browsers\r\n                window[\"attachEvent\"](verbEventName, callback);\r\n            } else { // if all else fails\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        }\r\n\r\n        /**\r\n         * Tells if a browser supports a Beacon API\r\n         */\r\n        public static IsBeaconApiSupported(): boolean {\r\n            return ('sendBeacon' in navigator && (<any>navigator).sendBeacon);\r\n        }\r\n    }\r\n\r\n    export class UrlHelper {\r\n        private static document: any = typeof document !== \"undefined\" ? document : {};\r\n        private static htmlAnchorElement: HTMLAnchorElement;\r\n\r\n        public static parseUrl(url): HTMLAnchorElement {\r\n            if (!UrlHelper.htmlAnchorElement) {\r\n                UrlHelper.htmlAnchorElement = !!UrlHelper.document.createElement ? UrlHelper.document.createElement('a') : {};\r\n            }\r\n\r\n            UrlHelper.htmlAnchorElement.href = url;\r\n\r\n            return UrlHelper.htmlAnchorElement;\r\n        }\r\n\r\n        public static getAbsoluteUrl(url): string {\r\n            var result: string;\r\n            var a = UrlHelper.parseUrl(url);\r\n            if (a) {\r\n                result = a.href;\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        public static getPathName(url): string {\r\n            var result: string;\r\n            var a = UrlHelper.parseUrl(url);\r\n            if (a) {\r\n                result = a.pathname;\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        public static getCompleteUrl(method: string, absoluteUrl: string) {\r\n            if (method) {\r\n                return method.toUpperCase() + \" \" + absoluteUrl;\r\n            } else {\r\n                return absoluteUrl;\r\n            }\r\n        }\r\n    }\r\n\r\n    export class CorrelationIdHelper {\r\n        public static correlationIdPrefix = \"cid-v1:\";\r\n\r\n        /**\r\n        * Checks if a request url is not on a excluded domain list and if it is safe to add correlation headers\r\n        */\r\n        public static canIncludeCorrelationHeader(config: IConfig, requestUrl: string) {\r\n            if (config && config.disableCorrelationHeaders) {\r\n                return false;\r\n            }\r\n\r\n            let excludedDomains = config && config.correlationHeaderExcludedDomains;\r\n            if (!excludedDomains || excludedDomains.length == 0 || !requestUrl) {\r\n                return true;\r\n            }\r\n\r\n            for (let i = 0; i < excludedDomains.length; i++) {\r\n                let regex = new RegExp(excludedDomains[i].replace(/\\./g, \"\\.\").replace(/\\*/g, \".*\"));\r\n                if (regex.test(UrlHelper.parseUrl(requestUrl).host)) {\r\n                    return false;\r\n                }\r\n            }\r\n\r\n            return true;\r\n        }\r\n\r\n        /**\r\n        * Combines target appId and target role name from response header.\r\n        */\r\n        public static getCorrelationContext(responseHeader: string) {\r\n            if (responseHeader) {\r\n                const correlationId = CorrelationIdHelper.getCorrelationContextValue(responseHeader, RequestHeaders.requestContextTargetKey);\r\n                if (correlationId && correlationId !== CorrelationIdHelper.correlationIdPrefix) {\r\n                    return correlationId;\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n        * Gets key from correlation response header\r\n        */\r\n        public static getCorrelationContextValue(responseHeader: string, key: string) {\r\n            if (responseHeader) {\r\n                const keyValues = responseHeader.split(\",\");\r\n                for (let i = 0; i < keyValues.length; ++i) {\r\n                    const keyValue = keyValues[i].split(\"=\");\r\n                    if (keyValue.length == 2 && keyValue[0] == key) {\r\n                        return keyValue[1];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../JavaScriptSDK.Interfaces/Telemetry/ISerializable.ts\" />\r\n/// <reference path=\"Logging.ts\" />\r\n/// <reference path=\"Util.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Enum is used in aiDataContract to describe how fields are serialized. \r\n     * For instance: (Fieldtype.Required | FieldType.Array) will mark the field as required and indicate it's an array\r\n     */\r\n    export enum FieldType { Default = 0, Required = 1, Array = 2, Hidden = 4 };\r\n\r\n    export class Serializer {\r\n\r\n        /**\r\n         * Serializes the current object to a JSON string.\r\n         */\r\n        public static serialize(input: ISerializable): string {\r\n            var output = Serializer._serializeObject(input, \"root\");\r\n            return JSON.stringify(output);\r\n        }\r\n\r\n        private static _serializeObject(source: ISerializable, name: string): any {\r\n            var circularReferenceCheck = \"__aiCircularRefCheck\";\r\n            var output = {};\r\n\r\n            if (!source) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL, _InternalMessageId.CannotSerializeObject, \"cannot serialize object because it is null or undefined\", { name: name }, true);\r\n                return output;\r\n            }\r\n\r\n            if (source[circularReferenceCheck]) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.WARNING, _InternalMessageId.CircularReferenceDetected, \"Circular reference detected while serializing object\", { name: name }, true);\r\n                return output;\r\n            }\r\n\r\n            if (!source.aiDataContract) {\r\n                // special case for measurements/properties/tags\r\n                if (name === \"measurements\") {\r\n                    output = Serializer._serializeStringMap(source, \"number\", name);\r\n                } else if (name === \"properties\") {\r\n                    output = Serializer._serializeStringMap(source, \"string\", name);\r\n                } else if (name === \"tags\") {\r\n                    output = Serializer._serializeStringMap(source, \"string\", name);\r\n                } else if (Util.isArray(source)) {\r\n                    output = Serializer._serializeArray(<any>source, name);\r\n                } else {\r\n                    _InternalLogging.throwInternal(LoggingSeverity.WARNING, _InternalMessageId.CannotSerializeObjectNonSerializable, \"Attempting to serialize an object which does not implement ISerializable\", { name: name }, true);\r\n\r\n                    try {\r\n                        // verify that the object can be stringified\r\n                        JSON.stringify(source);\r\n                        output = source;\r\n                    } catch (e) {\r\n                        // if serialization fails return an empty string\r\n                        _InternalLogging.throwInternal(LoggingSeverity.CRITICAL, _InternalMessageId.CannotSerializeObject, (e && typeof e.toString === 'function') ? e.toString() : \"Error serializing object\", null, true);\r\n                    }\r\n                }\r\n\r\n                return output;\r\n            }\r\n            \r\n            source[circularReferenceCheck] = true;\r\n            for (var field in source.aiDataContract) {\r\n\r\n                var contract = source.aiDataContract[field];\r\n                var isRequired = (typeof contract === \"function\") ? (contract() & FieldType.Required) : (contract & FieldType.Required);\r\n                var isHidden = (typeof contract === \"function\") ? (contract() & FieldType.Hidden) : (contract & FieldType.Hidden);\r\n                var isArray = contract & FieldType.Array;\r\n\r\n                var isPresent = source[field] !== undefined;\r\n                var isObject = typeof source[field] === \"object\" && source[field] !== null;\r\n\r\n                if (isRequired && !isPresent && !isArray) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.CRITICAL,\r\n                        _InternalMessageId.MissingRequiredFieldSpecification,\r\n                        \"Missing required field specification. The field is required but not present on source\",\r\n                        { field: field, name: name });\r\n\r\n                    // If not in debug mode, continue and hope the error is permissible\r\n                    continue;\r\n                }\r\n\r\n                if (isHidden) {\r\n                    // Don't serialize hidden fields\r\n                    continue;\r\n                }\r\n\r\n                var value;\r\n                if (isObject) {\r\n                    if (isArray) {\r\n                        // special case; resurse on each object in the source array\r\n                        value = Serializer._serializeArray(source[field], field);\r\n                    } else {\r\n                        // recurse on the source object in this field\r\n                        value = Serializer._serializeObject(source[field], field);\r\n                    }\r\n                } else {\r\n                    // assign the source field to the output even if undefined or required\r\n                    value = source[field];\r\n                }\r\n\r\n                // only emit this field if the value is defined\r\n                if (value !== undefined) {\r\n                    output[field] = value;\r\n                }\r\n            }\r\n\r\n            delete source[circularReferenceCheck];\r\n            return output;\r\n        }\r\n\r\n        private static _serializeArray(sources: Array<ISerializable>, name: string): Array<any> {\r\n            var output = undefined;\r\n\r\n            if (!!sources) {\r\n                if (!Util.isArray(sources)) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.CRITICAL,\r\n                        _InternalMessageId.ItemNotInArray,\r\n                        \"This field was specified as an array in the contract but the item is not an array.\\r\\n\",\r\n                        { name: name }, true);\r\n                } else {\r\n                    output = [];\r\n                    for (var i = 0; i < sources.length; i++) {\r\n                        var source = sources[i];\r\n                        var item = Serializer._serializeObject(source, name + \"[\" + i + \"]\");\r\n                        output.push(item);\r\n                    }\r\n                }\r\n            }\r\n\r\n            return output;\r\n        }\r\n\r\n        private static _serializeStringMap(map, expectedType, name) {\r\n            var output = undefined;\r\n            if (map) {\r\n                output = {};\r\n                for (var field in map) {\r\n                    var value = map[field];\r\n                    if (expectedType === \"string\") {\r\n                        if (value === undefined) {\r\n                            output[field] = \"undefined\";\r\n                        } else if (value === null) {\r\n                            output[field] = \"null\";\r\n                        } else if (!value.toString) {\r\n                            output[field] = \"invalid field: toString() is not defined.\";\r\n                        }\r\n                        else {\r\n                            output[field] = value.toString();\r\n                        }\r\n                    }\r\n                    else if (expectedType === \"number\") {\r\n                        if (value === undefined) {\r\n                            output[field] = \"undefined\";\r\n                        } else if (value === null) {\r\n                            output[field] = \"null\";\r\n                        } else {\r\n                            var num = parseFloat(value);\r\n                            if (isNaN(num)) {\r\n                                output[field] = \"NaN\";\r\n                            }\r\n                            else {\r\n                                output[field] = num;\r\n                            }\r\n                        }\r\n                    }\r\n                    else {\r\n                        output[field] = \"invalid field: \" + name + \" is of unknown type.\";\r\n                        _InternalLogging.throwInternal(LoggingSeverity.CRITICAL, output[field], null, true);\r\n                    }\r\n                }\r\n            }\r\n\r\n            return output;\r\n        }\r\n    }\r\n}","/// <reference path=\"../../../JavaScriptSDK.Interfaces/Contracts/Generated/Envelope.ts\" />\r\n/// <reference path=\"../../../JavaScriptSDK.Interfaces/Contracts/Generated/Base.ts\" />\r\n/// <reference path=\"../../Util.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry.Common {\r\n    \"use strict\";\r\n    export class Envelope extends Microsoft.Telemetry.Envelope implements IEnvelope {\r\n\r\n        /**\r\n         * The data contract for serializing this object.\r\n         */\r\n        public aiDataContract;\r\n\r\n        /**\r\n         * Constructs a new instance of telemetry data.\r\n         */\r\n        constructor(data: Microsoft.Telemetry.Base, name: string) {\r\n            super();\r\n\r\n            this.name = Common.DataSanitizer.sanitizeString(name) || Util.NotSpecified;\r\n            this.data = data;\r\n            this.time = Util.toISOStringForIE8(new Date());\r\n\r\n            this.aiDataContract = {\r\n                time: FieldType.Required,\r\n                iKey: FieldType.Required,\r\n                name: FieldType.Required,\r\n                sampleRate: () => {\r\n                    return (this.sampleRate == 100) ? FieldType.Hidden : FieldType.Required;\r\n                },\r\n                tags: FieldType.Required,\r\n                data: FieldType.Required\r\n            };\r\n        }\r\n    }\r\n}","/// <reference path=\"../../../JavaScriptSDK.Interfaces/Contracts/Generated/Base.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry.Common {\r\n    \"use strict\";\r\n\r\n    export class Base extends Microsoft.Telemetry.Base implements ISerializable {\r\n        \r\n        /**\r\n         * The data contract for serializing this object.\r\n         */\r\n        public aiDataContract = {};\r\n    }\r\n}","// THIS FILE WAS AUTOGENERATED\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    export class ContextTagKeys\r\n    {\r\n        \r\n        /**\r\n         * Application version. Information in the application context fields is always about the application that is sending the telemetry.\r\n         */\r\n        public applicationVersion: string;\r\n        \r\n        /**\r\n         * Application build.\r\n         */\r\n        public applicationBuild: string;\r\n        \r\n        /**\r\n         * Application type id.\r\n         */\r\n        public applicationTypeId: string;\r\n        \r\n        /**\r\n         * Application id.\r\n         */\r\n        public applicationId: string;\r\n        \r\n        /**\r\n         * Application layer.\r\n         */\r\n        public applicationLayer: string;\r\n        \r\n        /**\r\n         * Unique client device id. Computer name in most cases.\r\n         */\r\n        public deviceId: string;\r\n        public deviceIp: string;\r\n        public deviceLanguage: string;\r\n        \r\n        /**\r\n         * Device locale using <language>-<REGION> pattern, following RFC 5646. Example 'en-US'.\r\n         */\r\n        public deviceLocale: string;\r\n        \r\n        /**\r\n         * Model of the device the end user of the application is using. Used for client scenarios. If this field is empty then it is derived from the user agent.\r\n         */\r\n        public deviceModel: string;\r\n        public deviceFriendlyName: string;\r\n        public deviceNetwork: string;\r\n        public deviceNetworkName: string;\r\n        \r\n        /**\r\n         * Client device OEM name taken from the browser.\r\n         */\r\n        public deviceOEMName: string;\r\n        public deviceOS: string;\r\n        \r\n        /**\r\n         * Operating system name and version of the device the end user of the application is using. If this field is empty then it is derived from the user agent. Example 'Windows 10 Pro 10.0.10586.0'\r\n         */\r\n        public deviceOSVersion: string;\r\n        \r\n        /**\r\n         * Name of the instance where application is running. Computer name for on-premisis, instance name for Azure.\r\n         */\r\n        public deviceRoleInstance: string;\r\n        \r\n        /**\r\n         * Name of the role application is part of. Maps directly to the role name in azure.\r\n         */\r\n        public deviceRoleName: string;\r\n        public deviceScreenResolution: string;\r\n        \r\n        /**\r\n         * The type of the device the end user of the application is using. Used primarily to distinguish JavaScript telemetry from server side telemetry. Examples: 'PC', 'Phone', 'Browser'. 'PC' is the default value.\r\n         */\r\n        public deviceType: string;\r\n        public deviceMachineName: string;\r\n        public deviceVMName: string;\r\n        public deviceBrowser: string;\r\n        \r\n        /**\r\n         * The browser name and version as reported by the browser.\r\n         */\r\n        public deviceBrowserVersion: string;\r\n        \r\n        /**\r\n         * The IP address of the client device. IPv4 and IPv6 are supported. Information in the location context fields is always about the end user. When telemetry is sent from a service, the location context is about the user that initiated the operation in the service.\r\n         */\r\n        public locationIp: string;\r\n        \r\n        /**\r\n         * The country of the client device. If any of Country, Province, or City is specified, those values will be preferred over geolocation of the IP address field. Information in the location context fields is always about the end user. When telemetry is sent from a service, the location context is about the user that initiated the operation in the service.\r\n         */\r\n        public locationCountry: string;\r\n        \r\n        /**\r\n         * The province/state of the client device. If any of Country, Province, or City is specified, those values will be preferred over geolocation of the IP address field. Information in the location context fields is always about the end user. When telemetry is sent from a service, the location context is about the user that initiated the operation in the service.\r\n         */\r\n        public locationProvince: string;\r\n        \r\n        /**\r\n         * The city of the client device. If any of Country, Province, or City is specified, those values will be preferred over geolocation of the IP address field. Information in the location context fields is always about the end user. When telemetry is sent from a service, the location context is about the user that initiated the operation in the service.\r\n         */\r\n        public locationCity: string;\r\n        \r\n        /**\r\n         * A unique identifier for the operation instance. The operation.id is created by either a request or a page view. All other telemetry sets this to the value for the containing request or page view. Operation.id is used for finding all the telemetry items for a specific operation instance.\r\n         */\r\n        public operationId: string;\r\n        \r\n        /**\r\n         * The name (group) of the operation. The operation.name is created by either a request or a page view. All other telemetry items set this to the value for the containing request or page view. Operation.name is used for finding all the telemetry items for a group of operations (i.e. 'GET Home/Index').\r\n         */\r\n        public operationName: string;\r\n        \r\n        /**\r\n         * The unique identifier of the telemetry item's immediate parent.\r\n         */\r\n        public operationParentId: string;\r\n        public operationRootId: string;\r\n        \r\n        /**\r\n         * Name of synthetic source. Some telemetry from the application may represent a synthetic traffic. It may be web crawler indexing the web site, site availability tests or traces from diagnostic libraries like Application Insights SDK itself.\r\n         */\r\n        public operationSyntheticSource: string;\r\n        \r\n        /**\r\n         * The correlation vector is a light weight vector clock which can be used to identify and order related events across clients and services.\r\n         */\r\n        public operationCorrelationVector: string;\r\n        \r\n        /**\r\n         * Session ID - the instance of the user's interaction with the app. Information in the session context fields is always about the end user. When telemetry is sent from a service, the session context is about the user that initiated the operation in the service.\r\n         */\r\n        public sessionId: string;\r\n        \r\n        /**\r\n         * Boolean value indicating whether the session identified by ai.session.id is first for the user or not.\r\n         */\r\n        public sessionIsFirst: string;\r\n        public sessionIsNew: string;\r\n        public userAccountAcquisitionDate: string;\r\n        \r\n        /**\r\n         * In multi-tenant applications this is the account ID or name which the user is acting with. Examples may be subscription ID for Azure portal or blog name blogging platform.\r\n         */\r\n        public userAccountId: string;\r\n        \r\n        /**\r\n         * The browser's user agent string as reported by the browser. This property will be used to extract informaiton regarding the customer's browser but will not be stored. Use custom properties to store the original user agent.\r\n         */\r\n        public userAgent: string;\r\n        \r\n        /**\r\n         * Anonymous user id. Represents the end user of the application. When telemetry is sent from a service, the user context is about the user that initiated the operation in the service.\r\n         */\r\n        public userId: string;\r\n        \r\n        /**\r\n         * Store region for UWP applications.\r\n         */\r\n        public userStoreRegion: string;\r\n        \r\n        /**\r\n         * Authenticated user id. The opposite of ai.user.id, this represents the user with a friendly name. Since it's PII information it is not collected by default by most SDKs.\r\n         */\r\n        public userAuthUserId: string;\r\n        public userAnonymousUserAcquisitionDate: string;\r\n        public userAuthenticatedUserAcquisitionDate: string;\r\n        public cloudName: string;\r\n        \r\n        /**\r\n         * Name of the role the application is a part of. Maps directly to the role name in azure.\r\n         */\r\n        public cloudRole: string;\r\n        public cloudRoleVer: string;\r\n        \r\n        /**\r\n         * Name of the instance where the application is running. Computer name for on-premisis, instance name for Azure.\r\n         */\r\n        public cloudRoleInstance: string;\r\n        public cloudEnvironment: string;\r\n        public cloudLocation: string;\r\n        public cloudDeploymentUnit: string;\r\n        \r\n        /**\r\n         * SDK version. See https://github.com/Microsoft/ApplicationInsights-Home/blob/master/SDK-AUTHORING.md#sdk-version-specification for information.\r\n         */\r\n        public internalSdkVersion: string;\r\n        \r\n        /**\r\n         * Agent version. Used to indicate the version of StatusMonitor installed on the computer if it is used for data collection.\r\n         */\r\n        public internalAgentVersion: string;\r\n        \r\n        /**\r\n         * This is the node name used for billing purposes. Use it to override the standard detection of nodes.\r\n         */\r\n        public internalNodeName: string;\r\n        \r\n        constructor()\r\n        {\r\n            this.applicationVersion = \"ai.application.ver\";\r\n            this.applicationBuild = \"ai.application.build\";\r\n            this.applicationTypeId = \"ai.application.typeId\";\r\n            this.applicationId = \"ai.application.applicationId\";\r\n            this.applicationLayer = \"ai.application.layer\";\r\n            this.deviceId = \"ai.device.id\";\r\n            this.deviceIp = \"ai.device.ip\";\r\n            this.deviceLanguage = \"ai.device.language\";\r\n            this.deviceLocale = \"ai.device.locale\";\r\n            this.deviceModel = \"ai.device.model\";\r\n            this.deviceFriendlyName = \"ai.device.friendlyName\";\r\n            this.deviceNetwork = \"ai.device.network\";\r\n            this.deviceNetworkName = \"ai.device.networkName\";\r\n            this.deviceOEMName = \"ai.device.oemName\";\r\n            this.deviceOS = \"ai.device.os\";\r\n            this.deviceOSVersion = \"ai.device.osVersion\";\r\n            this.deviceRoleInstance = \"ai.device.roleInstance\";\r\n            this.deviceRoleName = \"ai.device.roleName\";\r\n            this.deviceScreenResolution = \"ai.device.screenResolution\";\r\n            this.deviceType = \"ai.device.type\";\r\n            this.deviceMachineName = \"ai.device.machineName\";\r\n            this.deviceVMName = \"ai.device.vmName\";\r\n            this.deviceBrowser = \"ai.device.browser\";\r\n            this.deviceBrowserVersion = \"ai.device.browserVersion\";\r\n            this.locationIp = \"ai.location.ip\";\r\n            this.locationCountry = \"ai.location.country\";\r\n            this.locationProvince = \"ai.location.province\";\r\n            this.locationCity = \"ai.location.city\";\r\n            this.operationId = \"ai.operation.id\";\r\n            this.operationName = \"ai.operation.name\";\r\n            this.operationParentId = \"ai.operation.parentId\";\r\n            this.operationRootId = \"ai.operation.rootId\";\r\n            this.operationSyntheticSource = \"ai.operation.syntheticSource\";\r\n            this.operationCorrelationVector = \"ai.operation.correlationVector\";\r\n            this.sessionId = \"ai.session.id\";\r\n            this.sessionIsFirst = \"ai.session.isFirst\";\r\n            this.sessionIsNew = \"ai.session.isNew\";\r\n            this.userAccountAcquisitionDate = \"ai.user.accountAcquisitionDate\";\r\n            this.userAccountId = \"ai.user.accountId\";\r\n            this.userAgent = \"ai.user.userAgent\";\r\n            this.userId = \"ai.user.id\";\r\n            this.userStoreRegion = \"ai.user.storeRegion\";\r\n            this.userAuthUserId = \"ai.user.authUserId\";\r\n            this.userAnonymousUserAcquisitionDate = \"ai.user.anonUserAcquisitionDate\";\r\n            this.userAuthenticatedUserAcquisitionDate = \"ai.user.authUserAcquisitionDate\";\r\n            this.cloudName = \"ai.cloud.name\";\r\n            this.cloudRole = \"ai.cloud.role\";\r\n            this.cloudRoleVer = \"ai.cloud.roleVer\";\r\n            this.cloudRoleInstance = \"ai.cloud.roleInstance\";\r\n            this.cloudEnvironment = \"ai.cloud.environment\";\r\n            this.cloudLocation = \"ai.cloud.location\";\r\n            this.cloudDeploymentUnit = \"ai.cloud.deploymentUnit\";\r\n            this.internalSdkVersion = \"ai.internal.sdkVersion\";\r\n            this.internalAgentVersion = \"ai.internal.agentVersion\";\r\n            this.internalNodeName = \"ai.internal.nodeName\";\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../JavaScriptSDK.Interfaces/Context/IApplication.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export class Application implements IApplication {\r\n        /**\r\n         * The application version.\r\n         */\r\n        public ver: string;\r\n\r\n        /**\r\n         * The application build version.\r\n         */\r\n        public build: string;\r\n    }\r\n}","/// <reference path=\"../../JavaScriptSDK.Interfaces/Context/IDevice.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export class Device implements IDevice {\r\n\r\n        /**\r\n         * The type for the current device.\r\n         */\r\n        public type: string;\r\n\r\n        /**\r\n         * A device unique ID.\r\n         */\r\n        public id: string;\r\n\r\n        /**\r\n         * The device OEM for the current device.\r\n         */\r\n        public oemName: string;\r\n\r\n        /**\r\n         * The device model for the current device.\r\n         */\r\n        public model: string;\r\n\r\n        /**\r\n         * The IANA interface type for the internet connected network adapter.\r\n         */\r\n        public network: number;\r\n\r\n        /**\r\n         * The application screen resolution.\r\n         */\r\n        public resolution: string;\r\n\r\n        /**\r\n         * The current display language of the operating system.\r\n         */\r\n        public locale: string;\r\n        \r\n        /**\r\n         * The IP address.\r\n         */\r\n        public ip: string;\r\n\r\n        /**\r\n         * The device language.\r\n         */\r\n        public language: string;\r\n\r\n        /**\r\n         * The OS name.\r\n         */\r\n        public os: string;\r\n\r\n        /**\r\n         * The OS version.\r\n         */\r\n        public osversion: string;\r\n\r\n        /**\r\n         * Constructs a new instance of the Device class\r\n         */\r\n        constructor() {\r\n            // don't attempt to fingerprint browsers\r\n            this.id = \"browser\";\r\n\r\n            // Device type is a dimension in our data platform\r\n            // Setting it to 'Browser' allows to separate client and server dependencies/exceptions\r\n            this.type = \"Browser\";\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../JavaScriptSDK.Interfaces/Context/IInternal.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export class Internal implements IInternal {\r\n\r\n        /**\r\n         * The SDK version used to create this telemetry item.\r\n         */\r\n        public sdkVersion: string;\r\n\r\n        /**\r\n         * The SDK agent version.\r\n         */\r\n        public agentVersion: string;\r\n\r\n         /**\r\n         * Constructs a new instance of the internal telemetry data class.\r\n         */\r\n        constructor(config: ITelemetryConfig) {\r\n            this.sdkVersion = (config.sdkExtension() ? config.sdkExtension() + \"_\" : \"\") + \"javascript:\" + Version;\r\n        }\r\n    }\r\n}","/// <reference path=\"../../JavaScriptSDK.Interfaces/Context/ILocation.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export class Location implements ILocation {\r\n\r\n        /**\r\n         * Client IP address for reverse lookup\r\n         */\r\n        public ip: string;\r\n    }\r\n}","/// <reference path=\"../Util.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Context/IOperation.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export class Operation implements IOperation {\r\n\r\n        public id: string;\r\n        public name: string;\r\n        public parentId: string;\r\n        public rootId: string;\r\n        public syntheticSource: string;\r\n\r\n        constructor() {\r\n            this.id = Util.newId();\r\n            if (window && window.location && window.location.pathname) {\r\n                this.name = window.location.pathname;\r\n            }\r\n        }\r\n    }\r\n} ","module Microsoft.ApplicationInsights {\r\n    export class HashCodeScoreGenerator {\r\n        // We're using 32 bit math, hence max value is (2^31 - 1)\r\n        public static INT_MAX_VALUE: number = 2147483647;\r\n\r\n        // (Magic number) DJB algorithm can't work on shorter strings (results in poor distribution\r\n        private static MIN_INPUT_LENGTH: number = 8;\r\n\r\n        public getHashCodeScore(key: string): number {\r\n            var score = this.getHashCode(key) / HashCodeScoreGenerator.INT_MAX_VALUE;\r\n            return score * 100;\r\n        }\r\n\r\n        public getHashCode(input: string): number {\r\n            if (input == \"\") { return 0; }\r\n\r\n            while (input.length < HashCodeScoreGenerator.MIN_INPUT_LENGTH) {\r\n                input = input.concat(input);\r\n            }\r\n\r\n            // 5381 is a magic number: http://stackoverflow.com/questions/10696223/reason-for-5381-number-in-djb-hash-function\r\n            var hash: number = 5381;\r\n\r\n            for (var i: number = 0; i < input.length; ++i) {\r\n                hash = ((hash << 5) + hash) + input.charCodeAt(i);\r\n                // 'hash' is of number type which means 53 bit integer (http://www.ecma-international.org/ecma-262/6.0/#sec-ecmascript-language-types-number-type)\r\n                // 'hash & hash' will keep it 32 bit integer - just to make it clearer what the result is.\r\n                hash = hash & hash;\r\n            }\r\n\r\n            return Math.abs(hash);\r\n        }\r\n    }\r\n} ","/// <reference path=\"./HashCodeScoreGenerator.ts\" />\r\n/// <reference path=\"../JavaScriptSDK.Interfaces/Contracts/Generated/Envelope.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    export class SamplingScoreGenerator {\r\n        private hashCodeGeneragor: HashCodeScoreGenerator;\r\n\r\n        constructor() {\r\n            this.hashCodeGeneragor = new HashCodeScoreGenerator();\r\n        }\r\n\r\n        public getSamplingScore(envelope: Microsoft.ApplicationInsights.IEnvelope): number {\r\n            var tagKeys: AI.ContextTagKeys = new AI.ContextTagKeys();\r\n            var score: number = 0;\r\n            if (envelope.tags[tagKeys.userId]) {\r\n                score = this.hashCodeGeneragor.getHashCodeScore(envelope.tags[tagKeys.userId]);\r\n            } else if (envelope.tags[tagKeys.operationId]) {\r\n                score = this.hashCodeGeneragor.getHashCodeScore(envelope.tags[tagKeys.operationId]);\r\n            } else {\r\n                score = Math.random()\r\n            }\r\n\r\n            return score;\r\n        }\r\n    }\r\n} ","/// <reference path=\"../SamplingScoreGenerator.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/Envelope.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Context/ISample.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export class Sample implements ISample {\r\n        public sampleRate: number;\r\n        private samplingScoreGenerator: SamplingScoreGenerator;\r\n\r\n        // We're using 32 bit math, hence max value is (2^31 - 1)\r\n        public INT_MAX_VALUE: number = 2147483647;\r\n\r\n        constructor(sampleRate: number) {\r\n            if (sampleRate > 100 || sampleRate < 0) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.WARNING,\r\n                    _InternalMessageId.SampleRateOutOfRange,\r\n                    \"Sampling rate is out of range (0..100). Sampling will be disabled, you may be sending too much data which may affect your AI service level.\",\r\n                    { samplingRate: sampleRate }, true);\r\n                this.sampleRate = 100;\r\n            }\r\n\r\n            this.sampleRate = sampleRate;\r\n            this.samplingScoreGenerator = new SamplingScoreGenerator();\r\n        }\r\n\r\n        /**\r\n        * Determines if an envelope is sampled in (i.e. will be sent) or not (i.e. will be dropped).\r\n        */\r\n        public isSampledIn(envelope: Microsoft.ApplicationInsights.IEnvelope): boolean {\r\n            if (this.sampleRate == 100) return true;\r\n\r\n            var score = this.samplingScoreGenerator.getSamplingScore(envelope);\r\n\r\n            return score < this.sampleRate;\r\n        }\r\n    }\r\n}","/// <reference path=\"../Util.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Context/ISession.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface ISessionConfig {\r\n        sessionRenewalMs: () => number;\r\n        sessionExpirationMs: () => number;\r\n        cookieDomain: () => string;\r\n    }\r\n\r\n    export class Session implements ISession {\r\n        /**\r\n         * The session ID.\r\n         */\r\n        public id: string;\r\n\r\n        /**  \r\n         * The true if this is the first session  \r\n         */\r\n        public isFirst: boolean;\r\n\r\n        /**\r\n         * The date at which this guid was genereated.\r\n         * Per the spec the ID will be regenerated if more than acquisitionSpan milliseconds ellapse from this time.\r\n         */\r\n        public acquisitionDate: number;\r\n\r\n        /**\r\n         * The date at which this session ID was last reported.\r\n         * This value should be updated whenever telemetry is sent using this ID.\r\n         * Per the spec the ID will be regenerated if more than renewalSpan milliseconds elapse from this time with no activity.\r\n         */\r\n        public renewalDate: number;\r\n    }\r\n\r\n    export class _SessionManager {\r\n\r\n        public static acquisitionSpan = 86400000; // 24 hours in ms\r\n        public static renewalSpan = 1800000; // 30 minutes in ms\r\n        public static cookieUpdateInterval = 60000 // 1 minute in ms\r\n        public automaticSession: Session;\r\n        public config: ISessionConfig;\r\n\r\n        private cookieUpdatedTimestamp: number;\r\n\r\n        constructor(config: ISessionConfig) {\r\n\r\n            if (!config) {\r\n                config = <any>{};\r\n            }\r\n\r\n            if (!(typeof config.sessionExpirationMs === \"function\")) {\r\n                config.sessionExpirationMs = () => _SessionManager.acquisitionSpan;\r\n            }\r\n\r\n            if (!(typeof config.sessionRenewalMs === \"function\")) {\r\n                config.sessionRenewalMs = () => _SessionManager.renewalSpan;\r\n            }\r\n\r\n            this.config = config;\r\n\r\n            this.automaticSession = new Session();\r\n        }\r\n\r\n        public update() {\r\n            if (!this.automaticSession.id) {\r\n                this.initializeAutomaticSession();\r\n            }\r\n\r\n            var now = dateTime.Now();\r\n\r\n            var acquisitionExpired = now - this.automaticSession.acquisitionDate > this.config.sessionExpirationMs();\r\n            var renewalExpired = now - this.automaticSession.renewalDate > this.config.sessionRenewalMs();\r\n\r\n            // renew if acquisitionSpan or renewalSpan has ellapsed\r\n            if (acquisitionExpired || renewalExpired) {\r\n                // update automaticSession so session state has correct id                \r\n                this.automaticSession.isFirst = undefined;\r\n                this.renew();\r\n            } else {\r\n                // do not update the cookie more often than cookieUpdateInterval\r\n                if (!this.cookieUpdatedTimestamp || now - this.cookieUpdatedTimestamp > _SessionManager.cookieUpdateInterval) {\r\n                    this.automaticSession.renewalDate = now;\r\n                    this.setCookie(this.automaticSession.id, this.automaticSession.acquisitionDate, this.automaticSession.renewalDate);\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         *  Record the current state of the automatic session and store it in our cookie string format\r\n         *  into the browser's local storage. This is used to restore the session data when the cookie\r\n         *  expires.\r\n         */\r\n        public backup() {\r\n            this.setStorage(this.automaticSession.id, this.automaticSession.acquisitionDate, this.automaticSession.renewalDate);\r\n        }\r\n\r\n        /**\r\n         *  Use ai_session cookie data or local storage data (when the cookie is unavailable) to\r\n         *  initialize the automatic session.\r\n         */\r\n        private initializeAutomaticSession() {\r\n            var cookie = Util.getCookie('ai_session');\r\n            if (cookie && typeof cookie.split === \"function\") {\r\n                this.initializeAutomaticSessionWithData(cookie);\r\n            } else {\r\n                // There's no cookie, but we might have session data in local storage\r\n                // This can happen if the session expired or the user actively deleted the cookie\r\n                // We only want to recover data if the cookie is missing from expiry. We should respect the user's wishes if the cookie was deleted actively.\r\n                // The User class handles this for us and deletes our local storage object if the persistent user cookie was removed.\r\n                var storage = Util.getStorage('ai_session');\r\n                if (storage) {\r\n                    this.initializeAutomaticSessionWithData(storage);\r\n                }\r\n            }\r\n\r\n            if (!this.automaticSession.id) {\r\n                this.automaticSession.isFirst = true;\r\n                this.renew();\r\n            }\r\n        }\r\n\r\n        /**\r\n         *  Extract id, aquisitionDate, and renewalDate from an ai_session payload string and\r\n         *  use this data to initialize automaticSession.\r\n         *\r\n         *  @param {string} sessionData - The string stored in an ai_session cookie or local storage backup\r\n         */\r\n        private initializeAutomaticSessionWithData(sessionData: string) {\r\n            var params = sessionData.split(\"|\");\r\n\r\n            if (params.length > 0) {\r\n                this.automaticSession.id = params[0];\r\n            }\r\n\r\n            try {\r\n                if (params.length > 1) {\r\n                    var acq = +params[1];\r\n                    this.automaticSession.acquisitionDate = +new Date(acq);\r\n                    this.automaticSession.acquisitionDate = this.automaticSession.acquisitionDate > 0 ? this.automaticSession.acquisitionDate : 0;\r\n                }\r\n\r\n                if (params.length > 2) {\r\n                    var renewal = +params[2];\r\n                    this.automaticSession.renewalDate = +new Date(renewal);\r\n                    this.automaticSession.renewalDate = this.automaticSession.renewalDate > 0 ? this.automaticSession.renewalDate : 0;\r\n                }\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n\r\n                    _InternalMessageId.ErrorParsingAISessionCookie,\r\n                    \"Error parsing ai_session cookie, session will be reset: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n\r\n            if (this.automaticSession.renewalDate == 0) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.WARNING,\r\n                    _InternalMessageId.SessionRenewalDateIsZero,\r\n                    \"AI session renewal date is 0, session will be reset.\");\r\n            }\r\n        }\r\n\r\n        private renew() {\r\n            var now = dateTime.Now();\r\n\r\n            this.automaticSession.id = Util.newId();\r\n            this.automaticSession.acquisitionDate = now;\r\n            this.automaticSession.renewalDate = now;\r\n\r\n            this.setCookie(this.automaticSession.id, this.automaticSession.acquisitionDate, this.automaticSession.renewalDate);\r\n\r\n            // If this browser does not support local storage, fire an internal log to keep track of it at this point\r\n            if (!Util.canUseLocalStorage()) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.WARNING,\r\n                    _InternalMessageId.BrowserDoesNotSupportLocalStorage,\r\n                    \"Browser does not support local storage. Session durations will be inaccurate.\");\r\n            }\r\n        }\r\n\r\n        private setCookie(guid: string, acq: number, renewal: number) {\r\n            // Set cookie to expire after the session expiry time passes or the session renewal deadline, whichever is sooner\r\n            // Expiring the cookie will cause the session to expire even if the user isn't on the page\r\n            var acquisitionExpiry = acq + this.config.sessionExpirationMs();\r\n            var renewalExpiry = renewal + this.config.sessionRenewalMs();\r\n            var cookieExpiry = new Date();\r\n            var cookie = [guid, acq, renewal];\r\n\r\n            if (acquisitionExpiry < renewalExpiry) {\r\n                cookieExpiry.setTime(acquisitionExpiry);\r\n            } else {\r\n                cookieExpiry.setTime(renewalExpiry);\r\n            }\r\n\r\n            var cookieDomnain = this.config.cookieDomain ? this.config.cookieDomain() : null;\r\n\r\n            Util.setCookie('ai_session', cookie.join('|') + ';expires=' + cookieExpiry.toUTCString(), cookieDomnain);\r\n\r\n            this.cookieUpdatedTimestamp = dateTime.Now();\r\n        }\r\n\r\n        private setStorage(guid: string, acq: number, renewal: number) {\r\n            // Keep data in local storage to retain the last session id, allowing us to cleanly end the session when it expires\r\n            // Browsers that don't support local storage won't be able to end sessions cleanly from the client\r\n            // The server will notice this and end the sessions itself, with loss of accurate session duration\r\n            Util.setStorage('ai_session', [guid, acq, renewal].join('|'));\r\n        }\r\n    }\r\n} ","/// <reference path=\"../Util.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Context/IUser.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export class User implements IUser {\r\n\r\n        static cookieSeparator: string = '|';\r\n        static userCookieName: string = 'ai_user';\r\n        static authUserCookieName: string = 'ai_authUser';\r\n\r\n        /**\r\n         * The telemetry configuration.\r\n         */\r\n        public config: ITelemetryConfig;\r\n\r\n        /**\r\n         * The user ID.\r\n         */\r\n        public id: string;\r\n\r\n        /**\r\n         * Authenticated user id\r\n         */\r\n        public authenticatedId: string;\r\n\r\n        /**\r\n         * The account ID.\r\n         */\r\n        public accountId: string;\r\n\r\n        /**\r\n         * The account acquisition date.\r\n         */\r\n        public accountAcquisitionDate: string;\r\n\r\n        /**\r\n         * The user agent string.\r\n         */\r\n        public agent: string;\r\n\r\n        /**\r\n         * The store region.\r\n         */\r\n        public storeRegion: string;\r\n\r\n        /**\r\n        * Sets the authenticated user id and the account id in this session.\r\n        *   \r\n        * @param authenticatedUserId {string} - The authenticated user id. A unique and persistent string that represents each authenticated user in the service.\r\n        * @param accountId {string} - An optional string to represent the account associated with the authenticated user.\r\n        */\r\n        public setAuthenticatedUserContext(authenticatedUserId: string, accountId?: string, storeInCookie = false) {\r\n\r\n            // Validate inputs to ensure no cookie control characters.\r\n            var isInvalidInput = !this.validateUserInput(authenticatedUserId) || (accountId && !this.validateUserInput(accountId));\r\n            if (isInvalidInput) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING,\r\n                    _InternalMessageId.SetAuthContextFailedAccountName,\r\n                    \"Setting auth user context failed. \" +\r\n                    \"User auth/account id should be of type string, and not contain commas, semi-colons, equal signs, spaces, or vertical-bars.\",\r\n                    true);\r\n                return;\r\n            }\r\n\r\n            // Create cookie string.\r\n            this.authenticatedId = authenticatedUserId;\r\n            var authCookie = this.authenticatedId;\r\n            if (accountId) {\r\n                this.accountId = accountId;\r\n                authCookie = [this.authenticatedId, this.accountId].join(User.cookieSeparator);\r\n            }\r\n\r\n            if (storeInCookie) {\r\n                // Set the cookie. No expiration date because this is a session cookie (expires when browser closed).\r\n                // Encoding the cookie to handle unexpected unicode characters.\r\n                Util.setCookie(User.authUserCookieName, encodeURI(authCookie), this.config.cookieDomain());\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Clears the authenticated user id and the account id from the user context.\r\n         * @returns {} \r\n         */\r\n        public clearAuthenticatedUserContext() {\r\n            this.authenticatedId = null;\r\n            this.accountId = null;\r\n            Util.deleteCookie(User.authUserCookieName);\r\n        }\r\n\r\n        constructor(config: ITelemetryConfig) {\r\n\r\n            //get userId or create new one if none exists\r\n            var cookie = Util.getCookie(User.userCookieName);\r\n            if (cookie) {\r\n                var params = cookie.split(User.cookieSeparator);\r\n                if (params.length > 0) {\r\n                    this.id = params[0];\r\n                }\r\n            }\r\n\r\n            this.config = config;\r\n\r\n            if (!this.id) {\r\n                this.id = Util.newId();\r\n                var date = new Date();\r\n                var acqStr = Util.toISOStringForIE8(date);\r\n                this.accountAcquisitionDate = acqStr;\r\n                // without expiration, cookies expire at the end of the session\r\n                // set it to 365 days from now\r\n                // 365 * 24 * 60 * 60 * 1000 = 31536000000 \r\n                date.setTime(date.getTime() + 31536000000);\r\n                var newCookie = [this.id, acqStr];\r\n                var cookieDomain = this.config.cookieDomain ? this.config.cookieDomain() : undefined;\r\n\r\n                Util.setCookie(User.userCookieName, newCookie.join(User.cookieSeparator) + ';expires=' + date.toUTCString(), cookieDomain);\r\n\r\n                // If we have an ai_session in local storage this means the user actively removed our cookies.\r\n                // We should respect their wishes and clear ourselves from local storage\r\n                Util.removeStorage('ai_session');\r\n            }\r\n\r\n            // We still take the account id from the ctor param for backward compatibility. \r\n            // But if the the customer set the accountId through the newer setAuthenticatedUserContext API, we will override it.\r\n            this.accountId = config.accountId ? config.accountId() : undefined;\r\n\r\n            // Get the auth user id and account id from the cookie if exists\r\n            // Cookie is in the pattern: <authenticatedId>|<accountId>\r\n            var authCookie = Util.getCookie(User.authUserCookieName);\r\n            if (authCookie) {\r\n                authCookie = decodeURI(authCookie);\r\n                var authCookieString = authCookie.split(User.cookieSeparator);\r\n                if (authCookieString[0]) {\r\n                    this.authenticatedId = authCookieString[0];\r\n                }\r\n                if (authCookieString.length > 1 && authCookieString[1]) {\r\n                    this.accountId = authCookieString[1];\r\n                }\r\n            }\r\n        }\r\n\r\n        private validateUserInput(id: string): boolean {\r\n            // Validate:\r\n            // 1. Id is a non-empty string.\r\n            // 2. It does not contain special characters for cookies.\r\n            if (typeof id !== 'string' ||\r\n                !id ||\r\n                id.match(/,|;|=| |\\|/)) {\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        }\r\n    }\r\n\r\n}","/// <reference path=\"../Logging.ts\" />\r\n/// <reference path=\"../Util.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    export class extensions {\r\n        public static IsNullOrUndefined(obj) {\r\n            return typeof (obj) === \"undefined\" || obj === null;\r\n        }\r\n    }\r\n\r\n    export class stringUtils {\r\n        public static GetLength(strObject) {\r\n            var res = 0;\r\n            if (!extensions.IsNullOrUndefined(strObject)) {\r\n                var stringified = \"\";\r\n                try {\r\n                    stringified = strObject.toString();\r\n                } catch (ex) {\r\n                    // some troubles with complex object\r\n                }\r\n\r\n                res = stringified.length;\r\n                res = isNaN(res) ? 0 : res;\r\n            }\r\n\r\n            return res;\r\n        }\r\n    }\r\n\r\n    export class dateTime {\r\n        ///<summary>Return the number of milliseconds since 1970/01/01 in local timezon</summary>\r\n        public static Now = (window.performance && window.performance.now && window.performance.timing) ?\r\n            function () {\r\n                return window.performance.now() + window.performance.timing.navigationStart;\r\n            }\r\n            :\r\n            function () {\r\n                return new Date().getTime();\r\n            }\r\n\r\n        ///<summary>Gets duration between two timestamps</summary>\r\n        public static GetDuration = function (start: number, end: number): number {\r\n            var result = null;\r\n            if (start !== 0 && end !== 0 && !extensions.IsNullOrUndefined(start) && !extensions.IsNullOrUndefined(end)) {\r\n                result = end - start;\r\n            }\r\n\r\n            return result;\r\n        }\r\n    }\r\n\r\n    export class EventHelper {\r\n        ///<summary>Binds the specified function to an event, so that the function gets called whenever the event fires on the object</summary>\r\n        ///<param name=\"obj\">Object to which </param>\r\n        ///<param name=\"eventNameWithoutOn\">String that specifies any of the standard DHTML Events without \"on\" prefix</param>\r\n        ///<param name=\"handlerRef\">Pointer that specifies the function to call when event fires</param>\r\n        ///<returns>True if the function was bound successfully to the event, otherwise false</returns>\r\n        public static AttachEvent(obj, eventNameWithoutOn, handlerRef) {\r\n            var result = false;\r\n            if (!extensions.IsNullOrUndefined(obj)) {\r\n                if (!extensions.IsNullOrUndefined(obj.attachEvent)) {\r\n                    // IE before version 9                    \r\n                    obj.attachEvent(\"on\" + eventNameWithoutOn, handlerRef);\r\n                    result = true;\r\n                }\r\n                else {\r\n                    if (!extensions.IsNullOrUndefined(obj.addEventListener)) {\r\n                        // all browsers except IE before version 9\r\n                        obj.addEventListener(eventNameWithoutOn, handlerRef, false);\r\n                        result = true;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        public static DetachEvent(obj, eventNameWithoutOn, handlerRef) {\r\n            if (!extensions.IsNullOrUndefined(obj)) {\r\n                if (!extensions.IsNullOrUndefined(obj.detachEvent)) {\r\n                    obj.detachEvent(\"on\" + eventNameWithoutOn, handlerRef);\r\n                }\r\n                else {\r\n                    if (!extensions.IsNullOrUndefined(obj.removeEventListener)) {\r\n                        obj.removeEventListener(eventNameWithoutOn, handlerRef, false);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    export class AjaxHelper {\r\n        public static ParseDependencyPath(absoluteUrl: string, method: string, pathName: string) {\r\n            var target, name;                \r\n            if (absoluteUrl && absoluteUrl.length > 0) {\r\n                var parsedUrl: HTMLAnchorElement = UrlHelper.parseUrl(absoluteUrl)\r\n                target = parsedUrl.host;\r\n                if (parsedUrl.pathname != null) {\r\n                    var pathName: string = (parsedUrl.pathname.length === 0) ? \"/\" : parsedUrl.pathname;\r\n                    if (pathName.charAt(0) !== '/') {\r\n                        pathName = \"/\" + pathName;\r\n                    }\r\n\r\n                    name = Telemetry.Common.DataSanitizer.sanitizeString(method ? method + \" \" + pathName : pathName);\r\n                } else {\r\n                    name = Telemetry.Common.DataSanitizer.sanitizeString(absoluteUrl);\r\n                }\r\n            } else {\r\n                target = pathName;\r\n                name = pathName;\r\n            }\r\n\r\n            return {\r\n                target: target, \r\n                name: name\r\n            };\r\n        }\r\n    }\r\n}","/// <reference path=\"../Logging.ts\" />\r\n/// <reference path=\"../Util.ts\" />\r\n/// <reference path=\"./ajaxUtils.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    export class XHRMonitoringState {\r\n        public openDone: boolean = false;\r\n        public setRequestHeaderDone: boolean = false;\r\n        public sendDone: boolean = false;\r\n        public abortDone: boolean = false;\r\n\r\n        //<summary>True, if onreadyStateChangeCallback function attached to xhr, otherwise false</summary>\r\n        public onreadystatechangeCallbackAttached = false;\r\n    }\r\n\r\n    export class ajaxRecord {\r\n        public completed = false;\r\n        public requestHeadersSize = null;\r\n        public ttfb = null;\r\n        public responseReceivingDuration = null;\r\n        public callbackDuration = null;\r\n        public ajaxTotalDuration = null;\r\n        public aborted = null;\r\n        public pageUrl = null;\r\n        public requestUrl = null;\r\n        public requestSize = 0;\r\n        public method = null;\r\n\r\n        ///<summary>Returns the HTTP status code.</summary>\r\n        public status = null;        \r\n        \r\n        //<summary>The timestamp when open method was invoked</summary>\r\n        public requestSentTime = null;\r\n\r\n        //<summary>The timestamps when first byte was received</summary>\r\n        public responseStartedTime = null;\r\n\r\n        //<summary>The timestamp when last byte was received</summary>\r\n        public responseFinishedTime = null;\r\n\r\n        //<summary>The timestamp when onreadystatechange callback in readyState 4 finished</summary>\r\n        public callbackFinishedTime = null;\r\n        \r\n        //<summary>The timestamp at which ajax was ended</summary>\r\n        public endTime = null;\r\n\r\n        //<summary>The original xhr onreadystatechange event</summary>\r\n        public originalOnreadystatechage = null;\r\n\r\n        public xhrMonitoringState: XHRMonitoringState = new XHRMonitoringState();\r\n\r\n        //<summary>Determines whether or not JavaScript exception occured in xhr.onreadystatechange code. 1 if occured, otherwise 0.</summary>\r\n        public clientFailure = 0;\r\n\r\n\r\n        public id: string;\r\n\r\n        constructor(id: string) {\r\n            this.id = id;\r\n        }\r\n\r\n\r\n        public getAbsoluteUrl() {\r\n            return this.requestUrl ? UrlHelper.getAbsoluteUrl(this.requestUrl) : null;\r\n        }\r\n\r\n        public getPathName() {\r\n            return this.requestUrl ? Telemetry.Common.DataSanitizer.sanitizeUrl(UrlHelper.getCompleteUrl(this.method, this.requestUrl)): null;\r\n        }\r\n\r\n        public CalculateMetrics = function () {\r\n            var self = this;\r\n            // round to 3 decimal points\r\n            self.ajaxTotalDuration = Math.round(dateTime.GetDuration(self.requestSentTime, self.responseFinishedTime)*1000)/1000;\r\n        }\r\n    };\r\n};           \r\n\r\n","module Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    export class RequestHeaders {\r\n        /**\r\n         * Request-Context header\r\n         */\r\n        public static requestContextHeader = \"Request-Context\";\r\n\r\n        /**\r\n         * Target instrumentation header that is added to the response and retrieved by the\r\n         * calling application when processing incoming responses.\r\n         */\r\n        public static requestContextTargetKey = \"appId\";\r\n\r\n        /**\r\n         * Request-Context appId format\r\n         */\r\n        public static requestContextAppIdFormat = \"appId=cid-v1:\";\r\n\r\n        /**\r\n         * Request-Id header\r\n         */\r\n        public static requestIdHeader = \"Request-Id\";\r\n\r\n        /**\r\n         * Sdk-Context header\r\n         * If this header passed with appId in content then appId will be returned back by the backend.\r\n         */\r\n        public static sdkContextHeader = \"Sdk-Context\";\r\n\r\n        /**\r\n         * String to pass in header for requesting appId back from the backend.\r\n         */\r\n        public static sdkContextHeaderAppIdRequest = \"appId\";\r\n\r\n        public static requestContextHeaderLowerCase = \"request-context\";\r\n    }\r\n}\r\n","// THIS FILE WAS AUTOGENERATED\r\nmodule Microsoft.Telemetry\r\n{\r\n\"use strict\";\r\n    \r\n    /**\r\n     * The abstract common base of all domains.\r\n     */\r\n    export class Domain\r\n    {\r\n        \r\n        constructor()\r\n        {\r\n        }\r\n    }\r\n}\r\n","// THIS FILE WAS AUTOGENERATED\r\n/// <reference path=\"Domain.ts\" />\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    \r\n    /**\r\n     * Instances of Event represent structured event records that can be grouped and searched by their properties. Event data item also creates a metric of event count by name.\r\n     */\r\n    export class EventData extends Microsoft.Telemetry.Domain\r\n    {\r\n        \r\n        /**\r\n         * Schema version\r\n         */\r\n        public ver: number;\r\n        \r\n        /**\r\n         * Event name. Keep it low cardinality to allow proper grouping and useful metrics.\r\n         */\r\n        public name: string;\r\n        \r\n        /**\r\n         * Collection of custom properties.\r\n         */\r\n        public properties: any;\r\n        \r\n        /**\r\n         * Collection of custom measurements.\r\n         */\r\n        public measurements: any;\r\n        \r\n        constructor()\r\n        {\r\n            super();\r\n            \r\n            this.ver = 2;\r\n            this.properties = {};\r\n            this.measurements = {};\r\n        }\r\n    }\r\n}\r\n","// THIS FILE WAS AUTOGENERATED\r\n/// <reference path=\"EventData.ts\" />\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    \r\n    /**\r\n     * An instance of PageView represents a generic action on a page like a button click. It is also the base type for PageView.\r\n     */\r\n    export class PageViewData extends AI.EventData\r\n    {\r\n        \r\n        /**\r\n         * Schema version\r\n         */\r\n        public ver: number;\r\n        \r\n        /**\r\n         * Request URL with all query string parameters\r\n         */\r\n        public url: string;\r\n        \r\n        /**\r\n         * Event name. Keep it low cardinality to allow proper grouping and useful metrics.\r\n         */\r\n        public name: string;\r\n        \r\n        /**\r\n         * Request duration in format: DD.HH:MM:SS.MMMMMM. For a page view (PageViewData), this is the duration. For a page view with performance information (PageViewPerfData), this is the page load time. Must be less than 1000 days.\r\n         */\r\n        public duration: string;\r\n               \r\n        /**\r\n         * Identifier of a page view instance. Used for correlation between page view and other telemetry items.\r\n         */\r\n        public id: string;\r\n        \r\n        /**\r\n         * Collection of custom properties.\r\n         */\r\n        public properties: any;\r\n        \r\n        /**\r\n         * Collection of custom measurements.\r\n         */\r\n        public measurements: any;\r\n        \r\n        constructor()\r\n        {\r\n            super();\r\n            \r\n            this.ver = 2;\r\n            this.properties = {};\r\n            this.measurements = {};\r\n        }\r\n    }\r\n}\r\n","// THIS FILE WAS AUTOGENERATED\r\n/// <reference path=\"Domain.ts\" />\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    \r\n    /**\r\n     * An instance of Remote Dependency represents an interaction of the monitored component with a remote component/service like SQL or an HTTP endpoint.\r\n     */\r\n    export class RemoteDependencyData extends Microsoft.Telemetry.Domain\r\n    {\r\n        \r\n        /**\r\n         * Schema version\r\n         */\r\n        public ver: number;\r\n        \r\n        /**\r\n         * Name of the command initiated with this dependency call. Low cardinality value. Examples are stored procedure name and URL path template.\r\n         */\r\n        public name: string;\r\n        \r\n        /**\r\n         * Identifier of a dependency call instance. Used for correlation with the request telemetry item corresponding to this dependency call.\r\n         */\r\n        public id: string;\r\n        \r\n        /**\r\n         * Result code of a dependency call. Examples are SQL error code and HTTP status code.\r\n         */\r\n        public resultCode: string;\r\n        \r\n        /**\r\n         * Request duration in format: DD.HH:MM:SS.MMMMMM. Must be less than 1000 days.\r\n         */\r\n        public duration: string;\r\n        \r\n        /**\r\n         * Indication of successfull or unsuccessfull call.\r\n         */\r\n        public success: boolean;\r\n        \r\n        /**\r\n         * Command initiated by this dependency call. Examples are SQL statement and HTTP URL's with all query parameters.\r\n         */\r\n        public data: string;\r\n        \r\n        /**\r\n         * Target site of a dependency call. Examples are server name, host address.\r\n         */\r\n        public target: string;\r\n        \r\n        /**\r\n         * Dependency type name. Very low cardinality value for logical grouping of dependencies and interpretation of other fields like commandName and resultCode. Examples are SQL, Azure table, and HTTP.\r\n         */\r\n        public type: string;\r\n        \r\n        /**\r\n         * Collection of custom properties.\r\n         */\r\n        public properties: any;\r\n        \r\n        /**\r\n         * Collection of custom measurements.\r\n         */\r\n        public measurements: any;\r\n        \r\n        constructor()\r\n        {\r\n            super();\r\n            \r\n            this.ver = 2;\r\n            this.success = true;\r\n            this.properties = {};\r\n            this.measurements = {};\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../Logging.ts\" />\r\n/// <reference path=\"../../Util.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry.Common {\r\n    \"use strict\";\r\n\r\n    export class DataSanitizer {\r\n\r\n        /**\r\n        * Max length allowed for custom names.\r\n        */\r\n        private static MAX_NAME_LENGTH = 150;\r\n\r\n        /**\r\n         * Max length allowed for Id field in page views.\r\n         */\r\n        private static MAX_ID_LENGTH = 128;\r\n\r\n        /**\r\n         * Max length allowed for custom values.\r\n         */\r\n        private static MAX_PROPERTY_LENGTH = 8192;\r\n\r\n        /**\r\n         * Max length allowed for names\r\n         */\r\n        private static MAX_STRING_LENGTH = 1024;\r\n\r\n        /**\r\n         * Max length allowed for url.\r\n         */\r\n        private static MAX_URL_LENGTH = 2048;\r\n\r\n        /**\r\n         * Max length allowed for messages.\r\n         */\r\n        private static MAX_MESSAGE_LENGTH = 32768;\r\n\r\n        /**\r\n         * Max length allowed for exceptions.\r\n         */\r\n        private static MAX_EXCEPTION_LENGTH = 32768;\r\n\r\n        public static sanitizeKeyAndAddUniqueness(key, map) {\r\n            var origLength = key.length;\r\n            var field = DataSanitizer.sanitizeKey(key);\r\n\r\n            // validation truncated the length.  We need to add uniqueness\r\n            if (field.length !== origLength) {\r\n                var i = 0;\r\n                var uniqueField = field;\r\n                while (map[uniqueField] !== undefined) {\r\n                    i++;\r\n                    uniqueField = field.substring(0, DataSanitizer.MAX_NAME_LENGTH - 3) + DataSanitizer.padNumber(i);\r\n                }\r\n                field = uniqueField;\r\n            }\r\n            return field;\r\n        }\r\n\r\n        public static sanitizeKey(name) {\r\n            if (name) {\r\n                // Remove any leading or trailing whitepace\r\n                name = Util.trim(name.toString());\r\n\r\n                // truncate the string to 150 chars\r\n                if (name.length > DataSanitizer.MAX_NAME_LENGTH) {\r\n                    name = name.substring(0, DataSanitizer.MAX_NAME_LENGTH);\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.NameTooLong,\r\n                        \"name is too long.  It has been truncated to \" + DataSanitizer.MAX_NAME_LENGTH + \" characters.\",\r\n                        { name: name }, true);\r\n                }\r\n            }\r\n\r\n            return name;\r\n        }\r\n\r\n        public static sanitizeString(value, maxLength: number = DataSanitizer.MAX_STRING_LENGTH) {\r\n            if (value) {\r\n                maxLength = maxLength ? maxLength: DataSanitizer.MAX_STRING_LENGTH; // in case default parameters dont work\r\n                value = Util.trim(value);\r\n                if (value.toString().length > maxLength) {\r\n                    value = value.toString().substring(0, maxLength);\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.StringValueTooLong,\r\n                        \"string value is too long. It has been truncated to \" + maxLength + \" characters.\",\r\n                        { value: value }, true);\r\n                }\r\n            }\r\n\r\n            return value;\r\n        }\r\n\r\n        public static sanitizeUrl(url) {\r\n            return DataSanitizer.sanitizeInput(url, DataSanitizer.MAX_URL_LENGTH, _InternalMessageId.UrlTooLong);\r\n        }\r\n\r\n        public static sanitizeMessage(message) {\r\n            if (message) {\r\n                if (message.length > DataSanitizer.MAX_MESSAGE_LENGTH) {\r\n                    message = message.substring(0, DataSanitizer.MAX_MESSAGE_LENGTH);\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING, _InternalMessageId.MessageTruncated,\r\n                        \"message is too long, it has been truncated to \" + DataSanitizer.MAX_MESSAGE_LENGTH + \" characters.\",\r\n                        { message: message },\r\n                        true);\r\n                }\r\n            }\r\n\r\n            return message;\r\n        }\r\n\r\n        public static sanitizeException(exception) {\r\n            if (exception) {\r\n                if (exception.length > DataSanitizer.MAX_EXCEPTION_LENGTH) {\r\n                    exception = exception.substring(0, DataSanitizer.MAX_EXCEPTION_LENGTH);\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING, _InternalMessageId.ExceptionTruncated, \"exception is too long, it has been truncated to \" + DataSanitizer.MAX_EXCEPTION_LENGTH + \" characters.\",\r\n                        { exception: exception }, true);\r\n                }\r\n            }\r\n\r\n            return exception;\r\n        }\r\n\r\n        public static sanitizeProperties(properties) {\r\n            if (properties) {\r\n                var tempProps = {};\r\n                for (var prop in properties) {\r\n                    var value = DataSanitizer.sanitizeString(properties[prop], DataSanitizer.MAX_PROPERTY_LENGTH);\r\n                    prop = DataSanitizer.sanitizeKeyAndAddUniqueness(prop, tempProps);\r\n                    tempProps[prop] = value;\r\n                }\r\n                properties = tempProps;\r\n            }\r\n\r\n            return properties;\r\n        }\r\n\r\n        public static sanitizeMeasurements(measurements) {\r\n            if (measurements) {\r\n                var tempMeasurements = {};\r\n                for (var measure in measurements) {\r\n                    var value = measurements[measure];\r\n                    measure = DataSanitizer.sanitizeKeyAndAddUniqueness(measure, tempMeasurements);\r\n                    tempMeasurements[measure] = value;\r\n                }\r\n                measurements = tempMeasurements;\r\n            }\r\n\r\n            return measurements;\r\n        }\r\n\r\n        public static sanitizeId(id: string): string {\r\n                return id ? DataSanitizer.sanitizeInput(id, DataSanitizer.MAX_ID_LENGTH, _InternalMessageId.IdTooLong).toString() : id;\r\n        }\r\n\r\n        public static sanitizeInput(input: any, maxLength: number, _msgId: _InternalMessageId) {\r\n            if (input) {\r\n            input = Util.trim(input);\r\n                if (input.length > maxLength) {\r\n                    input = input.substring(0, maxLength);\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _msgId,\r\n                        \"input is too long, it has been truncated to \" + maxLength + \" characters.\",\r\n                        { data: input },\r\n                        true);\r\n                }\r\n            }\r\n\r\n            return input;\r\n        }\r\n\r\n        public static padNumber(num) {\r\n            var s = \"00\" + num;\r\n            return s.substr(s.length - 3);\r\n        }\r\n    }\r\n}","/// <reference path=\"../../JavaScriptSDK.Interfaces/Telemetry/ISerializable.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/PageViewData.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/RemoteDependencyData.ts\"/>\r\n/// <reference path=\"../Serializer.ts\" />\r\n/// <reference path=\"./Common/DataSanitizer.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    export class RemoteDependencyData extends AI.RemoteDependencyData implements ISerializable {\r\n\r\n        public static envelopeType = \"Microsoft.ApplicationInsights.{0}.RemoteDependency\";\r\n        public static dataType = \"RemoteDependencyData\";\r\n\r\n        public aiDataContract = {\r\n            id: FieldType.Required,\r\n            ver: FieldType.Required,\r\n            name: FieldType.Default,\r\n            resultCode: FieldType.Default,\r\n            duration: FieldType.Default,\r\n            success: FieldType.Default,\r\n            data: FieldType.Default,\r\n            target: FieldType.Default,\r\n            type: FieldType.Default,\r\n            properties: FieldType.Default,\r\n            measurements: FieldType.Default,\r\n\r\n            kind: FieldType.Default,\r\n            value: FieldType.Default,\r\n            count: FieldType.Default,\r\n            min: FieldType.Default,\r\n            max: FieldType.Default,\r\n            stdDev: FieldType.Default,\r\n            dependencyKind: FieldType.Default,\r\n            dependencySource: FieldType.Default,\r\n            commandName: FieldType.Default,\r\n            dependencyTypeName: FieldType.Default,\r\n        }\r\n\r\n        /**\r\n         * Constructs a new instance of the RemoteDependencyData object\r\n         */\r\n        constructor(id: string, absoluteUrl: string, commandName: string, value: number, success: boolean, resultCode: number, method?: string, properties?: Object, measurements?: Object) {\r\n            super();\r\n\r\n            this.id = id;\r\n\r\n            this.duration = Util.msToTimeSpan(value);\r\n            this.success = success;\r\n            this.resultCode = resultCode + \"\";\r\n\r\n            this.type = \"Ajax\";\r\n            this.data = Common.DataSanitizer.sanitizeUrl(commandName);\r\n\r\n            var dependencyFields = AjaxHelper.ParseDependencyPath(absoluteUrl, method, commandName);\r\n            this.target = dependencyFields.target;\r\n            this.name = dependencyFields.name;\r\n\r\n            this.properties = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeProperties(properties);\r\n            this.measurements = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeMeasurements(measurements);\r\n        }\r\n    }\r\n}","/// <reference path=\"../Logging.ts\" />\r\n/// <reference path=\"../Util.ts\" />\r\n/// <reference path=\"./ajaxUtils.ts\" />\r\n/// <reference path=\"./ajaxRecord.ts\" />\r\n/// <reference path=\"../RequestResponseHeaders.ts\" />\r\n/// <reference path=\"../Telemetry/RemoteDependencyData.ts\" />\r\n/// <reference path=\"../AppInsights.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    export interface XMLHttpRequestInstrumented extends XMLHttpRequest {\r\n        ajaxData: ajaxRecord;\r\n    }\r\n\r\n    export class AjaxMonitor {\r\n        private appInsights: AppInsights;\r\n        private initialized: boolean;\r\n        private static instrumentedByAppInsightsName = \"InstrumentedByAppInsights\";\r\n        private currentWindowHost;\r\n\r\n        constructor(appInsights: Microsoft.ApplicationInsights.AppInsights) {\r\n            this.currentWindowHost = window.location.host;\r\n            this.appInsights = appInsights;\r\n            this.initialized = false;\r\n            this.Init();\r\n        }\r\n\r\n        ///<summary>The main function that needs to be called in order to start Ajax Monitoring</summary>\r\n        private Init() {\r\n            if (this.supportsMonitoring()) {\r\n                this.instrumentOpen();\r\n                this.instrumentSend();\r\n                this.instrumentAbort();\r\n                this.initialized = true;\r\n            }\r\n        }\r\n\r\n\r\n        ///<summary>Function that returns property name which will identify that monitoring for given instance of XmlHttpRequest is disabled</summary>\r\n        public static DisabledPropertyName: string = \"Microsoft_ApplicationInsights_BypassAjaxInstrumentation\";\r\n\r\n        ///<summary>Verifies that particalar instance of XMLHttpRequest needs to be monitored</summary>\r\n        ///<param name=\"excludeAjaxDataValidation\">Optional parameter. True if ajaxData must be excluded from verification</param>\r\n        ///<returns type=\"bool\">True if instance needs to be monitored, otherwise false</returns>\r\n        private isMonitoredInstance(xhr: XMLHttpRequestInstrumented, excludeAjaxDataValidation?: boolean): boolean {\r\n\r\n            // checking to see that all interested functions on xhr were instrumented\r\n            return this.initialized\r\n\r\n                // checking on ajaxData to see that it was not removed in user code\r\n                && (excludeAjaxDataValidation === true || !extensions.IsNullOrUndefined(xhr.ajaxData))\r\n\r\n                // check that this instance is not not used by ajax call performed inside client side monitoring to send data to collector\r\n                && xhr[AjaxMonitor.DisabledPropertyName] !== true;\r\n\r\n        }\r\n\r\n        ///<summary>Determines whether ajax monitoring can be enabled on this document</summary>\r\n        ///<returns>True if Ajax monitoring is supported on this page, otherwise false</returns>\r\n        private supportsMonitoring(): boolean {\r\n            var result = true;\r\n            if (extensions.IsNullOrUndefined(XMLHttpRequest) ||\r\n                extensions.IsNullOrUndefined(XMLHttpRequest.prototype) ||\r\n                extensions.IsNullOrUndefined(XMLHttpRequest.prototype.open) ||\r\n                extensions.IsNullOrUndefined(XMLHttpRequest.prototype.send) ||\r\n                extensions.IsNullOrUndefined(XMLHttpRequest.prototype.abort)) {\r\n                result = false;\r\n            }\r\n\r\n            // disable in IE8 or older (https://www.w3schools.com/jsref/jsref_trim_string.asp)\r\n            try {\r\n                \" a \".trim();\r\n            } catch (ex) {\r\n                result = false;\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        private instrumentOpen() {\r\n            var originalOpen = XMLHttpRequest.prototype.open;\r\n            var ajaxMonitorInstance = this;\r\n            XMLHttpRequest.prototype.open = function (method, url, async) {\r\n                try {\r\n                    if (ajaxMonitorInstance.isMonitoredInstance(this, true) &&\r\n                        (\r\n                            !(<XMLHttpRequestInstrumented>this).ajaxData ||\r\n                            !(<XMLHttpRequestInstrumented>this).ajaxData.xhrMonitoringState.openDone\r\n                        )) {\r\n                        ajaxMonitorInstance.openHandler(this, method, url, async);\r\n                    }\r\n                } catch (e) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.CRITICAL,\r\n                        _InternalMessageId.FailedMonitorAjaxOpen,\r\n                        \"Failed to monitor XMLHttpRequest.open, monitoring data for this ajax call may be incorrect.\",\r\n                        {\r\n                            ajaxDiagnosticsMessage: AjaxMonitor.getFailedAjaxDiagnosticsMessage(this),\r\n                            exception: Microsoft.ApplicationInsights.Util.dump(e)\r\n                        });\r\n                }\r\n\r\n                return originalOpen.apply(this, arguments);\r\n            };\r\n        }\r\n\r\n        private openHandler(xhr: XMLHttpRequestInstrumented, method, url, async) {\r\n            // this format corresponds with activity logic on server-side and is required for the correct correlation\r\n            var id = \"|\" + this.appInsights.context.operation.id + \".\" + Util.newId();\r\n\r\n            var ajaxData = new ajaxRecord(id);\r\n            ajaxData.method = method;\r\n            ajaxData.requestUrl = url;\r\n            ajaxData.xhrMonitoringState.openDone = true\r\n            xhr.ajaxData = ajaxData;\r\n\r\n            this.attachToOnReadyStateChange(xhr);\r\n        }\r\n\r\n        private static getFailedAjaxDiagnosticsMessage(xhr: XMLHttpRequestInstrumented): string {\r\n            var result = \"\";\r\n            try {\r\n                if (!extensions.IsNullOrUndefined(xhr) &&\r\n                    !extensions.IsNullOrUndefined(xhr.ajaxData) &&\r\n                    !extensions.IsNullOrUndefined(xhr.ajaxData.requestUrl)) {\r\n                    result += \"(url: '\" + xhr.ajaxData.requestUrl + \"')\";\r\n                }\r\n            } catch (e) { }\r\n\r\n            return result;\r\n        }\r\n\r\n        private instrumentSend() {\r\n            var originalSend = XMLHttpRequest.prototype.send;\r\n            var ajaxMonitorInstance = this;\r\n            XMLHttpRequest.prototype.send = function (content) {\r\n                try {\r\n                    if (ajaxMonitorInstance.isMonitoredInstance(this) && !(<XMLHttpRequestInstrumented>this).ajaxData.xhrMonitoringState.sendDone) {\r\n                        ajaxMonitorInstance.sendHandler(this, content);\r\n                    }\r\n                } catch (e) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.CRITICAL,\r\n                        _InternalMessageId.FailedMonitorAjaxSend,\r\n                        \"Failed to monitor XMLHttpRequest, monitoring data for this ajax call may be incorrect.\",\r\n                        {\r\n                            ajaxDiagnosticsMessage: AjaxMonitor.getFailedAjaxDiagnosticsMessage(this),\r\n                            exception: Microsoft.ApplicationInsights.Util.dump(e)\r\n                        });\r\n                }\r\n\r\n                return originalSend.apply(this, arguments);\r\n            };\r\n        }\r\n\r\n        private sendHandler(xhr: XMLHttpRequestInstrumented, content) {\r\n            xhr.ajaxData.requestSentTime = dateTime.Now();\r\n\r\n            var absoluteUrl = xhr.ajaxData.getAbsoluteUrl();\r\n            if (UrlHelper.parseUrl(absoluteUrl).host === this.currentWindowHost\r\n                && CorrelationIdHelper.canIncludeCorrelationHeader(this.appInsights.config, absoluteUrl)) {\r\n                xhr.setRequestHeader(RequestHeaders.requestIdHeader, xhr.ajaxData.id);\r\n                if (this.appInsights.context) {\r\n                    var appId = this.appInsights.context.appId();\r\n                    if (appId) {\r\n                        xhr.setRequestHeader(RequestHeaders.requestContextHeader, RequestHeaders.requestContextAppIdFormat + appId);\r\n                    }\r\n                }\r\n            }\r\n            xhr.ajaxData.xhrMonitoringState.sendDone = true;\r\n        }\r\n\r\n        private instrumentAbort() {\r\n            var originalAbort = XMLHttpRequest.prototype.abort;\r\n            var ajaxMonitorInstance = this;\r\n            XMLHttpRequest.prototype.abort = function () {\r\n                try {\r\n                    if (ajaxMonitorInstance.isMonitoredInstance(this) && !(<XMLHttpRequestInstrumented>this).ajaxData.xhrMonitoringState.abortDone) {\r\n                        (<XMLHttpRequestInstrumented>this).ajaxData.aborted = 1;\r\n                        (<XMLHttpRequestInstrumented>this).ajaxData.xhrMonitoringState.abortDone = true;\r\n                    }\r\n                } catch (e) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.CRITICAL,\r\n                        _InternalMessageId.FailedMonitorAjaxAbort,\r\n                        \"Failed to monitor XMLHttpRequest.abort, monitoring data for this ajax call may be incorrect.\",\r\n                        {\r\n                            ajaxDiagnosticsMessage: AjaxMonitor.getFailedAjaxDiagnosticsMessage(this),\r\n                            exception: Microsoft.ApplicationInsights.Util.dump(e)\r\n                        });\r\n                }\r\n\r\n                return originalAbort.apply(this, arguments);\r\n            };\r\n        }\r\n\r\n        private attachToOnReadyStateChange(xhr: XMLHttpRequestInstrumented) {\r\n            var ajaxMonitorInstance = this;\r\n            xhr.ajaxData.xhrMonitoringState.onreadystatechangeCallbackAttached = EventHelper.AttachEvent(xhr, \"readystatechange\", () => {\r\n                try {\r\n                    if (ajaxMonitorInstance.isMonitoredInstance(xhr)) {\r\n                        if (xhr.readyState === 4) {\r\n                            ajaxMonitorInstance.onAjaxComplete(xhr);\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    var exceptionText = Microsoft.ApplicationInsights.Util.dump(e);\r\n\r\n                    // ignore messages with c00c023f, as this a known IE9 XHR abort issue\r\n                    if (!exceptionText || exceptionText.toLowerCase().indexOf(\"c00c023f\") == -1) {\r\n                        _InternalLogging.throwInternal(\r\n                            LoggingSeverity.CRITICAL,\r\n                            _InternalMessageId.FailedMonitorAjaxRSC,\r\n                            \"Failed to monitor XMLHttpRequest 'readystatechange' event handler, monitoring data for this ajax call may be incorrect.\",\r\n                            {\r\n                                ajaxDiagnosticsMessage: AjaxMonitor.getFailedAjaxDiagnosticsMessage(xhr),\r\n                                exception: Microsoft.ApplicationInsights.Util.dump(e)\r\n                            });\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        private onAjaxComplete(xhr: XMLHttpRequestInstrumented) {\r\n            xhr.ajaxData.responseFinishedTime = dateTime.Now();\r\n            xhr.ajaxData.status = xhr.status;\r\n            xhr.ajaxData.CalculateMetrics();\r\n            \r\n            if (xhr.ajaxData.ajaxTotalDuration < 0) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING,\r\n                    _InternalMessageId.FailedMonitorAjaxDur,\r\n                    \"Failed to calculate the duration of the ajax call, monitoring data for this ajax call won't be sent.\",\r\n                    {\r\n                        ajaxDiagnosticsMessage: AjaxMonitor.getFailedAjaxDiagnosticsMessage(xhr),\r\n                        requestSentTime: xhr.ajaxData.requestSentTime,\r\n                        responseFinishedTime: xhr.ajaxData.responseFinishedTime\r\n                    });\r\n            }\r\n            else {\r\n                var dependency = new Telemetry.RemoteDependencyData(\r\n                    xhr.ajaxData.id, \r\n                    xhr.ajaxData.getAbsoluteUrl(), \r\n                    xhr.ajaxData.getPathName(), \r\n                    xhr.ajaxData.ajaxTotalDuration, \r\n                    (+(xhr.ajaxData.status)) >= 200 && (+(xhr.ajaxData.status)) < 400, \r\n                    +xhr.ajaxData.status, \r\n                    xhr.ajaxData.method);                \r\n\r\n                // enrich dependency target with correlation context from the server\r\n                var correlationContext = this.getCorrelationContext(xhr);\r\n                if (correlationContext) {\r\n                    dependency.target = dependency.target + \" | \" + correlationContext;\r\n                }\r\n            \r\n                this.appInsights.trackDependencyData(dependency);\r\n\r\n                xhr.ajaxData = null;\r\n            }\r\n        }\r\n\r\n        private getCorrelationContext(xhr: XMLHttpRequestInstrumented) {\r\n            try {\r\n                var responseHeadersString = xhr.getAllResponseHeaders();\r\n                if (responseHeadersString !== null) {\r\n                    var index = responseHeadersString.toLowerCase().indexOf(RequestHeaders.requestContextHeaderLowerCase);\r\n                    if (index !== -1) {\r\n                        var responseHeader = xhr.getResponseHeader(RequestHeaders.requestContextHeader);\r\n                        return CorrelationIdHelper.getCorrelationContext(responseHeader);\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING,\r\n                    _InternalMessageId.FailedMonitorAjaxGetCorrelationHeader,\r\n                    \"Failed to get Request-Context correlation header as it may be not included in the response or not accessible.\",\r\n                    {\r\n                        ajaxDiagnosticsMessage: AjaxMonitor.getFailedAjaxDiagnosticsMessage(xhr),\r\n                        exception: Microsoft.ApplicationInsights.Util.dump(e)\r\n                    });\r\n            }          \r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"Serializer.ts\" />\r\n/// <reference path=\"Telemetry/Common/Envelope.ts\"/>\r\n/// <reference path=\"Telemetry/Common/Base.ts\" />\r\n/// <reference path=\"../JavaScriptSDK.Interfaces/Contracts/Generated/ContextTagKeys.ts\"/>\r\n/// <reference path=\"Context/Application.ts\"/>\r\n/// <reference path=\"Context/Device.ts\"/>\r\n/// <reference path=\"Context/Internal.ts\"/>\r\n/// <reference path=\"Context/Location.ts\"/>\r\n/// <reference path=\"Context/Operation.ts\"/>\r\n/// <reference path=\"Context/Sample.ts\"/>\r\n/// <reference path=\"Context/Session.ts\"/>\r\n/// <reference path=\"Context/User.ts\"/>\r\n/// <reference path=\"ajax/ajax.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    export interface ISendBuffer {\r\n        /**\r\n         * Enqueue the payload\r\n         */\r\n        enqueue: (payload: string) => void;\r\n\r\n        /**\r\n         * Returns the number of elements in the buffer\r\n         */\r\n        count: () => number;\r\n\r\n        /**\r\n         * Clears the buffer\r\n         */\r\n        clear: () => void;\r\n\r\n        /**\r\n         * Returns items stored in the buffer\r\n         */\r\n        getItems: () => string[];\r\n\r\n        /**\r\n         * Build a batch of all elements in the payload array\r\n         */\r\n        batchPayloads: (payload: string[]) => string;\r\n\r\n        /**\r\n         * Moves items to the SENT_BUFFER.\r\n         * The buffer holds items which were sent, but we haven't received any response from the backend yet. \r\n         */\r\n        markAsSent: (payload: string[]) => void;\r\n\r\n        /**\r\n         * Removes items from the SENT_BUFFER. Should be called on successful response from the backend. \r\n         */\r\n        clearSent: (payload: string[]) => void;\r\n    }\r\n\r\n    /*\r\n     * An array based send buffer. \r\n     */\r\n    export class ArraySendBuffer implements ISendBuffer {\r\n        private _config: ISenderConfig;\r\n        private _buffer: string[];\r\n\r\n        constructor(config: ISenderConfig) {\r\n            this._config = config;\r\n\r\n            this._buffer = [];\r\n        }\r\n\r\n        public enqueue(payload: string) {\r\n            this._buffer.push(payload);\r\n        }\r\n\r\n        public count(): number {\r\n            return this._buffer.length;\r\n        }\r\n\r\n        public clear() {\r\n            this._buffer.length = 0;\r\n        }\r\n\r\n        public getItems(): string[] {\r\n            return this._buffer.slice(0);\r\n        }\r\n\r\n        public batchPayloads(payload: string[]): string {\r\n            if (payload && payload.length > 0) {\r\n                var batch = this._config.emitLineDelimitedJson() ?\r\n                    payload.join(\"\\n\") :\r\n                    \"[\" + payload.join(\",\") + \"]\";\r\n\r\n                return batch;\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        public markAsSent(payload: string[]) {\r\n            this.clear();\r\n        }\r\n\r\n        public clearSent(payload: string[]) {\r\n            // not supported\r\n        }\r\n    }\r\n\r\n    /*\r\n     * Session storege buffer holds a copy of all unsent items in the browser session storage.\r\n     */\r\n    export class SessionStorageSendBuffer implements ISendBuffer {\r\n        static BUFFER_KEY = \"AI_buffer\";\r\n        static SENT_BUFFER_KEY = \"AI_sentBuffer\";\r\n\r\n        // Maximum number of payloads stored in the buffer. If the buffer is full, new elements will be dropped. \r\n        static MAX_BUFFER_SIZE = 2000;\r\n        private _bufferFullMessageSent = false;\r\n\r\n        // An in-memory copy of the buffer. A copy is saved to the session storage on enqueue() and clear(). \r\n        // The buffer is restored in a constructor and contains unsent events from a previous page.\r\n        private _buffer: string[];\r\n        private _config: ISenderConfig;\r\n\r\n        constructor(config: ISenderConfig) {\r\n            this._config = config;\r\n\r\n            var bufferItems = this.getBuffer(SessionStorageSendBuffer.BUFFER_KEY);\r\n            var notDeliveredItems = this.getBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY);\r\n\r\n            this._buffer = bufferItems.concat(notDeliveredItems);\r\n\r\n            // If the buffer has too many items, drop items from the end.\r\n            if (this._buffer.length > SessionStorageSendBuffer.MAX_BUFFER_SIZE) {\r\n                this._buffer.length = SessionStorageSendBuffer.MAX_BUFFER_SIZE;\r\n            }\r\n\r\n            // update DataLossAnalyzer with the number of recovered items\r\n            // Uncomment if you want to use DataLossanalyzer\r\n            // DataLossAnalyzer.itemsRestoredFromSessionBuffer = this._buffer.length;\r\n\r\n            this.setBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY, []);\r\n            this.setBuffer(SessionStorageSendBuffer.BUFFER_KEY, this._buffer);\r\n        }\r\n\r\n        public enqueue(payload: string) {\r\n            if (this._buffer.length >= SessionStorageSendBuffer.MAX_BUFFER_SIZE) {\r\n                // sent internal log only once per page view\r\n                if (!this._bufferFullMessageSent) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.SessionStorageBufferFull,\r\n                        \"Maximum buffer size reached: \" + this._buffer.length,\r\n                        true);\r\n                    this._bufferFullMessageSent = true;\r\n                }\r\n                return;\r\n            }\r\n\r\n            this._buffer.push(payload);\r\n            this.setBuffer(SessionStorageSendBuffer.BUFFER_KEY, this._buffer);\r\n        }\r\n\r\n        public count(): number {\r\n            return this._buffer.length;\r\n        }\r\n\r\n        public clear() {\r\n            this._buffer.length = 0;\r\n            this.setBuffer(SessionStorageSendBuffer.BUFFER_KEY, []);\r\n            this.setBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY, []);\r\n\r\n            this._bufferFullMessageSent = false;\r\n        }\r\n\r\n        public getItems(): string[] {\r\n            return this._buffer.slice(0)\r\n        }\r\n\r\n        public batchPayloads(payload: string[]): string {\r\n            if (payload && payload.length > 0) {\r\n                var batch = this._config.emitLineDelimitedJson() ?\r\n                    payload.join(\"\\n\") :\r\n                    \"[\" + payload.join(\",\") + \"]\";\r\n\r\n                return batch;\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        public markAsSent(payload: string[]) {\r\n            this._buffer = this.removePayloadsFromBuffer(payload, this._buffer);\r\n            this.setBuffer(SessionStorageSendBuffer.BUFFER_KEY, this._buffer);\r\n\r\n            var sentElements = this.getBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY);\r\n            if (sentElements instanceof Array && payload instanceof Array) {\r\n                sentElements = sentElements.concat(payload);\r\n\r\n                if (sentElements.length > SessionStorageSendBuffer.MAX_BUFFER_SIZE) {\r\n                    // We send telemetry normally. If the SENT_BUFFER is too big we don't add new elements\r\n                    // until we receive a response from the backend and the buffer has free space again (see clearSent method)\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.CRITICAL,\r\n                        _InternalMessageId.SessionStorageBufferFull,\r\n                        \"Sent buffer reached its maximum size: \" + sentElements.length,\r\n                        true);\r\n\r\n                    sentElements.length = SessionStorageSendBuffer.MAX_BUFFER_SIZE;\r\n                }\r\n\r\n                this.setBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY, sentElements);\r\n            }\r\n        }\r\n\r\n        public clearSent(payload: string[]) {\r\n            var sentElements = this.getBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY);\r\n            sentElements = this.removePayloadsFromBuffer(payload, sentElements);\r\n\r\n            this.setBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY, sentElements);\r\n        }\r\n\r\n        private removePayloadsFromBuffer(payloads: string[], buffer: string[]): string[] {\r\n            var remaining: string[] = [];\r\n\r\n            for (var i in buffer) {\r\n                var contains = false;\r\n                for (var j in payloads) {\r\n                    if (payloads[j] === buffer[i]) {\r\n                        contains = true;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (!contains) {\r\n                    remaining.push(buffer[i]);\r\n                }\r\n            };\r\n\r\n            return remaining;\r\n        }\r\n\r\n        private getBuffer(key: string): string[] {\r\n            try {\r\n                var bufferJson = Util.getSessionStorage(key);\r\n                if (bufferJson) {\r\n                    var buffer: string[] = JSON.parse(bufferJson);\r\n                    if (buffer) {\r\n                        return buffer;\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.FailedToRestoreStorageBuffer,\r\n                        \" storage key: \" + key + \", \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n            }\r\n\r\n            return [];\r\n        }\r\n\r\n        private setBuffer(key: string, buffer: string[]) {\r\n            try {\r\n                var bufferJson = JSON.stringify(buffer);\r\n                Util.setSessionStorage(key, bufferJson);\r\n            } catch (e) {\r\n                // if there was an error, clear the buffer\r\n                // telemetry is stored in the _buffer array so we won't loose any items\r\n                Util.setSessionStorage(key, JSON.stringify([]));\r\n\r\n                _InternalLogging.throwInternal(LoggingSeverity.WARNING,\r\n                    _InternalMessageId.FailedToSetStorageBuffer,\r\n                        \" storage key: \" + key + \", \" + Util.getExceptionName(e) + \". Buffer cleared\",\r\n                        { exception: Util.dump(e) });\r\n            }\r\n        }\r\n    }\r\n}","/// <reference path=\"Serializer.ts\" />\r\n/// <reference path=\"Telemetry/Common/Envelope.ts\"/>\r\n/// <reference path=\"Telemetry/Common/Base.ts\" />\r\n/// <reference path=\"../JavaScriptSDK.Interfaces/Contracts/Generated/ContextTagKeys.ts\"/>\r\n/// <reference path=\"../JavaScriptSDK.Interfaces/Contracts/Generated/Envelope.ts\" />\r\n/// <reference path=\"Context/Application.ts\"/>\r\n/// <reference path=\"Context/Device.ts\"/>\r\n/// <reference path=\"Context/Internal.ts\"/>\r\n/// <reference path=\"Context/Location.ts\"/>\r\n/// <reference path=\"Context/Operation.ts\"/>\r\n/// <reference path=\"Context/Sample.ts\"/>\r\n/// <reference path=\"Context/Session.ts\"/>\r\n/// <reference path=\"Context/User.ts\"/>\r\n/// <reference path=\"ajax/ajax.ts\"/>\r\n/// <reference path=\"SendBuffer.ts\"/>\r\n\r\ninterface XDomainRequest extends XMLHttpRequestEventTarget {\r\n    responseText: string;\r\n    send(payload: string);\r\n    open(method: string, url: string);\r\n};\r\n\r\ndeclare var XDomainRequest: {\r\n    prototype: XDomainRequest;\r\n    new(): XDomainRequest;\r\n};\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    export interface ISenderConfig {\r\n        /**\r\n         * The url to which payloads will be sent\r\n         */\r\n        endpointUrl: () => string;\r\n\r\n        /**\r\n        * The JSON format (normal vs line delimited). True means line delimited JSON.\r\n        */\r\n        emitLineDelimitedJson: () => boolean;\r\n\r\n        /**\r\n         * The maximum size of a batch in bytes\r\n         */\r\n        maxBatchSizeInBytes: () => number;\r\n\r\n        /**\r\n         * The maximum interval allowed between calls to batchInvoke\r\n         */\r\n        maxBatchInterval: () => number;\r\n\r\n        /**\r\n         * The master off switch.  Do not send any data if set to TRUE\r\n         */\r\n        disableTelemetry: () => boolean;\r\n\r\n        /**\r\n         * Store a copy of a send buffer in the session storage\r\n         */\r\n        enableSessionStorageBuffer: () => boolean;\r\n\r\n        /**\r\n         * Is retry handler disabled.\r\n         * If enabled, retry on 206 (partial success), 408 (timeout), 429 (too many requests), 500 (internal server error) and 503 (service unavailable).\r\n         */\r\n        isRetryDisabled: () => boolean;\r\n\r\n        isBeaconApiDisabled: () => boolean;\r\n    }\r\n\r\n    export interface IResponseError {\r\n        index: number;\r\n        statusCode: number;\r\n        message: string;\r\n    }\r\n\r\n    export interface IBackendResponse {\r\n        /**\r\n         * Number of items received by the backend\r\n         */\r\n        itemsReceived: number;\r\n\r\n        /**\r\n         * Number of items succesfuly accepted by the backend\r\n         */\r\n        itemsAccepted: number;\r\n\r\n        /**\r\n         * List of errors for items which were not accepted\r\n         */\r\n        errors: IResponseError[];\r\n\r\n        /**\r\n         * App id returned by the backend - not necessary returned, but we don't need it with each response.\r\n         */\r\n        appId?: string;\r\n    }\r\n\r\n    export class Sender {\r\n        /**\r\n         * How many times in a row a retryable error condition has occurred.\r\n         */\r\n        private _consecutiveErrors: number;\r\n\r\n        /**\r\n         * The time to retry at in milliseconds from 1970/01/01 (this makes the timer calculation easy).\r\n         */\r\n        private _retryAt: number;\r\n\r\n        /**\r\n         * The time of the last send operation.\r\n         */\r\n        private _lastSend: number;\r\n\r\n        /**\r\n         * Handle to the timer for delayed sending of batches of data.\r\n         */\r\n        private _timeoutHandle: any;\r\n\r\n        /**\r\n         * A send buffer object\r\n         */\r\n        public _buffer: ISendBuffer;\r\n\r\n        /**\r\n         * The configuration for this sender instance\r\n         */\r\n        public _config: ISenderConfig;\r\n\r\n        /**\r\n         * AppId of this component parsed from some backend response.\r\n         */\r\n        public _appId: string;\r\n\r\n        /**\r\n         * A method which will cause data to be send to the url\r\n         */\r\n\r\n        public _sender: (payload: string[], isAsync: boolean) => void;\r\n\r\n        /**\r\n         * Whether XMLHttpRequest object is supported. Older version of IE (8,9) do not support it.\r\n         */\r\n        public _XMLHttpRequestSupported: boolean = false;\r\n\r\n        /**\r\n         * The maximum Beacon API payload size.\r\n         * WC3 documentation allows browsers to set the limit. Chrome current has a limit of 64kb. \r\n         */\r\n        public static MaxBeaconPayloadSize = 65536; // 64kb\r\n\r\n        /**\r\n         * Constructs a new instance of the Sender class\r\n         */\r\n        constructor(config: ISenderConfig) {\r\n            this._consecutiveErrors = 0;\r\n            this._retryAt = null;\r\n            this._lastSend = 0;\r\n            this._config = config;\r\n            this._sender = null;\r\n            this._buffer = (Util.canUseSessionStorage() && this._config.enableSessionStorageBuffer())\r\n                ? new SessionStorageSendBuffer(config) : new ArraySendBuffer(config);\r\n\r\n            if (!this._config.isBeaconApiDisabled() && Util.IsBeaconApiSupported()) {\r\n                this._sender = this._beaconSender;\r\n            } else {\r\n                if (typeof XMLHttpRequest != \"undefined\") {\r\n                    var testXhr = new XMLHttpRequest();\r\n                    if (\"withCredentials\" in testXhr) {\r\n                        this._sender = this._xhrSender;\r\n                        this._XMLHttpRequestSupported = true;\r\n                    } else if (typeof XDomainRequest !== \"undefined\") {\r\n                        this._sender = this._xdrSender; //IE 8 and 9\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Add a telemetry item to the send buffer\r\n         */\r\n        public send(envelope: Microsoft.ApplicationInsights.IEnvelope) {\r\n            try {\r\n                // if master off switch is set, don't send any data\r\n                if (this._config.disableTelemetry()) {\r\n                    // Do not send/save data\r\n                    return;\r\n                }\r\n\r\n                // validate input\r\n                if (!envelope) {\r\n                    _InternalLogging.throwInternal(LoggingSeverity.CRITICAL, _InternalMessageId.CannotSendEmptyTelemetry, \"Cannot send empty telemetry\");\r\n                    return;\r\n                }\r\n\r\n                // ensure a sender was constructed\r\n                if (!this._sender) {\r\n                    _InternalLogging.throwInternal(LoggingSeverity.CRITICAL, _InternalMessageId.SenderNotInitialized, \"Sender was not initialized\");\r\n                    return;\r\n                }\r\n\r\n                // check if the incoming payload is too large, truncate if necessary\r\n                var payload: string = Serializer.serialize(envelope);\r\n\r\n                // flush if we would exceed the max-size limit by adding this item\r\n                var bufferPayload = this._buffer.getItems();\r\n                var batch = this._buffer.batchPayloads(bufferPayload);\r\n\r\n                if (batch && (batch.length + payload.length > this._config.maxBatchSizeInBytes())) {\r\n                    this.triggerSend();\r\n                }\r\n\r\n                // enqueue the payload\r\n                this._buffer.enqueue(payload);\r\n\r\n                // ensure an invocation timeout is set\r\n                this._setupTimer();\r\n\r\n                // Uncomment if you want to use DataLossanalyzer\r\n                // DataLossAnalyzer.incrementItemsQueued();\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING,\r\n                    _InternalMessageId.FailedAddingTelemetryToBuffer,\r\n                    \"Failed adding telemetry to the sender's buffer, some telemetry will be lost: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Sets up the timer which triggers actually sending the data.\r\n         */\r\n        private _setupTimer() {\r\n            if (!this._timeoutHandle) {\r\n                var retryInterval = this._retryAt ? Math.max(0, this._retryAt - Date.now()) : 0;\r\n                var timerValue = Math.max(this._config.maxBatchInterval(), retryInterval);\r\n\r\n                this._timeoutHandle = setTimeout(() => {\r\n                    this.triggerSend();\r\n                }, timerValue);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Gets the size of the list in bytes.\r\n         * @param list {string[]} - The list to get the size in bytes of.\r\n         */\r\n        private _getSizeInBytes(list: string[]) {\r\n            var size = 0;\r\n            if (list && list.length) {\r\n                for (var i = 0; i < list.length; i++) {\r\n                    var item = list[i];\r\n                    if (item && item.length) {\r\n                        size += item.length;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return size;\r\n        }\r\n\r\n        /**\r\n         * Immediately send buffered data\r\n         * @param async {boolean} - Indicates if the events should be sent asynchronously\r\n         */\r\n        public triggerSend(async = true) {\r\n            try {\r\n                // Send data only if disableTelemetry is false\r\n                if (!this._config.disableTelemetry()) {\r\n\r\n                    if (this._buffer.count() > 0) {\r\n                        var payload = this._buffer.getItems();\r\n\r\n                        // invoke send\r\n                        this._sender(payload, async);\r\n                    }\r\n\r\n                    // update lastSend time to enable throttling\r\n                    this._lastSend = +new Date;\r\n                } else {\r\n                    this._buffer.clear();\r\n                }\r\n\r\n                clearTimeout(this._timeoutHandle);\r\n                this._timeoutHandle = null;\r\n                this._retryAt = null;\r\n            } catch (e) {\r\n                /* Ignore this error for IE under v10 */\r\n                if (!Util.getIEVersion() || Util.getIEVersion() > 9) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.CRITICAL,\r\n                        _InternalMessageId.TransmissionFailed,\r\n                        \"Telemetry transmission failed, some telemetry will be lost: \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                }\r\n            }\r\n        }\r\n\r\n        /** Calculates the time to wait before retrying in case of an error based on\r\n         * http://en.wikipedia.org/wiki/Exponential_backoff\r\n         */\r\n        private _setRetryTime() {\r\n            const SlotDelayInSeconds = 10;\r\n            var delayInSeconds: number;\r\n\r\n            if (this._consecutiveErrors <= 1) {\r\n                delayInSeconds = SlotDelayInSeconds;\r\n            } else {\r\n                var backOffSlot = (Math.pow(2, this._consecutiveErrors) - 1) / 2;\r\n                var backOffDelay = Math.floor(Math.random() * backOffSlot * SlotDelayInSeconds) + 1;\r\n                delayInSeconds = Math.max(Math.min(backOffDelay, 3600), SlotDelayInSeconds);\r\n            }\r\n\r\n            // TODO: Log the backoff time like the C# version does.\r\n            var retryAfterTimeSpan = Date.now() + (delayInSeconds * 1000);\r\n\r\n            // TODO: Log the retry at time like the C# version does.\r\n            this._retryAt = retryAfterTimeSpan;\r\n        }\r\n\r\n        /**\r\n         * Parses the response from the backend. \r\n         * @param response - XMLHttpRequest or XDomainRequest response\r\n         */\r\n        private _parseResponse(response: any): IBackendResponse {\r\n            try {\r\n                var result = JSON.parse(response);\r\n\r\n                if (result && result.itemsReceived && result.itemsReceived >= result.itemsAccepted &&\r\n                    result.itemsReceived - result.itemsAccepted == result.errors.length) {\r\n                    return result;\r\n                }\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.InvalidBackendResponse,\r\n                    \"Cannot parse the response. \" + Util.getExceptionName(e));\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        /**\r\n         * Checks if the SDK should resend the payload after receiving this status code from the backend.\r\n         * @param statusCode\r\n         */\r\n        private _isRetriable(statusCode: number): boolean {\r\n            return statusCode == 408 // Timeout\r\n                || statusCode == 429 // Too many requests.\r\n                || statusCode == 500 // Internal server error.\r\n                || statusCode == 503; // Service unavailable.\r\n        }\r\n\r\n        /**\r\n         * Resend payload. Adds payload back to the send buffer and setup a send timer (with exponential backoff).\r\n         * @param payload\r\n         */\r\n        private _resendPayload(payload: string[]) {\r\n            if (!payload || payload.length === 0) {\r\n                return;\r\n            }\r\n\r\n            this._buffer.clearSent(payload);\r\n            this._consecutiveErrors++;\r\n\r\n            for (var item of payload) {\r\n                this._buffer.enqueue(item);\r\n            }\r\n\r\n            // setup timer\r\n            this._setRetryTime();\r\n            this._setupTimer();\r\n        }\r\n\r\n        private _formatErrorMessageXhr(xhr: XMLHttpRequest, message?: string): string {\r\n            if (xhr) {\r\n                return \"XMLHttpRequest,Status:\" + xhr.status + \",Response:\" + xhr.responseText || xhr.response || \"\";\r\n            }\r\n\r\n            return message;\r\n        }\r\n\r\n        private _formatErrorMessageXdr(xdr: XDomainRequest, message?: string): string {\r\n            if (xdr) {\r\n                return \"XDomainRequest,Response:\" + xdr.responseText || \"\";\r\n            }\r\n\r\n            return message;\r\n        }\r\n\r\n        /**\r\n         * Send XMLHttpRequest\r\n         * @param payload {string} - The data payload to be sent.\r\n         * @param isAsync {boolean} - Indicates if the request should be sent asynchronously\r\n         */\r\n        private _xhrSender(payload: string[], isAsync: boolean) {\r\n            var xhr = new XMLHttpRequest();\r\n            xhr[AjaxMonitor.DisabledPropertyName] = true;\r\n            xhr.open(\"POST\", this._config.endpointUrl(), isAsync);\r\n            xhr.setRequestHeader(\"Content-type\", \"application/json\");\r\n            xhr.setRequestHeader(RequestHeaders.sdkContextHeader, RequestHeaders.sdkContextHeaderAppIdRequest);\r\n            xhr.onreadystatechange = () => this._xhrReadyStateChange(xhr, payload, payload.length);\r\n            xhr.onerror = (event: ErrorEvent) => this._onError(payload, this._formatErrorMessageXhr(xhr), event);\r\n\r\n            // compose an array of payloads\r\n            var batch = this._buffer.batchPayloads(payload);\r\n            xhr.send(batch);\r\n\r\n            this._buffer.markAsSent(payload);\r\n        }\r\n\r\n        /**\r\n         * Send XDomainRequest\r\n         * @param payload {string} - The data payload to be sent.\r\n         * @param isAsync {boolean} - Indicates if the request should be sent asynchronously\r\n         * \r\n         * Note: XDomainRequest does not support sync requests. This 'isAsync' parameter is added\r\n         * to maintain consistency with the xhrSender's contract\r\n         * Note: XDomainRequest does not support custom headers and we are not able to get\r\n         * appId from the backend for the correct correlation.\r\n         */\r\n        private _xdrSender(payload: string[], isAsync: boolean) {\r\n            var xdr = new XDomainRequest();\r\n            xdr.onload = () => this._xdrOnLoad(xdr, payload);\r\n            xdr.onerror = (event: ErrorEvent) => this._onError(payload, this._formatErrorMessageXdr(xdr), event);\r\n\r\n            // XDomainRequest requires the same protocol as the hosting page. \r\n            // If the protocol doesn't match, we can't send the telemetry :(. \r\n            var hostingProtocol = window.location.protocol\r\n            if (this._config.endpointUrl().lastIndexOf(hostingProtocol, 0) !== 0) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING,\r\n                    _InternalMessageId.TransmissionFailed, \". \" +\r\n                    \"Cannot send XDomain request. The endpoint URL protocol doesn't match the hosting page protocol.\");\r\n\r\n                this._buffer.clear();\r\n                return;\r\n            }\r\n\r\n            var endpointUrl = this._config.endpointUrl().replace(/^(https?:)/, \"\");\r\n            xdr.open('POST', endpointUrl);\r\n\r\n            // compose an array of payloads\r\n            var batch = this._buffer.batchPayloads(payload);\r\n            xdr.send(batch);\r\n\r\n            this._buffer.markAsSent(payload);\r\n        }\r\n\r\n        /**\r\n         * Send Beacon API request\r\n         * @param payload {string} - The data payload to be sent.\r\n         * @param isAsync {boolean} - not used\r\n         * Note: Beacon API does not support custom headers and we are not able to get\r\n         * appId from the backend for the correct correlation.\r\n         */\r\n        private _beaconSender(payload: string[], isAsync: boolean) {\r\n            var url = this._config.endpointUrl();\r\n            var batch = this._buffer.batchPayloads(payload);\r\n\r\n            // Chrome only allows CORS-safelisted values for the sendBeacon data argument\r\n            // see: https://bugs.chromium.org/p/chromium/issues/detail?id=720283\r\n            let plainTextBatch = new Blob([batch], { type: 'text/plain;charset=UTF-8' });\r\n            \r\n            // The sendBeacon method returns true if the user agent is able to successfully queue the data for transfer. Otherwise it returns false.\r\n            var queued = navigator.sendBeacon(url, plainTextBatch);\r\n\r\n            if (queued) {\r\n                this._buffer.markAsSent(payload);\r\n            } else {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL, _InternalMessageId.TransmissionFailed, \". \" + \"Failed to send telemetry with Beacon API.\");\r\n            }\r\n        }\r\n\r\n        /**\r\n         * xhr state changes\r\n         */\r\n        public _xhrReadyStateChange(xhr: XMLHttpRequest, payload: string[], countOfItemsInPayload: number) {\r\n            if (xhr.readyState === 4) {\r\n                var response: IBackendResponse = null;\r\n                if (!this._appId) {\r\n                    response = this._parseResponse(xhr.responseText || xhr.response);\r\n                    if (response && response.appId) {\r\n                        this._appId = response.appId;\r\n                    }\r\n                }\r\n                \r\n                if ((xhr.status < 200 || xhr.status >= 300) && xhr.status !== 0) {\r\n                    if (!this._config.isRetryDisabled() && this._isRetriable(xhr.status)) {\r\n                        this._resendPayload(payload);\r\n\r\n                        _InternalLogging.throwInternal(\r\n                            LoggingSeverity.WARNING,\r\n                            _InternalMessageId.TransmissionFailed, \". \" +\r\n                            \"Response code \" + xhr.status + \". Will retry to send \" + payload.length + \" items.\");\r\n                    } else {\r\n                        this._onError(payload, this._formatErrorMessageXhr(xhr));\r\n                    }\r\n                } else {\r\n                    if (xhr.status === 206) {\r\n                        if (!response) {\r\n                            response = this._parseResponse(xhr.responseText || xhr.response);\r\n                        }\r\n\r\n                        if (response && !this._config.isRetryDisabled()) {\r\n                            this._onPartialSuccess(payload, response);\r\n                        } else {\r\n                            this._onError(payload, this._formatErrorMessageXhr(xhr));\r\n                        }\r\n                    } else {\r\n                        this._consecutiveErrors = 0;\r\n                        this._onSuccess(payload, countOfItemsInPayload);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * xdr state changes\r\n         */\r\n        public _xdrOnLoad(xdr: XDomainRequest, payload: string[]) {\r\n            if (xdr && (xdr.responseText + \"\" === \"200\" || xdr.responseText === \"\")) {\r\n                this._consecutiveErrors = 0;\r\n                this._onSuccess(payload, 0);\r\n            } else {\r\n                var results = this._parseResponse(xdr.responseText);\r\n\r\n                if (results && results.itemsReceived && results.itemsReceived > results.itemsAccepted\r\n                    && !this._config.isRetryDisabled()) {\r\n                    this._onPartialSuccess(payload, results);\r\n                } else {\r\n                    this._onError(payload, this._formatErrorMessageXdr(xdr));\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * partial success handler\r\n         */\r\n        public _onPartialSuccess(payload: string[], results: IBackendResponse) {\r\n            var failed = [];\r\n            var retry = [];\r\n\r\n            // Iterate through the reversed array of errors so that splicing doesn't have invalid indexes after the first item.\r\n            var errors = results.errors.reverse();\r\n            for (var error of errors) {\r\n                var extracted = payload.splice(error.index, 1)[0];\r\n                if (this._isRetriable(error.statusCode)) {\r\n                    retry.push(extracted);\r\n                } else {\r\n                    // All other errors, including: 402 (Monthly quota exceeded) and 439 (Too many requests and refresh cache).\r\n                    failed.push(extracted);\r\n                }\r\n            }\r\n\r\n            if (payload.length > 0) {\r\n                this._onSuccess(payload, results.itemsAccepted);\r\n            }\r\n\r\n            if (failed.length > 0) {\r\n                this._onError(failed, this._formatErrorMessageXhr(null, ['partial success', results.itemsAccepted, 'of', results.itemsReceived].join(' ')));\r\n            }\r\n\r\n            if (retry.length > 0) {\r\n                this._resendPayload(retry);\r\n\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING,\r\n                    _InternalMessageId.TransmissionFailed, \"Partial success. \" +\r\n                    \"Delivered: \" + payload.length + \", Failed: \" + failed.length +\r\n                    \". Will retry to send \" + retry.length + \" our of \" + results.itemsReceived + \" items\");\r\n            }\r\n        }\r\n\r\n        /**\r\n         * error handler\r\n         */\r\n        public _onError(payload: string[], message: string, event?: ErrorEvent) {\r\n            _InternalLogging.throwInternal(\r\n                LoggingSeverity.WARNING,\r\n                _InternalMessageId.OnError,\r\n                \"Failed to send telemetry.\",\r\n                { message: message });\r\n\r\n            this._buffer.clearSent(payload);\r\n        }\r\n\r\n        /**\r\n         * success handler\r\n         */\r\n        public _onSuccess(payload: string[], countOfItemsInPayload: number) {\r\n            // Uncomment if you want to use DataLossanalyzer\r\n            // DataLossAnalyzer.decrementItemsQueued(countOfItemsInPayload);\r\n\r\n            this._buffer.clearSent(payload);\r\n        }\r\n    }\r\n\r\n    interface linkedListNode {\r\n        next: linkedListNode;\r\n        payload: string;\r\n    }\r\n}\r\n","// THIS FILE WAS AUTOGENERATED\r\n/// <reference path=\"Domain.ts\" />\r\n/// <reference path=\"SeverityLevel.ts\" />\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    \r\n    /**\r\n     * Instances of Message represent printf-like trace statements that are text-searched. Log4Net, NLog and other text-based log file entries are translated into intances of this type. The message does not have measurements.\r\n     */\r\n    export class MessageData extends Microsoft.Telemetry.Domain\r\n    {\r\n        \r\n        /**\r\n         * Schema version\r\n         */\r\n        public ver: number;\r\n        \r\n        /**\r\n         * Trace message\r\n         */\r\n        public message: string;\r\n        \r\n        /**\r\n         * Trace severity level.\r\n         */\r\n        public severityLevel: AI.SeverityLevel;\r\n        \r\n        /**\r\n         * Collection of custom properties.\r\n         */\r\n        public properties: any;\r\n        \r\n        constructor()\r\n        {\r\n            super();\r\n            \r\n            this.ver = 2;\r\n            this.properties = {};\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/MessageData.ts\" />\r\n/// <reference path=\"./Common/DataSanitizer.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    export class Trace extends AI.MessageData implements ISerializable {\r\n\r\n        public static envelopeType = \"Microsoft.ApplicationInsights.{0}.Message\";\r\n        public static dataType = \"MessageData\";\r\n\r\n        public aiDataContract = {\r\n            ver: FieldType.Required,\r\n            message: FieldType.Required,\r\n            severityLevel: FieldType.Default,\r\n            properties: FieldType.Default\r\n        };\r\n\r\n        /**\r\n         * Constructs a new instance of the TraceTelemetry object\r\n         */\r\n        constructor(message: string, properties?: any, severityLevel?: AI.SeverityLevel) {\r\n            super();\r\n            message = message || Util.NotSpecified;\r\n            this.message = Common.DataSanitizer.sanitizeMessage(message);\r\n            this.properties = Common.DataSanitizer.sanitizeProperties(properties);\r\n\r\n            if (severityLevel) {\r\n                this.severityLevel = severityLevel;\r\n            }\r\n        }\r\n    }\r\n}","/// <reference path=\"../../JavaScriptSDK.Interfaces/Telemetry/ISerializable.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/EventData.ts\" />\r\n/// <reference path=\"../Serializer.ts\" />\r\n/// <reference path=\"./Common/DataSanitizer.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    export class Event extends AI.EventData implements ISerializable {\r\n\r\n        public static envelopeType = \"Microsoft.ApplicationInsights.{0}.Event\";\r\n        public static dataType = \"EventData\";\r\n\r\n        public aiDataContract = {\r\n            ver: FieldType.Required,\r\n            name: FieldType.Required,\r\n            properties: FieldType.Default,\r\n            measurements: FieldType.Default\r\n        }\r\n\r\n        /**\r\n         * Constructs a new instance of the EventTelemetry object\r\n         */\r\n        constructor(name: string, properties?: any, measurements?: any) {\r\n            \r\n            super();\r\n\r\n            this.name = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeString(name) || Util.NotSpecified;\r\n            this.properties = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeProperties(properties);\r\n            this.measurements = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeMeasurements(measurements);\r\n        }\r\n    }\r\n}","// THIS FILE WAS AUTOGENERATED\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    \r\n    /**\r\n     * Exception details of the exception in a chain.\r\n     */\r\n    export class ExceptionDetails\r\n    {\r\n        \r\n        /**\r\n         * In case exception is nested (outer exception contains inner one), the id and outerId properties are used to represent the nesting.\r\n         */\r\n        public id: number;\r\n        \r\n        /**\r\n         * The value of outerId is a reference to an element in ExceptionDetails that represents the outer exception\r\n         */\r\n        public outerId: number;\r\n        \r\n        /**\r\n         * Exception type name.\r\n         */\r\n        public typeName: string;\r\n        \r\n        /**\r\n         * Exception message.\r\n         */\r\n        public message: string;\r\n        \r\n        /**\r\n         * Indicates if full exception stack is provided in the exception. The stack may be trimmed, such as in the case of a StackOverflow exception.\r\n         */\r\n        public hasFullStack: boolean;\r\n        \r\n        /**\r\n         * Text describing the stack. Either stack or parsedStack should have a value.\r\n         */\r\n        public stack: string;\r\n        \r\n        /**\r\n         * List of stack frames. Either stack or parsedStack should have a value.\r\n         */\r\n        public parsedStack: StackFrame[];\r\n        \r\n        constructor()\r\n        {\r\n            this.hasFullStack = true;\r\n            this.parsedStack = [];\r\n        }\r\n    }\r\n}\r\n","// THIS FILE WAS AUTOGENERATED\r\n/// <reference path=\"Domain.ts\" />\r\n/// <reference path=\"SeverityLevel.ts\" />\r\n/// <reference path=\"ExceptionDetails.ts\" />\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    \r\n    /**\r\n     * An instance of Exception represents a handled or unhandled exception that occurred during execution of the monitored application.\r\n     */\r\n    export class ExceptionData extends Microsoft.Telemetry.Domain\r\n    {\r\n        \r\n        /**\r\n         * Schema version\r\n         */\r\n        public ver: number;\r\n        \r\n        /**\r\n         * Exception chain - list of inner exceptions.\r\n         */\r\n        public exceptions: ExceptionDetails[];\r\n        \r\n        /**\r\n         * Severity level. Mostly used to indicate exception severity level when it is reported by logging library.\r\n         */\r\n        public severityLevel: AI.SeverityLevel;\r\n        \r\n        /**\r\n         * Collection of custom properties.\r\n         */\r\n        public properties: any;\r\n        \r\n        /**\r\n         * Collection of custom measurements.\r\n         */\r\n        public measurements: any;\r\n        \r\n        constructor()\r\n        {\r\n            super();\r\n            \r\n            this.ver = 2;\r\n            this.exceptions = [];\r\n            this.properties = {};\r\n            this.measurements = {};\r\n        }\r\n    }\r\n}\r\n","// THIS FILE WAS AUTOGENERATED\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    \r\n    /**\r\n     * Stack frame information.\r\n     */\r\n    export class StackFrame\r\n    {\r\n        \r\n        /**\r\n         * Level in the call stack. For the long stacks SDK may not report every function in a call stack.\r\n         */\r\n        public level: number;\r\n        \r\n        /**\r\n         * Method name.\r\n         */\r\n        public method: string;\r\n        \r\n        /**\r\n         * Name of the assembly (dll, jar, etc.) containing this function.\r\n         */\r\n        public assembly: string;\r\n        \r\n        /**\r\n         * File name or URL of the method implementation.\r\n         */\r\n        public fileName: string;\r\n        \r\n        /**\r\n         * Line number of the code implementation.\r\n         */\r\n        public line: number;\r\n        \r\n        constructor()\r\n        {\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../JavaScriptSDK.Interfaces/Telemetry/ISerializable.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/ExceptionData.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/StackFrame.ts\" />\r\n/// <reference path=\"../Serializer.ts\" />\r\n/// <reference path=\"./Common/DataSanitizer.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    export class Exception extends AI.ExceptionData implements ISerializable {\r\n\r\n        public static envelopeType = \"Microsoft.ApplicationInsights.{0}.Exception\";\r\n        public static dataType = \"ExceptionData\";\r\n\r\n\r\n        public aiDataContract = {\r\n            ver: FieldType.Required,\r\n            exceptions: FieldType.Required,\r\n            severityLevel: FieldType.Default,\r\n            properties: FieldType.Default,\r\n            measurements: FieldType.Default\r\n        }\r\n\r\n        /**\r\n        * Constructs a new isntance of the ExceptionTelemetry object\r\n        */\r\n        constructor(exception: Error, properties?: any, measurements?: any, severityLevel?: AI.SeverityLevel) {\r\n            super();\r\n\r\n            this.properties = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeProperties(properties);\r\n            this.measurements = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeMeasurements(measurements);\r\n\r\n            this.exceptions = [new _ExceptionDetails(exception)];\r\n\r\n            if (severityLevel) {\r\n                this.severityLevel = severityLevel;\r\n            }\r\n        }\r\n        \r\n\r\n        /**\r\n        * Creates a simple exception with 1 stack frame. Useful for manual constracting of exception.\r\n        */\r\n        public static CreateSimpleException(message: string, typeName: string, assembly: string, fileName: string,\r\n            details: string, line: number): Telemetry.Exception {\r\n\r\n            return <Telemetry.Exception> {\r\n                exceptions: [\r\n                    <AI.ExceptionDetails> {\r\n                        hasFullStack: true,\r\n                        message: message,\r\n                        stack: details,\r\n                        typeName: typeName\r\n                    }\r\n                ]\r\n            };\r\n        }\r\n    }\r\n\r\n    class _ExceptionDetails extends AI.ExceptionDetails implements ISerializable {\r\n\r\n        public aiDataContract = {\r\n            id: FieldType.Default,\r\n            outerId: FieldType.Default,\r\n            typeName: FieldType.Required,\r\n            message: FieldType.Required,\r\n            hasFullStack: FieldType.Default,\r\n            stack: FieldType.Default,\r\n            parsedStack: FieldType.Array\r\n        };\r\n\r\n        constructor(exception: Error) {\r\n            super();\r\n            this.typeName = Common.DataSanitizer.sanitizeString(exception.name) || Util.NotSpecified;\r\n            this.message = Common.DataSanitizer.sanitizeMessage(exception.message) || Util.NotSpecified;\r\n            var stack = exception[\"stack\"];\r\n            this.parsedStack = this.parseStack(stack);\r\n            this.stack = Common.DataSanitizer.sanitizeException(stack);\r\n            this.hasFullStack = Util.isArray(this.parsedStack) && this.parsedStack.length > 0;\r\n        }\r\n\r\n        private parseStack(stack): _StackFrame[] {\r\n            var parsedStack: _StackFrame[] = undefined;\r\n            if (typeof stack === \"string\") {\r\n                var frames = stack.split('\\n');\r\n                parsedStack = [];\r\n                var level = 0;\r\n\r\n                var totalSizeInBytes = 0;\r\n                for (var i = 0; i <= frames.length; i++) {\r\n                    var frame = frames[i];\r\n                    if (_StackFrame.regex.test(frame)) {\r\n                        var parsedFrame = new _StackFrame(frames[i], level++);\r\n                        totalSizeInBytes += parsedFrame.sizeInBytes;\r\n                        parsedStack.push(parsedFrame);\r\n                    }\r\n                }\r\n\r\n                // DP Constraint - exception parsed stack must be < 32KB\r\n                // remove frames from the middle to meet the threshold\r\n                var exceptionParsedStackThreshold = 32 * 1024;\r\n                if (totalSizeInBytes > exceptionParsedStackThreshold) {\r\n                    var left = 0;\r\n                    var right = parsedStack.length - 1;\r\n                    var size = 0;\r\n                    var acceptedLeft = left;\r\n                    var acceptedRight = right;\r\n\r\n                    while (left < right) {\r\n                        // check size\r\n                        var lSize = parsedStack[left].sizeInBytes;\r\n                        var rSize = parsedStack[right].sizeInBytes;\r\n                        size += lSize + rSize;\r\n\r\n                        if (size > exceptionParsedStackThreshold) {\r\n\r\n                            // remove extra frames from the middle\r\n                            var howMany = acceptedRight - acceptedLeft + 1;\r\n                            parsedStack.splice(acceptedLeft, howMany);\r\n                            break;\r\n                        }\r\n\r\n                        // update pointers\r\n                        acceptedLeft = left;\r\n                        acceptedRight = right;\r\n\r\n                        left++;\r\n                        right--;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return parsedStack;\r\n        }\r\n    }\r\n\r\n    export class _StackFrame extends AI.StackFrame implements ISerializable {\r\n        \r\n        // regex to match stack frames from ie/chrome/ff\r\n        // methodName=$2, fileName=$4, lineNo=$5, column=$6\r\n        public static regex = /^([\\s]+at)?(.*?)(\\@|\\s\\(|\\s)([^\\(\\@\\n]+):([0-9]+):([0-9]+)(\\)?)$/;\r\n        public static baseSize = 58; //'{\"method\":\"\",\"level\":,\"assembly\":\"\",\"fileName\":\"\",\"line\":}'.length\r\n        public sizeInBytes = 0;\r\n\r\n        public aiDataContract = {\r\n            level: FieldType.Required,\r\n            method: FieldType.Required,\r\n            assembly: FieldType.Default,\r\n            fileName: FieldType.Default,\r\n            line: FieldType.Default\r\n        };\r\n\r\n        constructor(frame: string, level: number) {\r\n            super();\r\n            this.level = level;\r\n            this.method = \"<no_method>\";\r\n            this.assembly = Util.trim(frame);\r\n            var matches = frame.match(_StackFrame.regex);\r\n            if (matches && matches.length >= 5) {\r\n                this.method = Util.trim(matches[2]) || this.method;\r\n                this.fileName = Util.trim(matches[4]);\r\n                this.line = parseInt(matches[5]) || 0;\r\n            }\r\n\r\n            this.sizeInBytes += this.method.length;\r\n            this.sizeInBytes += this.fileName.length;\r\n            this.sizeInBytes += this.assembly.length;\r\n\r\n            // todo: these might need to be removed depending on how the back-end settles on their size calculation\r\n            this.sizeInBytes += _StackFrame.baseSize;\r\n            this.sizeInBytes += this.level.toString().length;\r\n            this.sizeInBytes += this.line.toString().length;\r\n        }\r\n    }\r\n}","// THIS FILE WAS AUTOGENERATED\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    \r\n    /**\r\n     * Type of the metric data measurement.\r\n     */\r\n    export enum DataPointType\r\n    {\r\n        Measurement = 0,\r\n        Aggregation = 1,\r\n    }\r\n}\r\n","// THIS FILE WAS AUTOGENERATED\r\n/// <reference path=\"DataPointType.ts\" />\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    \r\n    /**\r\n     * Metric data single measurement.\r\n     */\r\n    export class DataPoint\r\n    {\r\n        \r\n        /**\r\n         * Name of the metric.\r\n         */\r\n        public name: string;\r\n        \r\n        /**\r\n         * Metric type. Single measurement or the aggregated value.\r\n         */\r\n        public kind: AI.DataPointType;\r\n        \r\n        /**\r\n         * Single value for measurement. Sum of individual measurements for the aggregation.\r\n         */\r\n        public value: number;\r\n        \r\n        /**\r\n         * Metric weight of the aggregated metric. Should not be set for a measurement.\r\n         */\r\n        public count: number;\r\n        \r\n        /**\r\n         * Minimum value of the aggregated metric. Should not be set for a measurement.\r\n         */\r\n        public min: number;\r\n        \r\n        /**\r\n         * Maximum value of the aggregated metric. Should not be set for a measurement.\r\n         */\r\n        public max: number;\r\n        \r\n        /**\r\n         * Standard deviation of the aggregated metric. Should not be set for a measurement.\r\n         */\r\n        public stdDev: number;\r\n        \r\n        constructor()\r\n        {\r\n            this.kind = AI.DataPointType.Measurement;\r\n        }\r\n    }\r\n}\r\n","// THIS FILE WAS AUTOGENERATED\r\n/// <reference path=\"Domain.ts\" />\r\n/// <reference path=\"DataPoint.ts\" />\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    \r\n    /**\r\n     * An instance of the Metric item is a list of measurements (single data points) and/or aggregations.\r\n     */\r\n    export class MetricData extends Microsoft.Telemetry.Domain\r\n    {\r\n        \r\n        /**\r\n         * Schema version\r\n         */\r\n        public ver: number;\r\n        \r\n        /**\r\n         * List of metrics. Only one metric in the list is currently supported by Application Insights storage. If multiple data points were sent only the first one will be used.\r\n         */\r\n        public metrics: DataPoint[];\r\n        \r\n        /**\r\n         * Collection of custom properties.\r\n         */\r\n        public properties: any;\r\n        \r\n        constructor()\r\n        {\r\n            super();\r\n            \r\n            this.ver = 2;\r\n            this.metrics = [];\r\n            this.properties = {};\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../../JavaScriptSDK.Interfaces/Contracts/Generated/DataPoint.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry.Common {\r\n    \"use strict\";\r\n    export class DataPoint extends AI.DataPoint implements ISerializable {\r\n\r\n        /**\r\n         * The data contract for serializing this object.\r\n         */\r\n        public aiDataContract = {\r\n            name: FieldType.Required,\r\n            kind: FieldType.Default,\r\n            value: FieldType.Required,\r\n            count: FieldType.Default,\r\n            min: FieldType.Default,\r\n            max: FieldType.Default,\r\n            stdDev: FieldType.Default\r\n        }\r\n    }\r\n}","/// <reference path=\"../../JavaScriptSDK.Interfaces/Telemetry/ISerializable.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/MetricData.ts\" />\r\n/// <reference path=\"../Serializer.ts\" />\r\n/// <reference path=\"./Common/DataSanitizer.ts\" />\r\n/// <reference path=\"./Common/DataPoint.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    export class Metric extends AI.MetricData implements ISerializable {\r\n\r\n        public static envelopeType = \"Microsoft.ApplicationInsights.{0}.Metric\";\r\n        public static dataType = \"MetricData\";\r\n\r\n        public aiDataContract = {\r\n            ver: FieldType.Required,\r\n            metrics: FieldType.Required,\r\n            properties: FieldType.Default\r\n        }\r\n\r\n        /**\r\n         * Constructs a new instance of the MetricTelemetry object\r\n         */\r\n        constructor(name: string, value: number, count?: number, min?: number, max?: number, properties?: any) {\r\n            super();\r\n\r\n            var dataPoint = new Microsoft.ApplicationInsights.Telemetry.Common.DataPoint();\r\n            dataPoint.count = count > 0 ? count : undefined;\r\n            dataPoint.max = isNaN(max) || max === null ? undefined : max;\r\n            dataPoint.min = isNaN(min) || min === null ? undefined : min;\r\n            dataPoint.name = Common.DataSanitizer.sanitizeString(name) || Util.NotSpecified;\r\n            dataPoint.value = value;\r\n\r\n            this.metrics = [dataPoint];\r\n            this.properties = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeProperties(properties);\r\n        }\r\n    }\r\n}","/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/PageViewData.ts\" />\r\n/// <reference path=\"./Common/DataSanitizer.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    export class PageView extends AI.PageViewData implements ISerializable {\r\n\r\n        public static envelopeType = \"Microsoft.ApplicationInsights.{0}.Pageview\";\r\n        public static dataType = \"PageviewData\";\r\n\r\n        public aiDataContract = {            \r\n            ver: FieldType.Required,\r\n            name: FieldType.Default,\r\n            url: FieldType.Default,\r\n            duration: FieldType.Default,\r\n            properties: FieldType.Default,\r\n            measurements: FieldType.Default,\r\n            id: FieldType.Default,\r\n        }\r\n\r\n        /**\r\n         * Constructs a new instance of the PageEventTelemetry object\r\n         */\r\n        constructor(name?: string, url?: string, durationMs?: number, properties?: any, measurements?: any, id?: string) {\r\n            super();\r\n\r\n            this.id = Common.DataSanitizer.sanitizeId(id);\r\n            this.url = Common.DataSanitizer.sanitizeUrl(url);\r\n            this.name = Common.DataSanitizer.sanitizeString(name) || Util.NotSpecified;\r\n            if (!isNaN(durationMs)) {\r\n                this.duration = Util.msToTimeSpan(durationMs);\r\n            }\r\n            this.properties = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeProperties(properties);\r\n            this.measurements = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeMeasurements(measurements);\r\n        }\r\n    }\r\n}","// THIS FILE WAS AUTOGENERATED\r\n/// <reference path=\"PageViewData.ts\" />\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    \r\n    /**\r\n     * An instance of PageViewPerf represents: a page view with no performance data, a page view with performance data, or just the performance data of an earlier page request.\r\n     */\r\n    export class PageViewPerfData extends AI.PageViewData\r\n    {\r\n        \r\n        /**\r\n         * Schema version\r\n         */\r\n        public ver: number;\r\n        \r\n        /**\r\n         * Request URL with all query string parameters\r\n         */\r\n        public url: string;\r\n        \r\n        /**\r\n         * Performance total in TimeSpan 'G' (general long) format: d:hh:mm:ss.fffffff\r\n         */\r\n        public perfTotal: string;\r\n        \r\n        /**\r\n         * Event name. Keep it low cardinality to allow proper grouping and useful metrics.\r\n         */\r\n        public name: string;\r\n        \r\n        /**\r\n         * Request duration in format: DD.HH:MM:SS.MMMMMM. For a page view (PageViewData), this is the duration. For a page view with performance information (PageViewPerfData), this is the page load time. Must be less than 1000 days.\r\n         */\r\n        public duration: string;\r\n        \r\n        /**\r\n         * Network connection time in TimeSpan 'G' (general long) format: d:hh:mm:ss.fffffff\r\n         */\r\n        public networkConnect: string;\r\n        \r\n        /**\r\n         * Sent request time in TimeSpan 'G' (general long) format: d:hh:mm:ss.fffffff\r\n         */\r\n        public sentRequest: string;\r\n        \r\n        /**\r\n         * Received response time in TimeSpan 'G' (general long) format: d:hh:mm:ss.fffffff\r\n         */\r\n        public receivedResponse: string;\r\n        \r\n        /**\r\n         * DOM processing time in TimeSpan 'G' (general long) format: d:hh:mm:ss.fffffff\r\n         */\r\n        public domProcessing: string;\r\n        \r\n        /**\r\n         * Collection of custom properties.\r\n         */\r\n        public properties: any;\r\n        \r\n        /**\r\n         * Collection of custom measurements.\r\n         */\r\n        public measurements: any;\r\n        \r\n        constructor()\r\n        {\r\n            super();\r\n            \r\n            this.ver = 2;\r\n            this.properties = {};\r\n            this.measurements = {};\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/PageViewPerfData.ts\"/>\r\n/// <reference path=\"../Serializer.ts\" />\r\n/// <reference path=\"./Common/DataSanitizer.ts\"/>\r\n/// <reference path=\"../Util.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    export class PageViewPerformance extends AI.PageViewPerfData implements ISerializable {\r\n\r\n        public static envelopeType = \"Microsoft.ApplicationInsights.{0}.PageviewPerformance\";\r\n        public static dataType = \"PageviewPerformanceData\";\r\n\r\n        private static MAX_DURATION_ALLOWED = 3600000; // 1h\r\n\r\n        public aiDataContract = {\r\n            ver: FieldType.Required,\r\n            name: FieldType.Default,\r\n            url: FieldType.Default,\r\n            duration: FieldType.Default,\r\n            perfTotal: FieldType.Default,\r\n            networkConnect: FieldType.Default,\r\n            sentRequest: FieldType.Default,\r\n            receivedResponse: FieldType.Default,\r\n            domProcessing: FieldType.Default,\r\n            properties: FieldType.Default,\r\n            measurements: FieldType.Default\r\n        };\r\n\r\n        /**\r\n         * Field indicating whether this instance of PageViewPerformance is valid and should be sent\r\n         */\r\n        private isValid: boolean;\r\n\r\n        /**\r\n         * Indicates whether this instance of PageViewPerformance is valid and should be sent\r\n         */\r\n        public getIsValid() {\r\n            return this.isValid;\r\n        }\r\n\r\n        private durationMs: number;\r\n\r\n        /**\r\n        * Gets the total duration (PLT) in milliseconds. Check getIsValid() before using this method.\r\n        */\r\n        public getDurationMs() {\r\n            return this.durationMs;\r\n        }\r\n\r\n        /**\r\n         * Constructs a new instance of the PageEventTelemetry object\r\n         */\r\n        constructor(name: string, url: string, unused: number, properties?: any, measurements?: any) {\r\n            super();\r\n\r\n            this.isValid = false;\r\n\r\n            /*\r\n             * http://www.w3.org/TR/navigation-timing/#processing-model\r\n             *  |-navigationStart\r\n             *  |             |-connectEnd\r\n             *  |             ||-requestStart\r\n             *  |             ||             |-responseStart\r\n             *  |             ||             |              |-responseEnd\r\n             *  |             ||             |              |\r\n             *  |             ||             |              |         |-loadEventEnd\r\n             *  |---network---||---request---|---response---|---dom---|\r\n             *  |--------------------------total----------------------|\r\n             */\r\n            var timing = PageViewPerformance.getPerformanceTiming();\r\n            if (timing) {\r\n                var total = PageViewPerformance.getDuration(timing.navigationStart, timing.loadEventEnd);\r\n                var network = PageViewPerformance.getDuration(timing.navigationStart, timing.connectEnd);\r\n                var request = PageViewPerformance.getDuration(timing.requestStart, timing.responseStart);\r\n                var response = PageViewPerformance.getDuration(timing.responseStart, timing.responseEnd);\r\n                var dom = PageViewPerformance.getDuration(timing.responseEnd, timing.loadEventEnd);\r\n\r\n                if (total == 0) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.ErrorPVCalc,\r\n                        \"error calculating page view performance.\",\r\n                        { total: total, network: network, request: request, response: response, dom: dom });\r\n\r\n                } else if (!PageViewPerformance.shouldCollectDuration(total, network, request, response, dom)) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.InvalidDurationValue,\r\n                        \"Invalid page load duration value. Browser perf data won't be sent.\",\r\n                        { total: total, network: network, request: request, response: response, dom: dom });\r\n\r\n                } else if (total < Math.floor(network) + Math.floor(request) + Math.floor(response) + Math.floor(dom)) {\r\n                    // some browsers may report individual components incorrectly so that the sum of the parts will be bigger than total PLT\r\n                    // in this case, don't report client performance from this page\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.ClientPerformanceMathError,\r\n                        \"client performance math error.\",\r\n                        { total: total, network: network, request: request, response: response, dom: dom });\r\n\r\n                } else {\r\n                    this.durationMs = total;\r\n\r\n                    // convert to timespans\r\n                    this.perfTotal = this.duration = Util.msToTimeSpan(total);\r\n                    this.networkConnect = Util.msToTimeSpan(network);\r\n                    this.sentRequest = Util.msToTimeSpan(request);\r\n                    this.receivedResponse = Util.msToTimeSpan(response);\r\n                    this.domProcessing = Util.msToTimeSpan(dom);\r\n\r\n                    this.isValid = true;\r\n                }\r\n            }\r\n\r\n            this.url = Common.DataSanitizer.sanitizeUrl(url);\r\n            this.name = Common.DataSanitizer.sanitizeString(name) || Util.NotSpecified;\r\n\r\n            this.properties = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeProperties(properties);\r\n            this.measurements = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeMeasurements(measurements);\r\n        }\r\n\r\n        public static getPerformanceTiming(): PerformanceTiming {\r\n            if (PageViewPerformance.isPerformanceTimingSupported()) {\r\n                return window.performance.timing;\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        /**\r\n        * Returns true is window performance timing API is supported, false otherwise.\r\n        */\r\n        public static isPerformanceTimingSupported() {\r\n            return typeof window != \"undefined\" && window.performance && window.performance.timing;\r\n        }\r\n\r\n        /**\r\n         * As page loads different parts of performance timing numbers get set. When all of them are set we can report it.\r\n         * Returns true if ready, false otherwise.\r\n         */\r\n        public static isPerformanceTimingDataReady() {\r\n            var timing = window.performance.timing;\r\n\r\n            return timing.domainLookupStart > 0\r\n                && timing.navigationStart > 0\r\n                && timing.responseStart > 0\r\n                && timing.requestStart > 0\r\n                && timing.loadEventEnd > 0\r\n                && timing.responseEnd > 0\r\n                && timing.connectEnd > 0\r\n                && timing.domLoading > 0;\r\n        }\r\n\r\n        public static getDuration(start: any, end: any): number {\r\n            var duration = undefined;\r\n            if (!(isNaN(start) || isNaN(end))) {\r\n                duration = Math.max(end - start, 0);\r\n            }\r\n\r\n            return duration;\r\n        }\r\n\r\n        /**\r\n         * This method tells if given durations should be excluded from collection.\r\n         */\r\n        public static shouldCollectDuration(...durations: number[]): boolean {\r\n            // a full list of Google crawlers user agent strings - https://support.google.com/webmasters/answer/1061943?hl=en\r\n            let botAgentNames = ['googlebot', 'adsbot-google', 'apis-google', 'mediapartners-google'];\r\n            let userAgent = navigator.userAgent;\r\n            let isGoogleBot = false;\r\n\r\n            if (userAgent) {\r\n                for(let i =0; i<botAgentNames.length; i++) {\r\n                    isGoogleBot = isGoogleBot || userAgent.toLowerCase().indexOf(botAgentNames[i]) !== -1;\r\n                }\r\n            }\r\n\r\n            if (isGoogleBot) {\r\n                // Don't report durations for GoogleBot, it is returning invalid values in performance.timing API. \r\n                return false;\r\n            } else {\r\n                // for other page views, don't report if it's outside of a reasonable range\r\n                for (var i = 0; i < durations.length; i++) {\r\n                    if (durations[i] >= PageViewPerformance.MAX_DURATION_ALLOWED) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return true;\r\n        }\r\n    }\r\n}","/// <reference path=\"Sender.ts\"/>\r\n/// <reference path=\"Telemetry/Trace.ts\" />\r\n/// <reference path=\"Telemetry/Event.ts\" />\r\n/// <reference path=\"Telemetry/Exception.ts\" />\r\n/// <reference path=\"Telemetry/Metric.ts\" />\r\n/// <reference path=\"Telemetry/PageView.ts\" />\r\n/// <reference path=\"Telemetry/PageViewPerformance.ts\" />\r\n/// <reference path=\"./Util.ts\"/>\r\n/// <reference path=\"../JavaScriptSDK.Interfaces/ITelemetryContext.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    export interface ITelemetryConfig extends ISenderConfig {\r\n        instrumentationKey: () => string;\r\n        accountId: () => string;\r\n        sessionRenewalMs: () => number;\r\n        sessionExpirationMs: () => number;\r\n        sampleRate: () => number;\r\n        cookieDomain: () => string;\r\n        sdkExtension: () => string;\r\n        isBrowserLinkTrackingEnabled: () => boolean;\r\n        appId: () => string;\r\n    }\r\n\r\n    export class TelemetryContext implements ITelemetryContext {\r\n        /**\r\n         * The configuration for this telemetry context\r\n         */\r\n        public _config: ITelemetryConfig;\r\n\r\n        /**\r\n         * The sender instance for this context\r\n         */\r\n        public _sender: Sender;\r\n\r\n        /**\r\n         * The object describing a component tracked by this object.\r\n         */\r\n        public application: Context.Application;\r\n\r\n        /**\r\n         * The object describing a device tracked by this object.\r\n         */\r\n        public device: Context.Device;\r\n\r\n        public internal: Context.Internal;\r\n\r\n        /**\r\n         * The object describing a location tracked by this object.\r\n         */\r\n        public location: Context.Location;\r\n\r\n        /**\r\n         * The object describing a operation tracked by this object.\r\n         */\r\n        public operation: Context.Operation;\r\n\r\n        public sample: Context.Sample;\r\n\r\n        /**\r\n         * The object describing a user tracked by this object.\r\n         */\r\n        public user: Context.User;\r\n\r\n        /**\r\n         * The object describing a session tracked by this object.\r\n         */\r\n        public session: Context.Session;\r\n\r\n        /**\r\n         * AppId of this component if returned by the backend.\r\n         */\r\n        public appId: () => string;\r\n\r\n        /**\r\n        * The array of telemetry initializers to call before sending each telemetry item.\r\n        */\r\n        private telemetryInitializers: { (envelope: Microsoft.ApplicationInsights.IEnvelope): boolean | void; }[];\r\n\r\n        /**\r\n         * The session manager that manages session on the base of cookies.\r\n         */\r\n        public _sessionManager: Microsoft.ApplicationInsights.Context._SessionManager;\r\n\r\n        constructor(config: ITelemetryConfig) {\r\n            this._config = config;\r\n            this._sender = new Sender(config);\r\n            this.appId = () => this._sender._appId;\r\n\r\n            // use appId set in config instead of getting it from the backend\r\n            if (config.appId()) {\r\n                this._sender._appId = config.appId();\r\n            }\r\n\r\n            this.telemetryInitializers = [];\r\n\r\n            // window will be undefined in node.js where we do not want to initialize contexts\r\n            if (typeof window !== 'undefined') {\r\n                this._sessionManager = new ApplicationInsights.Context._SessionManager(config);\r\n                this.application = new Context.Application();\r\n                this.device = new Context.Device();\r\n                this.internal = new Context.Internal(config);\r\n                this.location = new Context.Location();\r\n                this.user = new Context.User(config);\r\n                this.operation = new Context.Operation();\r\n                this.session = new Context.Session();\r\n                this.sample = new Context.Sample(config.sampleRate());\r\n            }\r\n\r\n            this._addDefaultTelemetryInitializers();\r\n        }\r\n\r\n        /**\r\n        * Adds telemetry initializer to the collection. Telemetry initializers will be called one by one\r\n        * before telemetry item is pushed for sending and in the order they were added.\r\n        */\r\n        public addTelemetryInitializer(telemetryInitializer: (envelope: Microsoft.ApplicationInsights.IEnvelope) => boolean | void) {\r\n            this.telemetryInitializers.push(telemetryInitializer);\r\n        }\r\n\r\n        /**\r\n         * Use Sender.ts to send telemetry object to the endpoint\r\n         */\r\n        public track(envelope: Microsoft.ApplicationInsights.IEnvelope) {\r\n            if (!envelope) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.TrackArgumentsNotSpecified,\r\n                    \"cannot call .track() with a null or undefined argument\", null, true);\r\n            } else {\r\n                // If the envelope is PageView, reset the internal message count so that we can send internal telemetry for the new page.\r\n                if (envelope.name === Telemetry.PageView.envelopeType) {\r\n                    _InternalLogging.resetInternalMessageCount();\r\n                }\r\n\r\n                if (this.session) {\r\n                    // If customer did not provide custom session id update sessionmanager\r\n                    if (typeof this.session.id !== \"string\") {\r\n                        this._sessionManager.update();\r\n                    }\r\n                }\r\n\r\n                this._track(envelope);\r\n            }\r\n\r\n            return envelope;\r\n        }\r\n\r\n        private _addDefaultTelemetryInitializers() {\r\n            if (!this._config.isBrowserLinkTrackingEnabled()) {\r\n                const browserLinkPaths = ['/browserLinkSignalR/', '/__browserLink/'];\r\n                let dropBrowserLinkRequests = (envelope: Microsoft.ApplicationInsights.IEnvelope) => {\r\n                    if (envelope.name === Microsoft.ApplicationInsights.Telemetry.RemoteDependencyData.envelopeType) {\r\n                        let remoteData = envelope.data as Telemetry.Common.Data<Microsoft.ApplicationInsights.Telemetry.RemoteDependencyData>;\r\n                        if (remoteData && remoteData.baseData) {\r\n                            for (let i = 0; i < browserLinkPaths.length; i++) {\r\n                                if (remoteData.baseData.name.indexOf(browserLinkPaths[i]) >= 0) {\r\n                                    return false;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    return true;\r\n                }\r\n\r\n                this.addTelemetryInitializer(dropBrowserLinkRequests)\r\n            }\r\n        }\r\n\r\n        private _track(envelope: Microsoft.ApplicationInsights.IEnvelope) {\r\n\r\n            if (this.session) {\r\n                // If customer set id, apply his context; otherwise apply context generated from cookies \r\n                if (typeof this.session.id === \"string\") {\r\n                    this._applySessionContext(envelope, this.session);\r\n                } else {\r\n                    this._applySessionContext(envelope, this._sessionManager.automaticSession);\r\n                }\r\n            }\r\n\r\n            this._applyApplicationContext(envelope, this.application);\r\n            this._applyDeviceContext(envelope, this.device);\r\n            this._applyInternalContext(envelope, this.internal);\r\n            this._applyLocationContext(envelope, this.location);\r\n            this._applySampleContext(envelope, this.sample);\r\n            this._applyUserContext(envelope, this.user);\r\n            this._applyOperationContext(envelope, this.operation);\r\n\r\n            envelope.iKey = this._config.instrumentationKey();\r\n\r\n            var doNotSendItem = false;\r\n            try {\r\n                var telemetryInitializersCount = this.telemetryInitializers.length;\r\n                for (var i = 0; i < telemetryInitializersCount; ++i) {\r\n                    var telemetryInitializer = this.telemetryInitializers[i];\r\n                    if (telemetryInitializer) {\r\n                        if (telemetryInitializer.apply(null, [envelope]) === false) {\r\n                            doNotSendItem = true;\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                doNotSendItem = true;\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.CRITICAL, _InternalMessageId.TelemetryInitializerFailed, \"One of telemetry initializers failed, telemetry item will not be sent: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) }, true);\r\n            }\r\n\r\n            if (!doNotSendItem) {\r\n                if (envelope.name === Telemetry.Metric.envelopeType ||\r\n                    this.sample.isSampledIn(envelope)) {\r\n                    var iKeyNoDashes = this._config.instrumentationKey().replace(/-/g, \"\");\r\n                    envelope.name = envelope.name.replace(\"{0}\", iKeyNoDashes);\r\n                    this._sender.send(envelope);\r\n                } else {\r\n                    _InternalLogging.throwInternal(LoggingSeverity.WARNING, _InternalMessageId.TelemetrySampledAndNotSent,\r\n                        \"Telemetry is sampled and not sent to the AI service.\", { SampleRate: this.sample.sampleRate }, true);\r\n                }\r\n            }\r\n\r\n            return envelope;\r\n        }\r\n\r\n        private _applyApplicationContext(envelope: Microsoft.ApplicationInsights.IEnvelope, appContext: Microsoft.ApplicationInsights.Context.Application) {\r\n            if (appContext) {\r\n                var tagKeys: AI.ContextTagKeys = new AI.ContextTagKeys();\r\n\r\n                if (typeof appContext.ver === \"string\") {\r\n                    envelope.tags[tagKeys.applicationVersion] = appContext.ver;\r\n                }\r\n                if (typeof appContext.build === \"string\") {\r\n                    envelope.tags[tagKeys.applicationBuild] = appContext.build;\r\n                }\r\n            }\r\n        }\r\n\r\n        private _applyDeviceContext(envelope: Microsoft.ApplicationInsights.IEnvelope, deviceContext: Microsoft.ApplicationInsights.Context.Device) {\r\n            var tagKeys: AI.ContextTagKeys = new AI.ContextTagKeys();\r\n\r\n            if (deviceContext) {\r\n                if (typeof deviceContext.id === \"string\") {\r\n                    envelope.tags[tagKeys.deviceId] = deviceContext.id;\r\n                }\r\n                if (typeof deviceContext.ip === \"string\") {\r\n                    envelope.tags[tagKeys.deviceIp] = deviceContext.ip;\r\n                }\r\n                if (typeof deviceContext.language === \"string\") {\r\n                    envelope.tags[tagKeys.deviceLanguage] = deviceContext.language;\r\n                }\r\n                if (typeof deviceContext.locale === \"string\") {\r\n                    envelope.tags[tagKeys.deviceLocale] = deviceContext.locale;\r\n                }\r\n                if (typeof deviceContext.model === \"string\") {\r\n                    envelope.tags[tagKeys.deviceModel] = deviceContext.model;\r\n                }\r\n                if (typeof deviceContext.network !== \"undefined\") {\r\n                    envelope.tags[tagKeys.deviceNetwork] = deviceContext.network;\r\n                }\r\n                if (typeof deviceContext.oemName === \"string\") {\r\n                    envelope.tags[tagKeys.deviceOEMName] = deviceContext.oemName;\r\n                }\r\n                if (typeof deviceContext.os === \"string\") {\r\n                    envelope.tags[tagKeys.deviceOS] = deviceContext.os;\r\n                }\r\n                if (typeof deviceContext.osversion === \"string\") {\r\n                    envelope.tags[tagKeys.deviceOSVersion] = deviceContext.osversion;\r\n                }\r\n                if (typeof deviceContext.resolution === \"string\") {\r\n                    envelope.tags[tagKeys.deviceScreenResolution] = deviceContext.resolution;\r\n                }\r\n                if (typeof deviceContext.type === \"string\") {\r\n                    envelope.tags[tagKeys.deviceType] = deviceContext.type;\r\n                }\r\n            }\r\n        }\r\n\r\n        private _applyInternalContext(envelope: Microsoft.ApplicationInsights.IEnvelope, internalContext: Microsoft.ApplicationInsights.Context.Internal) {\r\n            if (internalContext) {\r\n                var tagKeys: AI.ContextTagKeys = new AI.ContextTagKeys();\r\n                if (typeof internalContext.agentVersion === \"string\") {\r\n                    envelope.tags[tagKeys.internalAgentVersion] = internalContext.agentVersion;\r\n                }\r\n                if (typeof internalContext.sdkVersion === \"string\") {\r\n                    envelope.tags[tagKeys.internalSdkVersion] = internalContext.sdkVersion;\r\n                }\r\n            }\r\n        }\r\n\r\n        private _applyLocationContext(envelope: Microsoft.ApplicationInsights.IEnvelope, locationContext: Microsoft.ApplicationInsights.Context.Location) {\r\n            if (locationContext) {\r\n                var tagKeys: AI.ContextTagKeys = new AI.ContextTagKeys();\r\n                if (typeof locationContext.ip === \"string\") {\r\n                    envelope.tags[tagKeys.locationIp] = locationContext.ip;\r\n                }\r\n            }\r\n        }\r\n\r\n        private _applyOperationContext(envelope: Microsoft.ApplicationInsights.IEnvelope, operationContext: Microsoft.ApplicationInsights.Context.Operation) {\r\n            if (operationContext) {\r\n                var tagKeys: AI.ContextTagKeys = new AI.ContextTagKeys();\r\n                if (typeof operationContext.id === \"string\") {\r\n                    envelope.tags[tagKeys.operationId] = operationContext.id;\r\n                }\r\n                if (typeof operationContext.name === \"string\") {\r\n                    envelope.tags[tagKeys.operationName] = operationContext.name;\r\n                }\r\n                if (typeof operationContext.parentId === \"string\") {\r\n                    envelope.tags[tagKeys.operationParentId] = operationContext.parentId;\r\n                }\r\n                if (typeof operationContext.rootId === \"string\") {\r\n                    envelope.tags[tagKeys.operationRootId] = operationContext.rootId;\r\n                }\r\n                if (typeof operationContext.syntheticSource === \"string\") {\r\n                    envelope.tags[tagKeys.operationSyntheticSource] = operationContext.syntheticSource;\r\n                }\r\n            }\r\n        }\r\n\r\n        private _applySampleContext(envelope: Microsoft.ApplicationInsights.IEnvelope, sampleContext: Microsoft.ApplicationInsights.Context.Sample) {\r\n            if (sampleContext) {\r\n                envelope.sampleRate = sampleContext.sampleRate;\r\n            }\r\n        }\r\n\r\n        private _applySessionContext(envelope: Microsoft.ApplicationInsights.IEnvelope, sessionContext: Microsoft.ApplicationInsights.Context.Session) {\r\n            if (sessionContext) {\r\n                var tagKeys: AI.ContextTagKeys = new AI.ContextTagKeys();\r\n                if (typeof sessionContext.id === \"string\") {\r\n                    envelope.tags[tagKeys.sessionId] = sessionContext.id;\r\n                }\r\n                if (typeof sessionContext.isFirst !== \"undefined\") {\r\n                    envelope.tags[tagKeys.sessionIsFirst] = sessionContext.isFirst;\r\n                }\r\n            }\r\n        }\r\n\r\n        private _applyUserContext(envelope: Microsoft.ApplicationInsights.IEnvelope, userContext: Microsoft.ApplicationInsights.Context.User) {\r\n            if (userContext) {\r\n                var tagKeys: AI.ContextTagKeys = new AI.ContextTagKeys();\r\n                if (typeof userContext.accountId === \"string\") {\r\n                    envelope.tags[tagKeys.userAccountId] = userContext.accountId;\r\n                }\r\n                if (typeof userContext.agent === \"string\") {\r\n                    envelope.tags[tagKeys.userAgent] = userContext.agent;\r\n                }\r\n                if (typeof userContext.id === \"string\") {\r\n                    envelope.tags[tagKeys.userId] = userContext.id;\r\n                }\r\n                if (typeof userContext.authenticatedId === \"string\") {\r\n                    envelope.tags[tagKeys.userAuthUserId] = userContext.authenticatedId;\r\n                }\r\n                if (typeof userContext.storeRegion === \"string\") {\r\n                    envelope.tags[tagKeys.userStoreRegion] = userContext.storeRegion;\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","// THIS FILE WAS AUTOGENERATED\r\n/// <reference path=\"Base.ts\" />\r\nmodule Microsoft.Telemetry\r\n{\r\n\"use strict\";\r\n    \r\n    /**\r\n     * Data struct to contain both B and C sections.\r\n     */\r\n    export class Data<TDomain> extends Microsoft.Telemetry.Base\r\n    {\r\n        \r\n        /**\r\n         * Name of item (B section) if any. If telemetry data is derived straight from this, this should be null.\r\n         */\r\n        public baseType: string;\r\n        \r\n        /**\r\n         * Container for data item (B section).\r\n         */\r\n        public baseData: TDomain;\r\n        \r\n        constructor()\r\n        {\r\n            super();\r\n            \r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../../JavaScriptSDK.Interfaces/Contracts/Generated/Data.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry.Common {\r\n    \"use strict\";\r\n    export class Data<TDomain> extends Microsoft.Telemetry.Data<TDomain> implements ISerializable {\r\n\r\n        /**\r\n         * The data contract for serializing this object.\r\n         */\r\n        public aiDataContract = {\r\n            baseType: FieldType.Required,\r\n            baseData: FieldType.Required\r\n        }\r\n\r\n        /**\r\n         * Constructs a new instance of telemetry data.\r\n         */\r\n        constructor(type: string, data: TDomain) {\r\n            super();\r\n\r\n            this.baseType = type;\r\n            this.baseData = data;\r\n        }\r\n    }\r\n}","/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/PageViewData.ts\" />\r\n/// <reference path=\"./Common/DataSanitizer.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    /**\r\n    * Class encapsulates sending page views and page view performance telemetry.\r\n    */\r\n    export class PageViewManager {\r\n        private pageViewPerformanceSent: boolean = false;\r\n\r\n        private overridePageViewDuration: boolean = false;\r\n\r\n        private appInsights: IAppInsightsInternal;\r\n\r\n        constructor(\r\n            appInsights: IAppInsightsInternal,\r\n            overridePageViewDuration: boolean) {\r\n            this.overridePageViewDuration = overridePageViewDuration;\r\n            this.appInsights = appInsights;\r\n        }\r\n\r\n        /**\r\n        * Currently supported cases:\r\n        * 1) (default case) track page view called with default parameters, overridePageViewDuration = false. Page view is sent with page view performance when navigation timing data is available.\r\n        *    If navigation timing is not supported then page view is sent right away with undefined duration. Page view performance is not sent.\r\n        * 2) overridePageViewDuration = true, custom duration provided. Custom duration is used, page view sends right away.\r\n        * 3) overridePageViewDuration = true. Page view is sent right away, duration is time spent from page load till now (or undefined if navigation timing is not supported). \r\n        * 4) overridePageViewDuration = false, custom duration is provided. Page view is sent right away with custom duration. \r\n        *\r\n        * In all cases page view performance is sent once (only for the 1st call of trackPageView), or not sent if navigation timing is not supported.\r\n        */\r\n        public trackPageView(name?: string, url?: string, properties?: Object, measurements?: Object, duration?: number) {\r\n            // ensure we have valid values for the required fields\r\n            if (typeof name !== \"string\") {\r\n                name = window.document && window.document.title || \"\";\r\n            }\r\n\r\n            if (typeof url !== \"string\") {\r\n                url = window.location && window.location.href || \"\";\r\n            }\r\n\r\n            var pageViewSent = false;\r\n            var customDuration = undefined;\r\n\r\n            if (Telemetry.PageViewPerformance.isPerformanceTimingSupported()) {\r\n                var start = Telemetry.PageViewPerformance.getPerformanceTiming().navigationStart;\r\n                customDuration = Telemetry.PageViewPerformance.getDuration(start, +new Date);\r\n\r\n                if (!Telemetry.PageViewPerformance.shouldCollectDuration(customDuration)) {\r\n                    customDuration = undefined;\r\n                }\r\n            } else {\r\n                this.appInsights.sendPageViewInternal(\r\n                    name,\r\n                    url,\r\n                    !isNaN(duration) ? duration : undefined,\r\n                    properties,\r\n                    measurements);\r\n                this.appInsights.flush();\r\n                pageViewSent = true;\r\n            }\r\n\r\n            if (!pageViewSent && (this.overridePageViewDuration || !isNaN(duration))) {\r\n                // 1, 2, 4 cases\r\n                this.appInsights.sendPageViewInternal(\r\n                    name,\r\n                    url,\r\n                    !isNaN(duration) ? duration : customDuration,\r\n                    properties,\r\n                    measurements);\r\n                this.appInsights.flush();\r\n                pageViewSent = true;\r\n            }\r\n\r\n            var maxDurationLimit = 60000;\r\n\r\n            if (!Telemetry.PageViewPerformance.isPerformanceTimingSupported()) {\r\n                // no navigation timing (IE 8, iOS Safari 8.4, Opera Mini 8 - see http://caniuse.com/#feat=nav-timing)\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING,\r\n                    _InternalMessageId.NavigationTimingNotSupported,\r\n                    \"trackPageView: navigation timing API used for calculation of page duration is not supported in this browser. This page view will be collected without duration and timing info.\");\r\n                return;\r\n            }\r\n\r\n            var handle = setInterval(() => {\r\n                try {\r\n                    if (Telemetry.PageViewPerformance.isPerformanceTimingDataReady()) {\r\n                        clearInterval(handle);\r\n                        var pageViewPerformance = new Telemetry.PageViewPerformance(name, url, null, properties, measurements);\r\n\r\n                        if (!pageViewPerformance.getIsValid() && !pageViewSent) {\r\n                            // If navigation timing gives invalid numbers, then go back to \"override page view duration\" mode.\r\n                            // That's the best value we can get that makes sense.\r\n                            this.appInsights.sendPageViewInternal(name, url, customDuration, properties, measurements);\r\n                            this.appInsights.flush();\r\n                        } else {\r\n                            if (!pageViewSent) {\r\n                                this.appInsights.sendPageViewInternal(name, url, pageViewPerformance.getDurationMs(), properties, measurements);\r\n                            }\r\n\r\n                            if (!this.pageViewPerformanceSent) {\r\n                                this.appInsights.sendPageViewPerformanceInternal(pageViewPerformance);\r\n                                this.pageViewPerformanceSent = true;\r\n                            }\r\n                            this.appInsights.flush();\r\n                        }\r\n                    }\r\n                    else if (Telemetry.PageViewPerformance.getDuration(start, +new Date) > maxDurationLimit) {\r\n                        clearInterval(handle);\r\n                        if (!pageViewSent) {\r\n                            this.appInsights.sendPageViewInternal(name, url, maxDurationLimit, properties, measurements);\r\n                            this.appInsights.flush();\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.CRITICAL,\r\n                        _InternalMessageId.TrackPVFailedCalc,\r\n                        \"trackPageView failed on page load calculation: \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                }\r\n            }, 100);\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../AppInsights.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Used to track page visit durations\r\n     */\r\n    export class PageVisitTimeManager {\r\n\r\n        private prevPageVisitDataKeyName: string = \"prevPageVisitData\";\r\n        private pageVisitTimeTrackingHandler: (pageName: string, pageUrl: string, pageVisitTime: number) => void;\r\n\r\n        /**\r\n         * Creates a new instance of PageVisitTimeManager\r\n         * @param pageVisitTimeTrackingHandler Delegate that will be called to send telemetry data to AI (when trackPreviousPageVisit is called)\r\n         * @returns {} \r\n         */\r\n        constructor(pageVisitTimeTrackingHandler: (pageName: string, pageUrl: string, pageVisitTime: number) => void) {\r\n            this.pageVisitTimeTrackingHandler = pageVisitTimeTrackingHandler;\r\n        }\r\n\r\n         /**\r\n         * Tracks the previous page visit time telemetry (if exists) and starts timing of new page visit time\r\n         * @param currentPageName Name of page to begin timing for visit duration\r\n         * @param currentPageUrl Url of page to begin timing for visit duration\r\n         */\r\n        public trackPreviousPageVisit(currentPageName: string, currentPageUrl: string) {\r\n            \r\n            try {\r\n                // Restart timer for new page view\r\n                var prevPageVisitTimeData = this.restartPageVisitTimer(currentPageName, currentPageUrl);\r\n                \r\n                // If there was a page already being timed, track the visit time for it now.\r\n                if (prevPageVisitTimeData) {\r\n                    this.pageVisitTimeTrackingHandler(prevPageVisitTimeData.pageName, prevPageVisitTimeData.pageUrl, prevPageVisitTimeData.pageVisitTime);\r\n                }\r\n            } catch (e) {\r\n                _InternalLogging.warnToConsole(\"Auto track page visit time failed, metric will not be collected: \" + Util.dump(e));\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Stops timing of current page (if exists) and starts timing for duration of visit to pageName\r\n         * @param pageName Name of page to begin timing visit duration\r\n         * @returns {PageVisitData} Page visit data (including duration) of pageName from last call to start or restart, if exists. Null if not. \r\n         */\r\n        public restartPageVisitTimer(pageName: string, pageUrl: string) {\r\n            try {\r\n                var prevPageVisitData = this.stopPageVisitTimer();\r\n                this.startPageVisitTimer(pageName, pageUrl);\r\n\r\n                return prevPageVisitData;\r\n            } catch (e) {\r\n                _InternalLogging.warnToConsole(\"Call to restart failed: \" + Util.dump(e));\r\n                return null;\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Starts timing visit duration of pageName\r\n         * @param pageName \r\n         * @returns {} \r\n         */\r\n        public startPageVisitTimer(pageName: string, pageUrl: string) {\r\n            try {\r\n                if (Util.canUseSessionStorage()) {\r\n                    if (Util.getSessionStorage(this.prevPageVisitDataKeyName) != null) {\r\n                        throw new Error(\"Cannot call startPageVisit consecutively without first calling stopPageVisit\");\r\n                    }\r\n\r\n                    var currPageVisitData = new PageVisitData(pageName, pageUrl);\r\n                    var currPageVisitDataStr = JSON.stringify(currPageVisitData);\r\n                    Util.setSessionStorage(this.prevPageVisitDataKeyName, currPageVisitDataStr);\r\n                }\r\n            } catch (e) {\r\n                //TODO: Remove this catch in next phase, since if start is called twice in a row the exception needs to be propagated out\r\n                _InternalLogging.warnToConsole(\"Call to start failed: \" + Util.dump(e));\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Stops timing of current page, if exists.\r\n         * @returns {PageVisitData} Page visit data (including duration) of pageName from call to start, if exists. Null if not.  \r\n         */\r\n        public stopPageVisitTimer() {\r\n            try {\r\n                if (Util.canUseSessionStorage()) {\r\n\r\n                    // Define end time of page's visit\r\n                    var pageVisitEndTime = Date.now();\r\n\r\n                    // Try to retrieve  page name and start time from session storage\r\n                    var pageVisitDataJsonStr = Util.getSessionStorage(this.prevPageVisitDataKeyName);\r\n                    if (pageVisitDataJsonStr) {\r\n\r\n                        // if previous page data exists, set end time of visit\r\n                        var prevPageVisitData: PageVisitData = JSON.parse(pageVisitDataJsonStr);\r\n                        prevPageVisitData.pageVisitTime = pageVisitEndTime - prevPageVisitData.pageVisitStartTime;\r\n\r\n                        // Remove data from storage since we already used it\r\n                        Util.removeSessionStorage(this.prevPageVisitDataKeyName);\r\n\r\n                        // Return page visit data\r\n                        return prevPageVisitData;\r\n                    } else {\r\n                        return null;\r\n                    }\r\n\r\n                }\r\n                return null;\r\n            } catch (e) {\r\n                _InternalLogging.warnToConsole(\"Stop page visit timer failed: \" + Util.dump(e));\r\n                return null\r\n            }\r\n        }\r\n    }\r\n\r\n    export class PageVisitData {\r\n\r\n        public pageName: string;\r\n        public pageUrl: string;\r\n        public pageVisitStartTime: number;\r\n        public pageVisitTime: number;\r\n\r\n        constructor(pageName, pageUrl) {\r\n            this.pageVisitStartTime = Date.now();\r\n            this.pageName = pageName;\r\n            this.pageUrl = pageUrl;\r\n        }\r\n    }\r\n}","/// <reference path=\"./HashCodeScoreGenerator.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n \r\n    // Class allows to perform split testing (aka 'a/b testing' aka 'flights')\r\n    // Works similarly to sampling, using the same hashing algorithm under the hood.\r\n    // Suggested use:\r\n    //\r\n    //   newShinyFeature.enabled = false;\r\n    //   if (new SplitTest.isEnabled(<user id>, <percent of users to enable feature for>)){\r\n    //     newShinyFeature.enabled = true;\r\n    //   }\r\n    //\r\n    export class SplitTest {\r\n        private hashCodeGeneragor: HashCodeScoreGenerator = new HashCodeScoreGenerator();\r\n\r\n        public isEnabled(key: string, percentEnabled: number) {\r\n            return this.hashCodeGeneragor.getHashCodeScore(key) < percentEnabled;\r\n        }\r\n    }\r\n}","/// <reference path=\"TelemetryContext.ts\" />\r\n/// <reference path=\"./Telemetry/Common/Data.ts\"/>\r\n/// <reference path=\"./Util.ts\"/>\r\n/// <reference path=\"./Telemetry/PageViewManager.ts\"/>\r\n/// <reference path=\"./Telemetry/PageVisitTimeManager.ts\"/>\r\n/// <reference path=\"./Telemetry/RemoteDependencyData.ts\"/>\r\n/// <reference path=\"./ajax/ajax.ts\"/>\r\n/// <reference path=\"./SplitTest.ts\"/>\r\n/// <reference path=\"../JavaScriptSDK.Interfaces/IAppInsights.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n\r\n    \"use strict\";\r\n\r\n    export var Version = \"1.0.16\";\r\n\r\n    /**\r\n    * Internal interface to pass appInsights object to subcomponents without coupling \r\n    */\r\n    export interface IAppInsightsInternal {\r\n        sendPageViewInternal(name?: string, url?: string, duration?: number, properties?: Object, measurements?: Object);\r\n        sendPageViewPerformanceInternal(pageViewPerformance: ApplicationInsights.Telemetry.PageViewPerformance);\r\n        flush();\r\n    }\r\n\r\n    /**\r\n     * The main API that sends telemetry to Application Insights.\r\n     * Learn more: http://go.microsoft.com/fwlink/?LinkID=401493\r\n     */\r\n    export class AppInsights implements IAppInsightsInternal, IAppInsights {\r\n\r\n        // Counts number of trackAjax invokations.\r\n        // By default we only monitor X ajax call per view to avoid too much load.\r\n        // Default value is set in config.\r\n        // This counter keeps increasing even after the limit is reached.\r\n        private _trackAjaxAttempts: number = 0;\r\n\r\n        private _eventTracking: Timing;\r\n        private _pageTracking: Timing;\r\n        private _pageViewManager: Microsoft.ApplicationInsights.Telemetry.PageViewManager;\r\n        private _pageVisitTimeManager: Microsoft.ApplicationInsights.Telemetry.PageVisitTimeManager;\r\n        private _ajaxMonitor: Microsoft.ApplicationInsights.AjaxMonitor;\r\n\r\n        public config: IConfig;\r\n        public context: TelemetryContext;\r\n        public queue: (() => void)[];\r\n        public static defaultConfig: IConfig;\r\n\r\n        constructor(config: IConfig) {\r\n            this.config = config || <IConfig>{};\r\n\r\n            // load default values if specified\r\n            var defaults: IConfig = AppInsights.defaultConfig;\r\n            if (defaults !== undefined) {\r\n                for (var field in defaults) {\r\n                    // for each unspecified field, set the default value\r\n                    if (this.config[field] === undefined) {\r\n                        this.config[field] = defaults[field];\r\n                    }\r\n                }\r\n            }\r\n\r\n            _InternalLogging.verboseLogging = () => this.config.verboseLogging;\r\n            _InternalLogging.enableDebugExceptions = () => this.config.enableDebug;\r\n            var configGetters: ApplicationInsights.ITelemetryConfig = {\r\n                instrumentationKey: () => this.config.instrumentationKey,\r\n                accountId: () => this.config.accountId,\r\n                sessionRenewalMs: () => this.config.sessionRenewalMs,\r\n                sessionExpirationMs: () => this.config.sessionExpirationMs,\r\n                endpointUrl: () => this.config.endpointUrl,\r\n                emitLineDelimitedJson: () => this.config.emitLineDelimitedJson,\r\n                maxBatchSizeInBytes: () => {\r\n                    return (!this.config.isBeaconApiDisabled && Util.IsBeaconApiSupported()) ?\r\n                        Math.min(this.config.maxBatchSizeInBytes, Sender.MaxBeaconPayloadSize) :\r\n                        this.config.maxBatchSizeInBytes;\r\n                },\r\n                maxBatchInterval: () => this.config.maxBatchInterval,\r\n                disableTelemetry: () => this.config.disableTelemetry,\r\n                sampleRate: () => this.config.samplingPercentage,\r\n                cookieDomain: () => this.config.cookieDomain,\r\n                enableSessionStorageBuffer: () => {\r\n                    // Disable Session Storage buffer if telemetry is sent using Beacon API\r\n                    return ((this.config.isBeaconApiDisabled || !Util.IsBeaconApiSupported()) && this.config.enableSessionStorageBuffer);\r\n                },\r\n                isRetryDisabled: () => this.config.isRetryDisabled,\r\n                isBeaconApiDisabled: () => this.config.isBeaconApiDisabled,\r\n                sdkExtension: () => this.config.sdkExtension,\r\n                isBrowserLinkTrackingEnabled: () => this.config.isBrowserLinkTrackingEnabled,\r\n                appId: () => this.config.appId,\r\n            }\r\n\r\n            if (this.config.isCookieUseDisabled) {\r\n                Util.disableCookies();\r\n            }\r\n\r\n            if (this.config.isStorageUseDisabled) {\r\n                Util.disableStorage();\r\n            }\r\n\r\n            this.context = new ApplicationInsights.TelemetryContext(configGetters);\r\n\r\n            this._pageViewManager = new Microsoft.ApplicationInsights.Telemetry.PageViewManager(this, this.config.overridePageViewDuration);\r\n\r\n            // initialize event timing\r\n            this._eventTracking = new Timing(\"trackEvent\");\r\n            this._eventTracking.action = (name?: string, url?: string, duration?: number, properties?: Object, measurements?: Object) => {\r\n                if (!measurements) {\r\n                    measurements = { duration: duration };\r\n                }\r\n                else {\r\n                    // do not override existing duration value\r\n                    if (isNaN(measurements[\"duration\"])) {\r\n                        measurements[\"duration\"] = duration;\r\n                    }\r\n                }\r\n                var event = new Telemetry.Event(name, properties, measurements);\r\n                var data = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.Event>(Telemetry.Event.dataType, event);\r\n                var envelope = new Telemetry.Common.Envelope(data, Telemetry.Event.envelopeType);\r\n\r\n                this.context.track(envelope);\r\n            }\r\n\r\n            // initialize page view timing\r\n            this._pageTracking = new Timing(\"trackPageView\");\r\n            this._pageTracking.action = (name, url, duration, properties, measurements) => {\r\n                this.sendPageViewInternal(name, url, duration, properties, measurements);\r\n            }\r\n\r\n            this._pageVisitTimeManager = new ApplicationInsights.Telemetry.PageVisitTimeManager(\r\n                (pageName, pageUrl, pageVisitTime) => this.trackPageVisitTime(pageName, pageUrl, pageVisitTime));\r\n\r\n            if (!this.config.disableAjaxTracking) {\r\n                this._ajaxMonitor = new Microsoft.ApplicationInsights.AjaxMonitor(this);\r\n            }\r\n        }\r\n\r\n        public sendPageViewInternal(name?: string, url?: string, duration?: number, properties?: Object, measurements?: Object) {\r\n            var pageView = new Telemetry.PageView(name, url, duration, properties, measurements, this.context.operation.id);\r\n            var data = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.PageView>(Telemetry.PageView.dataType, pageView);\r\n            var envelope = new Telemetry.Common.Envelope(data, Telemetry.PageView.envelopeType);\r\n\r\n            this.context.track(envelope);\r\n\r\n            // reset ajaxes counter\r\n            this._trackAjaxAttempts = 0;\r\n        }\r\n\r\n        public sendPageViewPerformanceInternal(pageViewPerformance: ApplicationInsights.Telemetry.PageViewPerformance) {\r\n            var pageViewPerformanceData = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.PageViewPerformance>(\r\n                Telemetry.PageViewPerformance.dataType, pageViewPerformance);\r\n            var pageViewPerformanceEnvelope = new Telemetry.Common.Envelope(pageViewPerformanceData, Telemetry.PageViewPerformance.envelopeType);\r\n            this.context.track(pageViewPerformanceEnvelope);\r\n        }\r\n\r\n        /**\r\n         * Starts timing how long the user views a page or other item. Call this when the page opens. \r\n         * This method doesn't send any telemetry. Call {@link stopTrackTelemetry} to log the page when it closes.\r\n         * @param   name  A string that idenfities this item, unique within this HTML document. Defaults to the document title.\r\n         */\r\n        public startTrackPage(name?: string) {\r\n            try {\r\n                if (typeof name !== \"string\") {\r\n                    name = window.document && window.document.title || \"\";\r\n                }\r\n\r\n                this._pageTracking.start(name);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.StartTrackFailed,\r\n                    \"startTrackPage failed, page view may not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Logs how long a page or other item was visible, after {@link startTrackPage}. Call this when the page closes. \r\n         * @param   name  The string you used as the name in startTrackPage. Defaults to the document title.\r\n         * @param   url   String - a relative or absolute URL that identifies the page or other item. Defaults to the window location.\r\n         * @param   properties  map[string, string] - additional data used to filter pages and metrics in the portal. Defaults to empty.\r\n         * @param   measurements    map[string, number] - metrics associated with this page, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         */\r\n        public stopTrackPage(name?: string, url?: string, properties?: Object, measurements?: Object) {\r\n            try {\r\n                if (typeof name !== \"string\") {\r\n                    name = window.document && window.document.title || \"\";\r\n                }\r\n\r\n                if (typeof url !== \"string\") {\r\n                    url = window.location && window.location.href || \"\";\r\n                }\r\n\r\n                this._pageTracking.stop(name, url, properties, measurements);\r\n\r\n                if (this.config.autoTrackPageVisitTime) {\r\n                    this._pageVisitTimeManager.trackPreviousPageVisit(name, url);\r\n                }\r\n\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.StopTrackFailed,\r\n                    \"stopTrackPage failed, page view will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Logs that a page or other item was viewed. \r\n         * @param   name  The string you used as the name in startTrackPage. Defaults to the document title.\r\n         * @param   url   String - a relative or absolute URL that identifies the page or other item. Defaults to the window location.\r\n         * @param   properties  map[string, string] - additional data used to filter pages and metrics in the portal. Defaults to empty.\r\n         * @param   measurements    map[string, number] - metrics associated with this page, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         * @param   duration    number - the number of milliseconds it took to load the page. Defaults to undefined. If set to default value, page load time is calculated internally.\r\n         */\r\n        public trackPageView(name?: string, url?: string, properties?: Object, measurements?: Object, duration?: number) {\r\n            try {\r\n                this._pageViewManager.trackPageView(name, url, properties, measurements, duration);\r\n\r\n                if (this.config.autoTrackPageVisitTime) {\r\n                    this._pageVisitTimeManager.trackPreviousPageVisit(name, url);\r\n                }\r\n\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.TrackPVFailed,\r\n                    \"trackPageView failed, page view will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Start timing an extended event. Call {@link stopTrackEvent} to log the event when it ends.\r\n         * @param   name    A string that identifies this event uniquely within the document.\r\n         */\r\n        public startTrackEvent(name: string) {\r\n            try {\r\n                this._eventTracking.start(name);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.StartTrackEventFailed,\r\n                    \"startTrackEvent failed, event will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /** \r\n         * Log an extended event that you started timing with {@link startTrackEvent}.\r\n         * @param   name    The string you used to identify this event in startTrackEvent.\r\n         * @param   properties  map[string, string] - additional data used to filter events and metrics in the portal. Defaults to empty.\r\n         * @param   measurements    map[string, number] - metrics associated with this event, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         */\r\n        public stopTrackEvent(name: string, properties?: Object, measurements?: Object) {\r\n            try {\r\n                this._eventTracking.stop(name, undefined, properties, measurements);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.StopTrackEventFailed,\r\n                    \"stopTrackEvent failed, event will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /** \r\n         * Log a user action or other occurrence.\r\n         * @param   name    A string to identify this event in the portal.\r\n         * @param   properties  map[string, string] - additional data used to filter events and metrics in the portal. Defaults to empty.\r\n         * @param   measurements    map[string, number] - metrics associated with this event, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         */\r\n        public trackEvent(name: string, properties?: Object, measurements?: Object) {\r\n            try {\r\n                var eventTelemetry = new Telemetry.Event(name, properties, measurements);\r\n                var data = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.Event>(Telemetry.Event.dataType, eventTelemetry);\r\n                var envelope = new Telemetry.Common.Envelope(data, Telemetry.Event.envelopeType);\r\n                this.context.track(envelope);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.TrackEventFailed,\r\n                    \"trackEvent failed, event will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Log a dependency call\r\n         * @param id    unique id, this is used by the backend o correlate server requests. Use Util.newId() to generate a unique Id.\r\n         * @param method    represents request verb (GET, POST, etc.)\r\n         * @param absoluteUrl   absolute url used to make the dependency request\r\n         * @param command   command name \r\n         * @param totalTime total request time\r\n         * @param success   indicates if the request was sessessful\r\n         * @param resultCode    response code returned by the dependency request\r\n         * @param properties    map[string, string] - additional data used to filter events and metrics in the portal. Defaults to empty.\r\n         * @param measurements  map[string, number] - metrics associated with this event, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         */\r\n        public trackDependency(id: string, method: string, absoluteUrl: string, command: string, totalTime: number, success: boolean, resultCode: number, properties?: Object, measurements?: Object) {\r\n            if (this.config.maxAjaxCallsPerView === -1 ||\r\n                this._trackAjaxAttempts < this.config.maxAjaxCallsPerView) {\r\n                var dependency = new Telemetry.RemoteDependencyData(id, absoluteUrl, command, totalTime, success, resultCode, method, properties, measurements);\r\n                var dependencyData = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.RemoteDependencyData>(\r\n                    Telemetry.RemoteDependencyData.dataType, dependency);\r\n                var envelope = new Telemetry.Common.Envelope(dependencyData, ApplicationInsights.Telemetry.RemoteDependencyData.envelopeType);\r\n                this.context.track(envelope);\r\n            } else if (this._trackAjaxAttempts === this.config.maxAjaxCallsPerView) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.MaxAjaxPerPVExceeded,\r\n                    \"Maximum ajax per page view limit reached, ajax monitoring is paused until the next trackPageView(). In order to increase the limit set the maxAjaxCallsPerView configuration parameter.\",\r\n                    true);\r\n            }\r\n\r\n            ++this._trackAjaxAttempts;\r\n        }\r\n\r\n         /**\r\n         * Logs dependency call\r\n         * @param dependencyData dependency data object\r\n         */\r\n        public trackDependencyData(dependency: Telemetry.RemoteDependencyData) {\r\n            if (this.config.maxAjaxCallsPerView === -1 || this._trackAjaxAttempts < this.config.maxAjaxCallsPerView) {\r\n                var dependencyData = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.RemoteDependencyData>(\r\n                    Telemetry.RemoteDependencyData.dataType, dependency);\r\n                var envelope = new Telemetry.Common.Envelope(dependencyData, ApplicationInsights.Telemetry.RemoteDependencyData.envelopeType);\r\n                this.context.track(envelope);\r\n            } else if (this._trackAjaxAttempts === this.config.maxAjaxCallsPerView) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.MaxAjaxPerPVExceeded,\r\n                    \"Maximum ajax per page view limit reached, ajax monitoring is paused until the next trackPageView(). In order to increase the limit set the maxAjaxCallsPerView configuration parameter.\",\r\n                    true);\r\n            }\r\n\r\n            ++this._trackAjaxAttempts;\r\n        }\r\n\r\n        /**\r\n         * trackAjax method is obsolete, use trackDependency instead\r\n         */\r\n        public trackAjax(id: string, absoluteUrl: string, pathName: string, totalTime: number, success: boolean, resultCode: number, method?: string) {\r\n            this.trackDependency(id, null, absoluteUrl, pathName, totalTime, success, resultCode);\r\n        }\r\n\r\n        /**\r\n         * Log an exception you have caught.\r\n         * @param   exception   An Error from a catch clause, or the string error message.\r\n         * @param   handledAt   Not used\r\n         * @param   properties  map[string, string] - additional data used to filter events and metrics in the portal. Defaults to empty.\r\n         * @param   measurements    map[string, number] - metrics associated with this event, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         * @param   severityLevel   AI.SeverityLevel - severity level\r\n         */\r\n        public trackException(exception: Error, handledAt?: string, properties?: Object, measurements?: Object, severityLevel?: AI.SeverityLevel) {\r\n            try {\r\n                if (!Util.isError(exception)) {\r\n                    // ensure that we have an error object (user could pass a string/message)\r\n                    try {\r\n                        throw new Error(<any>exception);\r\n                    } catch (error) {\r\n                        exception = error;\r\n                    }\r\n                }\r\n\r\n                var exceptionTelemetry = new Telemetry.Exception(exception, properties, measurements, severityLevel);\r\n                var data = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.Exception>(Telemetry.Exception.dataType, exceptionTelemetry);\r\n                var envelope = new Telemetry.Common.Envelope(data, Telemetry.Exception.envelopeType);\r\n                this.context.track(envelope);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.TrackExceptionFailed,\r\n                    \"trackException failed, exception will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Log a numeric value that is not associated with a specific event. Typically used to send regular reports of performance indicators.\r\n         * To send a single measurement, use just the first two parameters. If you take measurements very frequently, you can reduce the \r\n         * telemetry bandwidth by aggregating multiple measurements and sending the resulting average at intervals.\r\n         * @param   name    A string that identifies the metric.\r\n         * @param   average Number representing either a single measurement, or the average of several measurements.\r\n         * @param   sampleCount The number of measurements represented by the average. Defaults to 1.\r\n         * @param   min The smallest measurement in the sample. Defaults to the average.\r\n         * @param   max The largest measurement in the sample. Defaults to the average.\r\n         */\r\n        public trackMetric(name: string, average: number, sampleCount?: number, min?: number, max?: number, properties?: Object) {\r\n            try {\r\n                var telemetry = new Telemetry.Metric(name, average, sampleCount, min, max, properties);\r\n                var data = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.Metric>(Telemetry.Metric.dataType, telemetry);\r\n                var envelope = new Telemetry.Common.Envelope(data, Telemetry.Metric.envelopeType);\r\n\r\n                this.context.track(envelope);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.TrackMetricFailed,\r\n                    \"trackMetric failed, metric will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n        * Log a diagnostic message. \r\n        * @param   message A message string \r\n        * @param   properties  map[string, string] - additional data used to filter traces in the portal. Defaults to empty.\r\n        * @param   severityLevel   AI.SeverityLevel - severity level\r\n        */\r\n        public trackTrace(message: string, properties?: Object, severityLevel?: AI.SeverityLevel) {\r\n            try {\r\n                var telemetry = new Telemetry.Trace(message, properties, severityLevel);\r\n                var data = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.Trace>(Telemetry.Trace.dataType, telemetry);\r\n                var envelope = new Telemetry.Common.Envelope(data, Telemetry.Trace.envelopeType);\r\n\r\n                this.context.track(envelope);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.WARNING,\r\n                    _InternalMessageId.TrackTraceFailed,\r\n                    \"trackTrace failed, trace will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n       * Log a page visit time\r\n       * @param    pageName    Name of page\r\n       * @param    pageVisitDuration Duration of visit to the page in milleseconds\r\n       */\r\n        private trackPageVisitTime(pageName: string, pageUrl: string, pageVisitTime: number) {\r\n            var properties = { PageName: pageName, PageUrl: pageUrl };\r\n            this.trackMetric(\"PageVisitTime\", pageVisitTime, 1, pageVisitTime, pageVisitTime, properties);\r\n        }\r\n\r\n        /**\r\n         * Immediately send all queued telemetry.\r\n         * @param {boolean} async - If flush should be call asynchronously\r\n         */\r\n        public flush(async = true) {\r\n            try {\r\n                this.context._sender.triggerSend(async);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.FlushFailed,\r\n                    \"flush failed, telemetry will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Sets the authenticated user id and the account id.\r\n         * User auth id and account id should be of type string. They should not contain commas, semi-colons, equal signs, spaces, or vertical-bars.\r\n         * \r\n         * By default the method will only set the authUserID and accountId for all events in this page view. To add them to all events within\r\n         * the whole session, you should either call this method on every page view or set `storeInCookie = true`. \r\n         *   \r\n         * @param authenticatedUserId {string} - The authenticated user id. A unique and persistent string that represents each authenticated user in the service.\r\n         * @param accountId {string} - An optional string to represent the account associated with the authenticated user.\r\n         * @param storeInCookie {boolean} - AuthenticateUserID will be stored in a cookie and added to all events within this session. \r\n         */\r\n        public setAuthenticatedUserContext(authenticatedUserId: string, accountId?: string, storeInCookie = false) {\r\n            try {\r\n                this.context.user.setAuthenticatedUserContext(authenticatedUserId, accountId, storeInCookie);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.WARNING,\r\n                    _InternalMessageId.SetAuthContextFailed,\r\n                    \"Setting auth user context failed. \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) },\r\n                    true);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Clears the authenticated user id and the account id from the user context.\r\n         */\r\n        public clearAuthenticatedUserContext() {\r\n            try {\r\n                this.context.user.clearAuthenticatedUserContext();\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.WARNING,\r\n                    _InternalMessageId.SetAuthContextFailed,\r\n                    \"Clearing auth user context failed. \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) },\r\n                    true);\r\n            }\r\n        }\r\n\r\n        /**\r\n        * In case of CORS exceptions - construct an exception manually.\r\n        * See this for more info: http://stackoverflow.com/questions/5913978/cryptic-script-error-reported-in-javascript-in-chrome-and-firefox\r\n        */\r\n        private SendCORSException(properties: any) {\r\n            var exceptionData = Microsoft.ApplicationInsights.Telemetry.Exception.CreateSimpleException(\r\n                \"Script error.\",\r\n                \"Error\", \"unknown\", \"unknown\",\r\n                \"The browser's same-origin policy prevents us from getting the details of this exception. Consider using 'crossorigin' attribute.\",\r\n                0);\r\n            exceptionData.properties = properties;\r\n\r\n            var data = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.Exception>(Telemetry.Exception.dataType, exceptionData);\r\n            var envelope = new Telemetry.Common.Envelope(data, Telemetry.Exception.envelopeType);\r\n            this.context.track(envelope);\r\n        }\r\n\r\n        /**\r\n         * The custom error handler for Application Insights\r\n         * @param {string} message - The error message\r\n         * @param {string} url - The url where the error was raised\r\n         * @param {number} lineNumber - The line number where the error was raised\r\n         * @param {number} columnNumber - The column number for the line where the error was raised\r\n         * @param {Error}  error - The Error object\r\n         */\r\n        public _onerror(message: string, url: string, lineNumber: number, columnNumber: number, error: Error) {\r\n            try {\r\n                var properties = { url: url ? url : document.URL };\r\n\r\n                if (Util.isCrossOriginError(message, url, lineNumber, columnNumber, error)) {\r\n                    this.SendCORSException(properties);\r\n                } else {\r\n                    if (!Util.isError(error)) {\r\n                        var stack = \"window.onerror@\" + properties.url + \":\" + lineNumber + \":\" + (columnNumber || 0);\r\n                        error = new Error(message);\r\n                        error[\"stack\"] = stack;\r\n                    }\r\n                    this.trackException(error, null, properties);\r\n                }\r\n            } catch (exception) {\r\n                var errorString =\r\n                    error ? (error.name + \", \" + error.message) : \"null\";\r\n\r\n                var exceptionDump: string = Util.dump(exception);\r\n\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.ExceptionWhileLoggingError,\r\n                    \"_onerror threw exception while logging error, error will not be collected: \" + Util.getExceptionName(exception),\r\n                    { exception: exceptionDump, errorString: errorString });\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * Used to record timed events and page views.\r\n     */\r\n    class Timing {\r\n        private _name;\r\n        private _action: (ITimingDetail, number) => void;\r\n        private _events: {\r\n            [key: string]: number;\r\n        };\r\n\r\n        constructor(name: string) {\r\n            this._name = name;\r\n            this._events = {};\r\n        }\r\n\r\n        public start(name: string) {\r\n            if (typeof this._events[name] !== \"undefined\") {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING, _InternalMessageId.StartCalledMoreThanOnce, \"start was called more than once for this event without calling stop.\",\r\n                    { name: this._name, key: name }, true);\r\n            }\r\n\r\n            this._events[name] = +new Date;\r\n        }\r\n\r\n        public stop(name: string, url: string, properties?: Object, measurements?: Object) {\r\n            var start = this._events[name];\r\n            if (isNaN(start)) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING, _InternalMessageId.StopCalledWithoutStart, \"stop was called without a corresponding start.\",\r\n                    { name: this._name, key: name }, true);\r\n            } else {\r\n                var end = +new Date;\r\n                var duration = Telemetry.PageViewPerformance.getDuration(start, end);\r\n                this.action(name, url, duration, properties, measurements);\r\n            }\r\n\r\n            delete this._events[name];\r\n            this._events[name] = undefined;\r\n        }\r\n\r\n        public action: (name?: string, url?: string, duration?: number, properties?: Object, measurements?: Object) => void;\r\n    }\r\n}\r\n","module Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    /* Data loss analyzer is disabled by default.\r\n     * Uncomment code in Sender, SendBuffer and unit tests if you want to enable it\r\n     */\r\n    export class DataLossAnalyzer {\r\n        static enabled = false;\r\n        static appInsights: Microsoft.ApplicationInsights.AppInsights;\r\n        static issuesReportedForThisSession;\r\n        static itemsRestoredFromSessionBuffer: number = 0;\r\n        static LIMIT_PER_SESSION = 10;\r\n        static ITEMS_QUEUED_KEY = \"AI_itemsQueued\";\r\n        static ISSUES_REPORTED_KEY = \"AI_lossIssuesReported\";\r\n\r\n        static reset() {\r\n            if (DataLossAnalyzer.isEnabled()) {\r\n                Util.setSessionStorage(DataLossAnalyzer.ITEMS_QUEUED_KEY, \"0\");\r\n                Util.setSessionStorage(DataLossAnalyzer.ISSUES_REPORTED_KEY, \"0\");\r\n                DataLossAnalyzer.itemsRestoredFromSessionBuffer = 0;\r\n            }\r\n        }\r\n\r\n        private static isEnabled(): boolean {\r\n            return DataLossAnalyzer.enabled &&\r\n                DataLossAnalyzer.appInsights != null &&\r\n                DataLossAnalyzer.appInsights.context._sender._XMLHttpRequestSupported &&\r\n                Util.canUseSessionStorage()\r\n        }\r\n\r\n        static getIssuesReported(): number {\r\n            var result =\r\n                (!DataLossAnalyzer.isEnabled() || isNaN(+Util.getSessionStorage(DataLossAnalyzer.ISSUES_REPORTED_KEY))) ?\r\n                    0 :\r\n                    +Util.getSessionStorage(DataLossAnalyzer.ISSUES_REPORTED_KEY);\r\n\r\n            return result;\r\n        }\r\n\r\n        static incrementItemsQueued() {\r\n            try {\r\n                if (DataLossAnalyzer.isEnabled()) {\r\n                    var itemsQueued: number = DataLossAnalyzer.getNumberOfLostItems();\r\n                    ++itemsQueued;\r\n                    Util.setSessionStorage(DataLossAnalyzer.ITEMS_QUEUED_KEY, itemsQueued.toString());\r\n                }\r\n            } catch (e) { }\r\n        }\r\n\r\n        static decrementItemsQueued(countOfItemsSentSuccessfully: number) {\r\n            try {\r\n                if (DataLossAnalyzer.isEnabled()) {\r\n                    var itemsQueued: number = DataLossAnalyzer.getNumberOfLostItems();\r\n                    itemsQueued -= countOfItemsSentSuccessfully;\r\n                    if (itemsQueued < 0) itemsQueued = 0;\r\n                    Util.setSessionStorage(DataLossAnalyzer.ITEMS_QUEUED_KEY, itemsQueued.toString());\r\n                }\r\n            } catch (e) { }\r\n        }\r\n\r\n        static getNumberOfLostItems(): number {\r\n            var result: number = 0;\r\n            try {\r\n                if (DataLossAnalyzer.isEnabled()) {\r\n                    result = isNaN(+Util.getSessionStorage(DataLossAnalyzer.ITEMS_QUEUED_KEY)) ?\r\n                        0 :\r\n                        +Util.getSessionStorage(DataLossAnalyzer.ITEMS_QUEUED_KEY);\r\n                }\r\n            } catch (e) {\r\n                result = 0;\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        static reportLostItems() {\r\n            try {\r\n                if (DataLossAnalyzer.isEnabled() &&\r\n                    DataLossAnalyzer.getIssuesReported() < DataLossAnalyzer.LIMIT_PER_SESSION &&\r\n                    DataLossAnalyzer.getNumberOfLostItems() > 0) {\r\n\r\n                    var lostItems = DataLossAnalyzer.getNumberOfLostItems() - DataLossAnalyzer.itemsRestoredFromSessionBuffer;\r\n\r\n                    DataLossAnalyzer.appInsights.trackTrace(\r\n                        \"AI (Internal): Internal report DATALOSS:\\\"\" + lostItems + \"\\\"\",\r\n                        null);\r\n                    DataLossAnalyzer.appInsights.flush();\r\n\r\n                    var issuesReported: number = DataLossAnalyzer.getIssuesReported();\r\n                    ++issuesReported;\r\n                    Util.setSessionStorage(DataLossAnalyzer.ISSUES_REPORTED_KEY, issuesReported.toString());\r\n                }\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.FailedToReportDataLoss,\r\n                    \"Failed to report data loss: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n            finally {\r\n                try {\r\n                    DataLossAnalyzer.reset();\r\n                } catch (e) { }\r\n            }\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"AppInsights.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    export interface Snippet {\r\n        queue: Array<() => void>;\r\n        config: IConfig;\r\n    }\r\n\r\n    export class Initialization {\r\n        public snippet: Snippet;\r\n        public config: IConfig;\r\n\r\n        constructor(snippet: Snippet) {\r\n            // initialize the queue and config in case they are undefined\r\n            snippet.queue = snippet.queue || [];\r\n            var config: IConfig = snippet.config || <any>{};\r\n\r\n            // ensure instrumentationKey is specified\r\n            if (config && !config.instrumentationKey) {\r\n                config = <any>snippet;\r\n\r\n                // check for legacy instrumentation key\r\n                if (config[\"iKey\"]) {\r\n                    Microsoft.ApplicationInsights.Version = \"0.10.0.0\";\r\n                    config.instrumentationKey = config[\"iKey\"];\r\n                } else if (config[\"applicationInsightsId\"]) {\r\n                    Microsoft.ApplicationInsights.Version = \"0.7.2.0\";\r\n                    config.instrumentationKey = config[\"applicationInsightsId\"];\r\n                } else {\r\n                    throw new Error(\"Cannot load Application Insights SDK, no instrumentationKey was provided.\");\r\n                }\r\n            }\r\n\r\n            // set default values\r\n            config = Initialization.getDefaultConfig(config);\r\n\r\n            this.snippet = snippet;\r\n            this.config = config;\r\n        }\r\n\r\n        // note: these are split into methods to enable unit tests\r\n        public loadAppInsights() {\r\n\r\n            // initialize global instance of appInsights\r\n            var appInsights = new Microsoft.ApplicationInsights.AppInsights(this.config);\r\n\r\n            // implement legacy version of trackPageView for 0.10<\r\n            if (this.config[\"iKey\"]) {\r\n                var originalTrackPageView = appInsights.trackPageView;\r\n                appInsights.trackPageView = (pagePath?: string, properties?: Object, measurements?: Object) => {\r\n                    originalTrackPageView.apply(appInsights, [null, pagePath, properties, measurements]);\r\n                }\r\n            }\r\n\r\n            // implement legacy pageView interface if it is present in the snippet\r\n            var legacyPageView = \"logPageView\";\r\n            if (typeof this.snippet[legacyPageView] === \"function\") {\r\n                appInsights[legacyPageView] = (pagePath?: string, properties?: Object, measurements?: Object) => {\r\n                    appInsights.trackPageView(null, pagePath, properties, measurements);\r\n                }\r\n            }\r\n\r\n            // implement legacy event interface if it is present in the snippet\r\n            var legacyEvent = \"logEvent\";\r\n            if (typeof this.snippet[legacyEvent] === \"function\") {\r\n                appInsights[legacyEvent] = (name: string, properties?: Object, measurements?: Object) => {\r\n                    appInsights.trackEvent(name, properties, measurements);\r\n                }\r\n            }\r\n\r\n            return appInsights;\r\n        }\r\n\r\n        public emptyQueue() {\r\n\r\n            // call functions that were queued before the main script was loaded\r\n            try {\r\n                if (Microsoft.ApplicationInsights.Util.isArray(this.snippet.queue)) {\r\n                    // note: do not check length in the for-loop conditional in case something goes wrong and the stub methods are not overridden.\r\n                    var length = this.snippet.queue.length;\r\n                    for (var i = 0; i < length; i++) {\r\n                        var call = this.snippet.queue[i];\r\n                        call();\r\n                    }\r\n\r\n                    this.snippet.queue = undefined;\r\n                    delete this.snippet.queue;\r\n                }\r\n            } catch (exception) {\r\n                var properties: any = {};\r\n                if (exception && typeof exception.toString === \"function\") {\r\n                    properties.exception = exception.toString();\r\n                }\r\n                Microsoft.ApplicationInsights._InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING,\r\n                    _InternalMessageId.FailedToSendQueuedTelemetry,\r\n                    \"Failed to send queued telemetry\",\r\n                    properties);\r\n            }\r\n        }\r\n\r\n        public pollInteralLogs(appInsightsInstance: AppInsights) {\r\n            return setInterval(() => {\r\n                var queue: Array<_InternalLogMessage> = Microsoft.ApplicationInsights._InternalLogging.queue;\r\n                var length = queue.length;\r\n                for (var i = 0; i < length; i++) {\r\n                    appInsightsInstance.trackTrace(queue[i].message);\r\n                }\r\n                queue.length = 0;\r\n            }, this.config.diagnosticLogInterval);\r\n        }\r\n\r\n        public addHousekeepingBeforeUnload(appInsightsInstance: AppInsights): void {\r\n            // Add callback to push events when the user navigates away\r\n\r\n            if (!appInsightsInstance.config.disableFlushOnBeforeUnload && ('onbeforeunload' in window)) {\r\n                var performHousekeeping = function () {\r\n                    // Adds the ability to flush all data before the page unloads.\r\n                    // Note: This approach tries to push an async request with all the pending events onbeforeunload.\r\n                    // Firefox does not respect this.Other browsers DO push out the call with < 100% hit rate.\r\n                    // Telemetry here will help us analyze how effective this approach is.\r\n                    // Another approach would be to make this call sync with a acceptable timeout to reduce the \r\n                    // impact on user experience.\r\n                    appInsightsInstance.context._sender.triggerSend();\r\n\r\n                    // Back up the current session to local storage\r\n                    // This lets us close expired sessions after the cookies themselves expire\r\n                    appInsightsInstance.context._sessionManager.backup();\r\n                };\r\n\r\n                if (!Microsoft.ApplicationInsights.Util.addEventHandler('beforeunload', performHousekeeping)) {\r\n                    Microsoft.ApplicationInsights._InternalLogging.throwInternal(\r\n                        Microsoft.ApplicationInsights.LoggingSeverity.CRITICAL,\r\n                        Microsoft.ApplicationInsights._InternalMessageId.FailedToAddHandlerForOnBeforeUnload,\r\n                        'Could not add handler for beforeunload');\r\n                }\r\n            }\r\n        }\r\n\r\n        public static getDefaultConfig(config?: IConfig): IConfig {\r\n            if (!config) {\r\n                config = <IConfig>{};\r\n            }\r\n\r\n            // set default values\r\n            config.endpointUrl = config.endpointUrl || \"https://dc.services.visualstudio.com/v2/track\";\r\n            config.sessionRenewalMs = 30 * 60 * 1000;\r\n            config.sessionExpirationMs = 24 * 60 * 60 * 1000;\r\n            config.maxBatchSizeInBytes = config.maxBatchSizeInBytes > 0 ? config.maxBatchSizeInBytes : 102400; // 100kb\r\n            config.maxBatchInterval = !isNaN(config.maxBatchInterval) ? config.maxBatchInterval : 15000;\r\n            config.enableDebug = Util.stringToBoolOrDefault(config.enableDebug);\r\n            config.disableExceptionTracking = Util.stringToBoolOrDefault(config.disableExceptionTracking);\r\n            config.disableTelemetry = Util.stringToBoolOrDefault(config.disableTelemetry);\r\n            config.verboseLogging = Util.stringToBoolOrDefault(config.verboseLogging);\r\n            config.emitLineDelimitedJson = Util.stringToBoolOrDefault(config.emitLineDelimitedJson);\r\n            config.diagnosticLogInterval = config.diagnosticLogInterval || 10000;\r\n            config.autoTrackPageVisitTime = Util.stringToBoolOrDefault(config.autoTrackPageVisitTime);\r\n\r\n            if (isNaN(config.samplingPercentage) || config.samplingPercentage <= 0 || config.samplingPercentage >= 100) {\r\n                config.samplingPercentage = 100;\r\n            }\r\n\r\n            config.disableAjaxTracking = Util.stringToBoolOrDefault(config.disableAjaxTracking)\r\n            config.maxAjaxCallsPerView = !isNaN(config.maxAjaxCallsPerView) ? config.maxAjaxCallsPerView : 500;\r\n          \r\n            config.isBeaconApiDisabled = Util.stringToBoolOrDefault(config.isBeaconApiDisabled, true);\r\n            config.disableCorrelationHeaders = Util.stringToBoolOrDefault(config.disableCorrelationHeaders);\r\n            config.correlationHeaderExcludedDomains = config.correlationHeaderExcludedDomains || [\r\n                \"*.blob.core.windows.net\", \r\n                \"*.blob.core.chinacloudapi.cn\",\r\n                \"*.blob.core.cloudapi.de\",\r\n                \"*.blob.core.usgovcloudapi.net\"];\r\n            config.disableFlushOnBeforeUnload = Util.stringToBoolOrDefault(config.disableFlushOnBeforeUnload);\r\n            config.enableSessionStorageBuffer = Util.stringToBoolOrDefault(config.enableSessionStorageBuffer, true);\r\n            config.isRetryDisabled = Util.stringToBoolOrDefault(config.isRetryDisabled);\r\n            config.isCookieUseDisabled = Util.stringToBoolOrDefault(config.isCookieUseDisabled);\r\n            config.isStorageUseDisabled = Util.stringToBoolOrDefault(config.isStorageUseDisabled);\r\n            config.isBrowserLinkTrackingEnabled = Util.stringToBoolOrDefault(config.isBrowserLinkTrackingEnabled);\r\n \r\n            return config;\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"Initialization.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    try {\r\n        // only initialize if we are running in a browser that supports JSON serialization (ie7<, node.js, cordova)\r\n        if (typeof window !== \"undefined\" && typeof JSON !== \"undefined\") {\r\n            // get snippet or initialize to an empty object\r\n            var aiName = \"appInsights\";\r\n    \r\n            if (window[aiName] === undefined) {\r\n                // if no snippet is present, initialize default values\r\n                Microsoft.ApplicationInsights.AppInsights.defaultConfig = Microsoft.ApplicationInsights.Initialization.getDefaultConfig();\r\n            } else {\r\n                // this is the typical case for browser+snippet\r\n                var snippet: Microsoft.ApplicationInsights.Snippet = window[aiName] || <any>{};\r\n    \r\n                // overwrite snippet with full appInsights\r\n                var init = new Microsoft.ApplicationInsights.Initialization(snippet);\r\n                var appInsightsLocal = init.loadAppInsights();\r\n\r\n                // apply full appInsights to the global instance that was initialized in the snippet\r\n                for (var field in appInsightsLocal) {\r\n                    snippet[field] = appInsightsLocal[field];\r\n                }\r\n    \r\n                init.emptyQueue();\r\n    \r\n                init.pollInteralLogs(appInsightsLocal);\r\n    \r\n                init.addHousekeepingBeforeUnload(appInsightsLocal);\r\n            }\r\n        }\r\n    } catch (e) {\r\n        Microsoft.ApplicationInsights._InternalLogging.warnToConsole('Failed to initialize AppInsights JS SDK: ' + e.message);\r\n    }\r\n}\r\n"]}